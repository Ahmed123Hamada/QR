<!DOCTYPE html>
<html lang="ar" dir="rtl" data-role="">

<head>
  <meta charset="UTF-8" />
  <title>Ù…ÙˆÙ„Ø¯ Ø±Ù…Ø² QR Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ù…ØªØ¬Ø±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <!-- PWA -->
  <meta name="theme-color" content="#0d6efd">
  <meta name="color-scheme" content="light dark">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <!-- manifest ÙŠØ¶Ø§Ù ÙÙ‚Ø· Ø¹Ù†Ø¯ http/https Ù„Ù…Ù†Ø¹ ØªØ­Ø°ÙŠØ± CORS Ø¹Ù„Ù‰ file:// -->
  <script>
    (function () {
      if (location.protocol === 'http:' || location.protocol === 'https:') {
        var l = document.createElement('link');
        l.rel = 'manifest';
        l.href = 'manifest.webmanifest';
        document.head.appendChild(l);
      }
    })();
  </script>
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512.png">
  <!-- Favicon -->
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”·</text></svg>">
  <link rel="apple-touch-icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”·</text></svg>">

  <!-- Ù…ÙƒØªØ¨Ø§Øª CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&display=swap" rel="stylesheet">

  <style>
    /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© - Modern UI */
    :root {
      --glass-bg: rgba(255, 255, 255, 0.7);
      --glass-border: rgba(255, 255, 255, 0.18);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);
      --shadow-xl: 0 12px 48px rgba(0, 0, 0, 0.2);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      min-height: 100vh;
    }

    .transition {
      transition: all var(--transition-base);
    }

    /* Glassmorphism Effect */
    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-md);
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ†Ø§Øª - Modern */
    .custom-accordion-1 .accordion-button {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: var(--radius-md) !important;
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
    }

    .custom-accordion-1 .accordion-button:not(.collapsed) {
      background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .custom-accordion-2 .accordion-button {
      background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
      border-radius: var(--radius-md) !important;
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
    }

    .custom-accordion-2 .accordion-button:not(.collapsed) {
      background: linear-gradient(135deg, #dee2e6 0%, #ced4da 100%);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .custom-accordion-3 .accordion-button {
      background: linear-gradient(135deg, #dee2e6 0%, #ced4da 100%);
      border-radius: var(--radius-md) !important;
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
    }

    .custom-accordion-3 .accordion-button:not(.collapsed) {
      background: linear-gradient(135deg, #ced4da 0%, #adb5bd 100%);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .custom-accordion-4 .accordion-button {
      background: linear-gradient(135deg, #d1e7dd 0%, #a3cfbb 100%);
      border-radius: var(--radius-md) !important;
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
    }

    .custom-accordion-4 .accordion-button:not(.collapsed) {
      background: linear-gradient(135deg, #a3cfbb 0%, #75b798 100%);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    /* Ø£Ù†Ù…Ø§Ø· QR - Modern */
    .accordion-qr {
      margin: 20px auto;
      max-width: 300px;
      padding: 20px;
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      transition: all var(--transition-base);
    }

    .accordion-qr:hover {
      box-shadow: var(--shadow-xl);
      transform: translateY(-4px);
    }

    .accordion-qr-comment {
      margin-top: 10px;
      font-style: italic;
      color: #6c757d;
      font-size: 0.95rem;
    }

    .shared-qr-note {
      font-size: 0.9rem;
      color: #6c757d;
      margin-top: 10px;
      padding: 12px;
      background: rgba(13, 110, 253, 0.05);
      border-radius: var(--radius-sm);
      border-right: 3px solid #0d6efd;
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ - Modern */
    .desc-table {
      border-radius: var(--radius-md);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .desc-table th,
    .desc-table td {
      padding: 12px;
      transition: background var(--transition-fast);
    }

    .desc-table tbody tr:hover {
      background: rgba(13, 110, 253, 0.05);
    }

    /* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ± - Modern */
    .img-preview {
      max-width: 200px;
      max-height: 200px;
      border-radius: var(--radius-md);
      margin-top: 10px;
      box-shadow: var(--shadow-md);
      transition: transform var(--transition-base);
    }

    .img-preview:hover {
      transform: scale(1.05);
    }

    /* Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª - Modern */
    .card-attachment {
      display: flex;
      align-items: center;
      margin: 8px;
      padding: 12px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .card-attachment:hover {
      transform: translateX(-4px);
      box-shadow: var(--shadow-md);
      background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
    }

    .card-attachment img {
      width: 48px;
      height: 48px;
      object-fit: cover;
      margin-right: 12px;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow-sm);
    }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ - Modern Professional UI/UX */
    .subscription-card {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 2px solid transparent;
      background: #ffffff;
      position: relative;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .subscription-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
    }

    .subscription-card:hover::after {
      opacity: 1;
    }

    .subscription-card:hover {
      transform: translateY(-12px) scale(1.03);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      border-color: rgba(102, 126, 234, 0.3);
    }

    .subscription-card .card-header {
      padding: 1.5rem;
      font-weight: 700;
      font-size: 1.25rem;
      border: none;
      position: relative;
      overflow: hidden;
    }

    .subscription-card .card-header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: rotate(45deg);
      transition: all 0.6s;
    }

    .subscription-card:hover .card-header::before {
      animation: shine 1.5s infinite;
    }

    @keyframes shine {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }

      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }

    .subscription-card .card-body {
      padding: 2rem 1.5rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .subscription-card .card-title {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subscription-features {
      list-style: none;
      padding: 0;
      text-align: right;
      margin: 1.5rem 0;
      flex-grow: 1;
    }

    .subscription-features li {
      padding: 12px 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: #4a5568;
      font-size: 1rem;
      position: relative;
      padding-right: 2rem;
    }

    .subscription-features li:hover {
      transform: translateX(-8px);
      color: #2d3748;
    }

    .subscription-features li:before {
      content: "âœ“";
      position: absolute;
      right: 0;
      color: #48bb78;
      font-weight: bold;
      font-size: 1.2rem;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      border-radius: 50%;
      color: white;
      font-size: 0.875rem;
    }

    .subscription-card .card-footer {
      padding: 1.5rem;
      border: none;
      background: transparent;
    }

    .subscription-card .btn {
      border-radius: var(--radius-md);
      font-weight: 700;
      padding: 0.875rem 2rem;
      font-size: 1.1rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .subscription-card .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .subscription-card .btn:hover::before {
      width: 400px;
      height: 400px;
    }

    .subscription-card .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }

    /* ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ - Modern */
    .grace-period {
      background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
      padding: 20px;
      border-radius: var(--radius-lg);
      border: 2px solid #ffc107;
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    .grace-period::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {

      0%,
      100% {
        transform: rotate(0deg);
      }

      50% {
        transform: rotate(180deg);
      }
    }

    .btn-grace {
      background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
      border: none;
      box-shadow: var(--shadow-md);
      transition: all var(--transition-base);
    }

    .btn-grace:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Modern Professional UI/UX */
    .product-card .card-img-top {
      width: 100%;
      min-height: 320px;
      max-height: 400px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      overflow: hidden;
      position: relative;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .product-card .card-img-top .product-img {
      width: 100% !important;
      height: auto !important;
      max-height: 100%;
      max-width: 100%;
      object-fit: contain;
      object-position: center;
      display: block;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: var(--radius-md);
    }

    .product-card:hover .card-img-top .product-img {
      transform: scale(1.05);
    }

    .product-card {
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: var(--radius-xl);
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08), 0 4px 24px rgba(0, 0, 0, 0.04);
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: #ffffff;
      position: relative;
      height: 100%;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(10px);
      max-width: 100%;
      width: 100%;
    }

    .product-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
    }

    .product-card:hover::before {
      transform: scaleX(1);
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.2), 0 4px 16px rgba(0, 0, 0, 0.1);
      border-color: rgba(102, 126, 234, 0.4);
    }


    .product-card .card-body {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      padding: 2rem;
      background: linear-gradient(to bottom, #ffffff 0%, #fafbfc 100%);
    }

    .product-card .card-title {
      font-weight: 700;
      font-size: 1.3rem;
      margin-bottom: 0.875rem;
      color: #1a202c;
      line-height: 1.5;
      letter-spacing: -0.02em;
    }

    .product-card .card-text {
      color: #64748b;
      font-size: 0.95rem;
      line-height: 1.7;
      margin-bottom: 1.25rem;
      flex-grow: 1;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .product-card .h5 {
      font-weight: 800;
      font-size: 1.75rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.03em;
    }

    .product-card .btn {
      border-radius: var(--radius-lg);
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .product-card .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.25);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .product-card .btn:hover::before {
      width: 400px;
      height: 400px;
    }

    .product-card .btn:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }

    .product-card .btn:active {
      transform: translateY(-1px) scale(0.98);
    }

    /* Ø§Ù„Ø¨Ø§Ø¯Ø¬Ø§Øª */
    .admin-badge,
    .viewer-badge {
      font-size: 0.7rem;
      vertical-align: middle;
    }

    /* Cart Button - Modern Professional */
    #cartButton {
      border-radius: var(--radius-lg);
      padding: 0.875rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    #cartButton::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    #cartButton:hover::before {
      width: 400px;
      height: 400px;
    }

    #cartButton:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
    }

    #cartButton:active {
      transform: translateY(-1px) scale(1.02);
    }

    #cartButton .cart-badge {
      position: absolute;
      top: -8px;
      left: -8px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      border: 3px solid white;
      font-weight: 700;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      min-width: 24px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }
    }

    /* Products Section Header */
    #products-pane {
      padding: 2rem 0;
    }

    #products-pane .d-flex.justify-content-end {
      margin-bottom: 2rem;
    }

    /* Search Input - Modern */
    #search-products-input {
      border-radius: var(--radius-lg);
      border: 2px solid rgba(102, 126, 234, 0.2);
      padding: 0.875rem 1.25rem;
      font-size: 1rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: #ffffff;
    }

    #search-products-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      outline: none;
    }

    #search-products-input::placeholder {
      color: #a0aec0;
    }

    /* Products Container */
    #products-container {
      animation: fadeInUp 0.6s ease-out;
      width: 100%;
      margin: 0;
      padding: 0;
    }

    #products-container .product-card {
      animation: fadeInUp 0.6s ease-out backwards;
      width: 100%;
      max-width: 100%;
      margin-left: 0;
      margin-right: 0;
    }

    #products-container .product-card:nth-child(1) {
      animation-delay: 0.1s;
    }

    #products-container .product-card:nth-child(2) {
      animation-delay: 0.2s;
    }

    #products-container .product-card:nth-child(3) {
      animation-delay: 0.3s;
    }

    #products-container .product-card:nth-child(4) {
      animation-delay: 0.4s;
    }

    #products-container .product-card:nth-child(5) {
      animation-delay: 0.5s;
    }

    #products-container .product-card:nth-child(6) {
      animation-delay: 0.6s;
    }

    #products-container .product-card:nth-child(n+7) {
      animation-delay: 0.7s;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Accordion Header Enhancement */
    #productsAccordion .accordion-button {
      border-radius: var(--radius-md);
      font-weight: 600;
      padding: 1.25rem 1.5rem;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      border: 1px solid rgba(102, 126, 234, 0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #productsAccordion .accordion-button:not(.collapsed) {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      border-color: rgba(102, 126, 234, 0.3);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    #productsAccordion .accordion-button:hover {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
    }

    #productsAccordion .accordion-body {
      padding: 2rem;
    }

    /* Search Button Enhancement */
    #search-products-btn {
      border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      font-weight: 600;
      padding: 0.875rem 1.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    #search-products-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    #search-products-btn:active {
      transform: translateY(0);
    }

    .input-group-text {
      border-radius: var(--radius-lg) 0 0 var(--radius-lg);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-left: none;
    }

    .input-group .form-control {
      border-left: none;
    }

    .input-group .form-control:focus {
      border-color: #667eea;
    }

    .input-group:focus-within .input-group-text {
      border-color: #667eea;
    }

    /* Products Section Title */
    #products-pane h3 {
      font-weight: 700;
      color: #2d3748;
      font-size: 1.75rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Empty State */
    #products-container:empty::before {
      content: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø¹Ø±Ø¶';
      display: block;
      text-align: center;
      padding: 3rem;
      color: #a0aec0;
      font-size: 1.1rem;
    }

    /* QR Code Cards Enhancement */
    .qr-code-card {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: var(--radius-lg);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .qr-code-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    }

    .qr-code-wrapper {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .qr-code-card:hover .qr-code-wrapper {
      transform: scale(1.05);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .qr-card-header {
      position: relative;
    }

    /* Responsive Enhancements */
    @media (max-width: 768px) {
      .product-card {
        margin-bottom: 1.5rem;
      }

      .subscription-card {
        margin-bottom: 1.5rem;
      }

      .qr-code-card {
        margin-bottom: 1.5rem;
      }

      #cartButton {
        padding: 0.75rem 1.25rem;
        font-size: 0.9rem;
      }

      #products-pane {
        padding: 1rem 0;
      }
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø«ÙŠÙ…Ø§Øª (Ø°ÙƒØ±/Ø£Ù†Ø«Ù‰/Ù…Ø­Ø§ÙŠØ¯) */
    .male-style {
      --primary: #0d6efd;
      --text: #0b306e;
      --soft: #f7fbff;
      --tab-bg: #f0f6ff;
      --tab-border: #cfe2ff;
      --border: #bed6ff;
      --shadow: rgba(13, 110, 253, .12);
      --shadow-2: rgba(13, 110, 253, .20);
      --acc1: #0d6efd;
      --acc1-bg: #eef4ff;
      --acc2: #198754;
      --acc2-bg: #eefaf3;
      --acc3: #6f42c1;
      --acc3-bg: #f3eefc;
      --acc4: #0dcaf0;
      --acc4-bg: #eefbff;
      --tab-weight: 700;
    }

    .female-style {
      --primary: #e83e8c;
      --text: #6f123a;
      --soft: #fff7fa;
      --tab-bg: #fff0f7;
      --tab-border: #ffd3e6;
      --border: #ffc2dc;
      --shadow: rgba(232, 62, 140, .12);
      --shadow-2: rgba(232, 62, 140, .20);
      --acc1: #e83e8c;
      --acc1-bg: #fff0f6;
      --acc2: #c22573;
      --acc2-bg: #fff5f9;
      --acc3: #9c36b5;
      --acc3-bg: #f8ecff;
      --acc4: #ff6b9a;
      --acc4-bg: #fff7fa;
      --tab-weight: 700;
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø«ÙŠÙ… */
    .male-style .custom-accordion-1,
    .female-style .custom-accordion-1 {
      border-inline-start: 6px solid var(--acc1);
    }

    .male-style .custom-accordion-2,
    .female-style .custom-accordion-2 {
      border-inline-start: 6px solid var(--acc2);
    }

    .male-style .custom-accordion-3,
    .female-style .custom-accordion-3 {
      border-inline-start: 6px solid var(--acc3);
    }

    .male-style .custom-accordion-4,
    .female-style .custom-accordion-4 {
      border-inline-start: 6px solid var(--acc4);
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† */
    .male-style .custom-accordion-1 .accordion-button,
    .female-style .custom-accordion-1 .accordion-button {
      background-color: var(--acc1-bg) !important;
      color: var(--text);
    }

    .male-style .custom-accordion-2 .accordion-button,
    .female-style .custom-accordion-2 .accordion-button {
      background-color: var(--acc2-bg) !important;
      color: var(--text);
    }

    .male-style .custom-accordion-3 .accordion-button,
    .female-style .custom-accordion-3 .accordion-button {
      background-color: var(--acc3-bg) !important;
      color: var(--text);
    }

    .male-style .custom-accordion-4 .accordion-button,
    .female-style .custom-accordion-4 .accordion-button {
      background-color: var(--acc4-bg) !important;
      color: var(--text);
    }

    /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ */
    .male-style .nav-tabs,
    .female-style .nav-tabs {
      border-bottom-color: var(--tab-border) !important;
      box-shadow: inset 0 -1px 0 var(--tab-border);
    }

    .male-style .nav-tabs .nav-link,
    .female-style .nav-tabs .nav-link {
      color: var(--text);
      border: 1px solid transparent;
      background-color: transparent;
      font-weight: var(--tab-weight, 700);
      letter-spacing: .15px;
    }

    .male-style .nav-tabs .nav-link:hover,
    .female-style .nav-tabs .nav-link:hover {
      background-color: var(--soft);
      border-color: var(--tab-border);
      color: var(--primary);
    }

    .male-style .nav-tabs .nav-link.active,
    .female-style .nav-tabs .nav-link.active {
      color: var(--primary) !important;
      background-color: var(--tab-bg);
      border-color: var(--tab-border) var(--tab-border) transparent var(--tab-border) !important;
      box-shadow: inset 0 -2px 0 var(--primary), 0 .35rem 1rem var(--shadow);
    }

    /* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ */
    .role-viewer .viewer-hide {
      display: none !important;
    }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© - Modern */
    .card-expired-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #dc3545;
      border-radius: var(--radius-lg);
      z-index: 10;
    }

    /* QR Report Modal - Modern UI/UX */
    .report-modal-content {
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      border: none;
    }

    .report-modal-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      color: #212529;
      padding: 1.75rem 2rem;
      border: none;
      border-bottom: 2px solid #e9ecef;
    }

    .report-icon-wrapper {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      background: rgba(102, 126, 234, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      backdrop-filter: blur(10px);
      color: #667eea;
    }

    .report-modal-header .modal-title {
      font-weight: 700;
      font-size: 1.5rem;
      color: #212529;
    }

    .report-modal-header small {
      font-size: 0.875rem;
      color: #212529 !important;
      opacity: 0.8;
    }

    .report-modal-header .text-white-50 {
      color: #212529 !important;
      opacity: 0.8 !important;
    }

    .report-modal-body {
      padding: 2rem;
      background: #f8f9fa;
      max-height: 70vh;
      overflow-y: auto;
    }

    .report-modal-body::-webkit-scrollbar {
      width: 8px;
    }

    .report-modal-body::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .report-modal-body::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
    }

    .report-modal-body::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #5568d3 0%, #653a8f 100%);
    }

    .report-modal-footer {
      background: white;
      padding: 1.25rem 2rem;
      border-top: 1px solid #e9ecef;
    }

    .btn-action-report {
      padding: 0.625rem 1.25rem;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }

    .btn-action-report::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-action-report:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-action-report:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .btn-action-report:active {
      transform: translateY(0);
    }

    .btn-pdf {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      border-color: #dc3545;
      color: white;
    }

    .btn-pdf:hover {
      background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
      border-color: #c82333;
      color: white;
    }

    .btn-jpg {
      background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
      border-color: #ffc107;
      color: #212529;
    }

    .btn-jpg:hover {
      background: linear-gradient(135deg, #e0a800 0%, #d39e00 100%);
      border-color: #e0a800;
      color: #212529;
    }

    .btn-docx {
      background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
      border-color: #0d6efd;
      color: white;
    }

    .btn-docx:hover {
      background: linear-gradient(135deg, #0a58ca 0%, #084298 100%);
      border-color: #0a58ca;
      color: white;
    }

    .btn-print {
      background: linear-gradient(135deg, #212529 0%, #1a1e21 100%);
      border-color: #212529;
      color: white;
    }

    .btn-print:hover {
      background: linear-gradient(135deg, #1a1e21 0%, #141619 100%);
      border-color: #1a1e21;
      color: white;
    }

    /* Ø§Ù„ØªÙ‚Ø±ÙŠØ± - Modern */
    .report-tab-section {
      margin-bottom: 2.5rem;
      padding: 1.75rem;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      position: relative;
      transition: all 0.3s ease;
    }

    .report-tab-section:hover {
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      transform: translateY(-2px);
    }

    .report-tab-section h4 {
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .report-tab-section h4 i {
      color: #667eea;
      font-size: 1.5rem;
    }

    .report-qr-container {
      text-align: center;
      margin: 1.5rem 0;
      padding: 2rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border: 2px solid rgba(102, 126, 234, 0.1);
      transition: all 0.3s ease;
    }

    .report-qr-container:hover {
      border-color: rgba(102, 126, 234, 0.3);
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.15);
    }

    .report-qr {
      display: inline-block;
      margin: 0 auto;
      padding: 1.25rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .report-qr:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .report-comment {
      margin-top: 1rem;
      font-style: italic;
      color: #6c757d;
      padding: 0.75rem 1rem;
      background: linear-gradient(135deg, rgba(108, 117, 125, 0.05) 0%, rgba(108, 117, 125, 0.1) 100%);
      border-radius: 10px;
      display: inline-block;
      border-left: 3px solid #667eea;
    }

    .report-accordion-section {
      margin-bottom: 2rem;
      padding: 1.75rem;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .report-accordion-section h4 {
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid #e9ecef;
    }

    @media (max-width: 768px) {
      .report-modal-header {
        padding: 1.25rem 1.5rem;
      }

      .report-modal-header .modal-title {
        font-size: 1.25rem;
      }

      .report-icon-wrapper {
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
      }

      .report-modal-body {
        padding: 1.5rem;
      }

      .report-modal-footer {
        padding: 1rem 1.5rem;
        flex-direction: column;
        gap: 1rem;
      }

      .btn-action-report {
        width: 100%;
        justify-content: center;
      }

      .report-tab-section {
        padding: 1.25rem;
      }
    }

    /* ØµÙØ­Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© A2 */
    .a2-page {
      width: 594px;
      min-height: 420px;
      margin: 0 auto;
      background: white;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      position: relative;
      padding: 20px;
      box-sizing: border-box;
    }

    .print-header,
    .print-footer {
      display: none;
    }

    @media print {
      @page {
        size: A2 portrait;
        margin: 0;
      }

      /* âœ… Ù…Ø¶Ø§ÙØ© */
      body * {
        visibility: hidden;
      }

      .a2-page,
      .a2-page * {
        visibility: visible;
      }

      .a2-page {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        box-shadow: none;
        margin: 0;
        padding: 15mm;
      }

      .print-header,
      .print-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5mm;
        font-size: 10pt;
      }

      .print-header {
        border-bottom: 1px solid #ddd;
        margin-bottom: 5mm;
      }

      .print-footer {
        border-top: 1px solid #ddd;
        margin-top: 5mm;
      }

      .print-content {
        padding: 0 5mm;
      }
    }

    @media print {
      .a2-page {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }

    /* Modern Buttons */
    .btn {
      border-radius: var(--radius-md);
      font-weight: 600;
      padding: 0.6rem 1.2rem;
      transition: all var(--transition-base);
      box-shadow: var(--shadow-sm);
      border: none;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: var(--shadow-sm);
    }

    .btn-primary {
      background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
    }

    .btn-success {
      background: linear-gradient(135deg, #198754 0%, #146c43 100%);
    }

    .btn-danger {
      background: linear-gradient(135deg, #dc3545 0%, #b02a37 100%);
    }

    .btn-warning {
      background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
    }

    .btn-info {
      background: linear-gradient(135deg, #0dcaf0 0%, #0aa2c0 100%);
    }

    .btn-outline-primary,
    .btn-outline-success,
    .btn-outline-danger,
    .btn-outline-warning,
    .btn-outline-info,
    .btn-outline-secondary {
      background: white;
      backdrop-filter: blur(10px);
    }

    .btn-outline-primary:hover,
    .btn-outline-success:hover,
    .btn-outline-danger:hover,
    .btn-outline-warning:hover,
    .btn-outline-info:hover,
    .btn-outline-secondary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    /* Modern Form Controls */
    .form-control,
    .form-select {
      border-radius: var(--radius-md);
      border: 2px solid rgba(0, 0, 0, 0.1);
      padding: 0.75rem 1rem;
      transition: all var(--transition-base);
      background: white;
      box-shadow: var(--shadow-sm);
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary, #0d6efd);
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15), var(--shadow-md);
      transform: translateY(-1px);
    }

    .form-control:hover,
    .form-select:hover {
      border-color: rgba(0, 0, 0, 0.2);
      box-shadow: var(--shadow-sm);
    }

    .form-label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 0.5rem;
    }

    /* Modern Cards */
    .card {
      border-radius: var(--radius-lg);
      border: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-base);
      overflow: hidden;
    }

    .card:hover {
      box-shadow: var(--shadow-xl);
      transform: translateY(-4px);
    }

    .card-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid rgba(0, 0, 0, 0.05);
      font-weight: 600;
      padding: 1rem 1.25rem;
    }

    /* Modern Modals */
    .modal-content {
      border-radius: var(--radius-xl);
      border: none;
      box-shadow: var(--shadow-xl);
      overflow: hidden;
    }

    .modal-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid rgba(0, 0, 0, 0.05);
      padding: 1.5rem;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-top: 2px solid rgba(0, 0, 0, 0.05);
      padding: 1rem 1.5rem;
    }

    /* Payment Method Cards - Modern UI */
    .payment-methods {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .payment-method-card {
      display: flex;
      align-items: center;
      padding: 1.5rem;
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: white;
      position: relative;
      overflow: hidden;
    }

    .payment-method-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .payment-method-card:hover {
      border-color: #667eea;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
      transform: translateY(-2px);
    }

    .payment-method-card:hover::before {
      transform: scaleY(1);
    }

    .payment-method-card.selected {
      border-color: #667eea;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
    }

    .payment-method-card.selected::before {
      transform: scaleY(1);
    }

    .payment-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 1.5rem;
      margin-left: 1rem;
      flex-shrink: 0;
    }

    .payment-icon.instagram {
      background: linear-gradient(135deg, #E4405F 0%, #F77737 50%, #FCAF45 100%);
    }

    .payment-icon.vodafone {
      background: linear-gradient(135deg, #E60000 0%, #FF0000 100%);
    }

    .payment-details {
      flex: 1;
      margin-left: 1rem;
    }

    .payment-details h6 {
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 0.25rem;
    }

    .payment-arrow {
      color: #a0aec0;
      font-size: 1.25rem;
      margin-left: 1rem;
      transition: all 0.3s ease;
    }

    .payment-method-card:hover .payment-arrow {
      color: #667eea;
      transform: translateX(-5px);
    }

    @media (max-width: 768px) {
      .payment-method-card {
        padding: 1rem;
      }

      .payment-icon {
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
        margin-left: 0.75rem;
      }

      .payment-details {
        margin-left: 0.75rem;
      }

      .payment-details h6 {
        font-size: 0.95rem;
      }
    }

    /* Modern Alerts */
    .alert {
      border-radius: var(--radius-lg);
      border: none;
      box-shadow: var(--shadow-md);
      padding: 1rem 1.25rem;
      backdrop-filter: blur(10px);
    }

    .alert-primary {
      background: linear-gradient(135deg, rgba(13, 110, 253, 0.1) 0%, rgba(13, 110, 253, 0.05) 100%);
      border-right: 4px solid #0d6efd;
    }

    .alert-success {
      background: linear-gradient(135deg, rgba(25, 135, 84, 0.1) 0%, rgba(25, 135, 84, 0.05) 100%);
      border-right: 4px solid #198754;
    }

    .alert-warning {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
      border-right: 4px solid #ffc107;
    }

    .alert-danger {
      background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
      border-right: 4px solid #dc3545;
    }

    /* Modern Tables */
    .table {
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .table thead {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    .table tbody tr {
      transition: all var(--transition-fast);
    }

    .table tbody tr:hover {
      background: rgba(13, 110, 253, 0.05);
      transform: scale(1.01);
    }

    /* Modern Badges */
    .badge {
      padding: 0.5em 0.75em;
      border-radius: var(--radius-sm);
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    /* Modern Tabs */
    .nav-tabs {
      border-bottom: 2px solid rgba(0, 0, 0, 0.08);
      margin-bottom: 1.5rem;
    }

    .nav-tabs .nav-link {
      border-radius: var(--radius-md) var(--radius-md) 0 0;
      margin-bottom: -2px;
      transition: all var(--transition-base);
    }

    /* Backdrop overlay for customizer panel */
    #customizer-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      z-index: 1049;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    #customizer-backdrop.show {
      display: block;
      opacity: 1;
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ®ØµÙŠØµ - Modern */
    #customizer-panel {
      position: fixed;
      top: calc(env(safe-area-inset-top) + 80px);
      left: calc(env(safe-area-inset-left) + 16px);
      right: calc(env(safe-area-inset-right) + 16px);
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      padding: 24px;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--glass-border);
      z-index: 1050;
      width: auto;
      max-width: calc(100% - 32px);
      display: none;
      animation: slideDown 0.3s ease;
      max-height: calc(100vh - env(safe-area-inset-top) - 100px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    #customizer-panel.show {
      display: block;
    }

    /* Responsive Design - Comprehensive */

    /* Large Desktop (>= 1400px) */
    @media (min-width: 1400px) {
      .container {
        max-width: 1320px;
      }

      #customizer-panel {
        max-width: 1200px;
        margin: 0 auto;
        left: 50%;
        right: auto;
        transform: translateX(-50%);
      }
    }

    /* Desktop (1200px - 1399px) */
    @media (min-width: 1200px) and (max-width: 1399px) {
      .container {
        max-width: 1140px;
      }
    }

    /* Laptop (992px - 1199px) */
    @media (min-width: 992px) and (max-width: 1199px) {
      .container {
        max-width: 960px;
      }

      #customizer-panel .row {
        --bs-gutter-x: 1rem;
      }
    }

    /* Tablet (768px - 991px) */
    @media (min-width: 768px) and (max-width: 991px) {
      .product-card .card-img-top {
        min-height: 240px;
        max-height: 300px;
      }

      .product-card .card-body {
        padding: 1.5rem;
      }

      .container {
        max-width: 720px;
      }

      #site-header {
        padding: 0.75rem 1rem;
      }

      .site-header .brand-title {
        font-size: clamp(0.9rem, 2vw, 1.1rem);
      }

      #customizer-panel {
        padding: 20px;
      }

      #customizer-panel .row {
        --bs-gutter-x: 1rem;
      }

      .nav-tabs .nav-link {
        font-size: 0.9rem;
        padding: 0.5rem 0.75rem;
      }

      .accordion-button {
        font-size: 0.95rem;
        padding: 0.75rem 1rem;
      }

      .btn {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }

      .modal-dialog {
        max-width: 90%;
      }
    }

    /* Mobile Landscape & Small Tablet (576px - 767px) */
    @media (min-width: 576px) and (max-width: 767px) {
      .product-card .card-img-top {
        min-height: 220px;
        max-height: 280px;
      }

      .product-card .card-body {
        padding: 1.4rem;
      }

      .container {
        max-width: 540px;
        padding: 1rem;
      }

      #site-header {
        padding: 0.75rem 1rem;
      }

      .header-main {
        flex-wrap: nowrap;
        gap: 0.75rem;
      }

      .header-main>div:first-child {
        flex: 1 1 auto;
        min-width: 0;
        max-width: calc(100% - 80px);
      }

      .site-header .brand-title {
        font-size: 0.85rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
      }

      .header-actions {
        display: none !important;
      }

      .header-actions-mobile {
        display: flex !important;
        flex-shrink: 0;
      }

      #customizer-panel {
        left: calc(env(safe-area-inset-left) + 12px);
        right: calc(env(safe-area-inset-right) + 12px);
        max-width: calc(100% - 24px);
        padding: 18px;
        top: calc(env(safe-area-inset-top) + 70px);
      }

      #customizer-panel .row {
        --bs-gutter-x: 0.75rem;
        --bs-gutter-y: 0.75rem;
      }

      #customizer-panel .col-md-6 {
        flex: 0 0 100%;
        max-width: 100%;
      }

      .nav-tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      .nav-tabs::-webkit-scrollbar {
        display: none;
      }

      .nav-tabs .nav-link {
        font-size: 0.85rem;
        padding: 0.5rem 0.6rem;
        white-space: nowrap;
      }

      .accordion-button {
        font-size: 0.9rem;
        padding: 0.7rem 0.9rem;
      }

      .icon-btn {
        width: 2.25rem;
        height: 2.25rem;
      }

      #open-code-modal-btn {
        font-size: 0.85rem;
        padding: 0.4rem 0.7rem;
      }

      #open-code-modal-btn span {
        display: none;
      }

      #open-code-modal-btn i {
        margin: 0;
      }

      .modal-dialog {
        max-width: 95%;
        margin: 1rem auto;
      }

      .modal-content {
        border-radius: var(--radius-lg);
      }

      .card {
        margin-bottom: 1rem;
      }

      .product-card {
        margin-bottom: 1.5rem;
      }

      .table {
        font-size: 0.85rem;
      }

      .table th,
      .table td {
        padding: 0.5rem;
      }
    }

    /* Mobile Portrait (< 576px) */
    @media (max-width: 575px) {
      body {
        padding: 0.75rem;
      }

      .container {
        padding: 1rem 0.75rem;
        margin-bottom: 1rem;
      }

      #site-header {
        padding: 0.75rem 1rem;
        border-radius: var(--radius-md);
      }

      .header-main {
        flex-wrap: nowrap;
        gap: 0.5rem;
      }

      .header-main>div:first-child {
        flex: 1 1 auto;
        min-width: 0;
        max-width: calc(100% - 60px);
      }

      .site-header .brand-title {
        font-size: 0.75rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.3;
        max-width: 100%;
      }

      .mobile-menu-btn {
        flex-shrink: 0;
        min-width: 44px;
      }

      .site-logo-icon {
        flex-shrink: 0;
        font-size: 1.5rem;
        width: 1.5rem;
        height: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header-actions-mobile {
        flex-shrink: 0;
        min-width: 44px;
      }

      .header-actions {
        display: none !important;
      }

      #open-code-modal-btn-mobile {
        padding: 0.4rem 0.6rem;
        font-size: 0.85rem;
      }

      .icon-btn {
        width: 2rem;
        height: 2rem;
        font-size: 0.9rem;
      }

      .icon-btn i {
        font-size: 1rem;
      }

      #open-code-modal-btn {
        font-size: 0.8rem;
        padding: 0.35rem 0.6rem;
        flex: 1;
        min-width: auto;
      }

      #open-code-modal-btn span {
        font-size: 0.75rem;
      }

      #customizer-panel {
        left: calc(env(safe-area-inset-left) + 8px);
        right: calc(env(safe-area-inset-right) + 8px);
        max-width: calc(100% - 16px);
        padding: 16px;
        top: calc(env(safe-area-inset-top) + 60px);
        max-height: calc(100vh - env(safe-area-inset-top) - 100px);
        z-index: 1051;
      }

      #customizer-backdrop {
        z-index: 1050;
      }

      /* Prevent body scroll when customizer is open on mobile */
      body.customizer-open {
        overflow: hidden;
        position: fixed;
        width: 100%;
        height: 100%;
      }

      /* Ensure customizer panel doesn't cover important content */
      #customizer-panel {
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      }

      #customizer-panel .row {
        --bs-gutter-x: 0.5rem;
        --bs-gutter-y: 0.75rem;
      }

      #customizer-panel .col-md-6,
      #customizer-panel .col-lg-4 {
        flex: 0 0 100%;
        max-width: 100%;
      }

      #customizer-panel label {
        font-size: 0.85rem;
        margin-bottom: 0.4rem;
      }

      #customizer-panel .form-control,
      #customizer-panel .form-select {
        font-size: 0.9rem;
        padding: 0.6rem 0.75rem;
      }

      .nav-tabs {
        overflow-x: auto;
        flex-wrap: nowrap;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        margin-bottom: 1rem;
      }

      .nav-tabs::-webkit-scrollbar {
        display: none;
      }

      .nav-tabs .nav-link {
        font-size: 0.8rem;
        padding: 0.5rem 0.5rem;
        white-space: nowrap;
        min-width: fit-content;
      }

      .nav-tabs .nav-link span {
        font-size: 0.75rem;
      }

      .tab-content {
        padding: 0.5rem 0;
      }

      .accordion-item {
        margin-bottom: 0.75rem;
      }

      .accordion-button {
        font-size: 0.85rem;
        padding: 0.7rem 0.8rem;
      }

      .accordion-body {
        padding: 1rem 0.75rem;
      }

      .form-control,
      .form-select {
        font-size: 0.9rem;
        padding: 0.6rem 0.75rem;
      }

      .form-label {
        font-size: 0.85rem;
        margin-bottom: 0.4rem;
      }

      .btn {
        padding: 0.5rem 0.9rem;
        font-size: 0.85rem;
      }

      .btn-sm {
        padding: 0.35rem 0.6rem;
        font-size: 0.8rem;
      }

      .modal-dialog {
        max-width: 95%;
        margin: 0.5rem auto;
      }

      .modal-content {
        border-radius: var(--radius-lg);
      }

      .modal-header,
      .modal-body,
      .modal-footer {
        padding: 1rem 0.75rem;
      }

      .modal-title {
        font-size: 1rem;
      }

      .card {
        margin-bottom: 1rem;
      }

      .product-card {
        margin-bottom: 1.5rem;
      }

      .product-card .card-img-top {
        min-height: 200px !important;
        max-height: 260px !important;
        padding: 0.75rem !important;
      }

      .product-card .card-img-top .product-img {
        width: 100% !important;
        height: auto !important;
        max-height: 100% !important;
        max-width: 100% !important;
        object-fit: contain !important;
        object-position: center !important;
        display: block !important;
      }

      .product-card .card-body {
        padding: 1.25rem !important;
      }

      .product-card .card-title {
        font-size: 1.1rem !important;
        margin-bottom: 0.5rem !important;
      }

      .product-card .card-text {
        font-size: 0.875rem !important;
        margin-bottom: 1rem !important;
      }

      .product-card .h5 {
        font-size: 1.4rem !important;
      }

      .product-card .btn {
        padding: 0.6rem 1rem !important;
        font-size: 0.85rem !important;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .product-card .d-flex.justify-content-between {
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .product-card .h5 {
        word-break: break-word;
      }

      .card-body {
        padding: 1rem 0.75rem;
      }

      .card-header {
        padding: 0.75rem;
        font-size: 0.9rem;
      }

      .product-card {
        margin-bottom: 1.5rem;
      }

      .table {
        font-size: 0.8rem;
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .table th,
      .table td {
        padding: 0.5rem 0.4rem;
        white-space: nowrap;
      }

      .table-responsive {
        border-radius: var(--radius-sm);
      }

      .alert {
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
      }

      #qr-preview {
        padding: 16px;
        margin: 1rem 0;
      }

      #qr-preview canvas,
      #qr-preview svg {
        max-width: 100%;
      }

      .accordion-qr {
        max-width: 100%;
        padding: 12px;
      }

      .img-preview {
        max-width: 100%;
        max-height: 150px;
      }

      .card-attachment {
        padding: 8px;
        margin: 4px;
      }

      .card-attachment img {
        width: 36px;
        height: 36px;
      }

      .dropdown-menu {
        font-size: 0.85rem;
        padding: 0.4rem;
      }

      .dropdown-item {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
      }

      .toast {
        font-size: 0.85rem;
        max-width: calc(100% - 2rem);
      }

      footer {
        padding: 1rem 0;
        font-size: 0.8rem;
      }

      .list-group-item {
        padding: 0.6rem 0.75rem;
        font-size: 0.85rem;
      }

      .input-group {
        flex-wrap: wrap;
      }

      .input-group .form-control {
        flex: 1 1 100%;
        margin-bottom: 0.5rem;
      }

      .input-group-text {
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
      }
    }

    /* Extra Small Mobile (< 400px) */
    @media (max-width: 399px) {
      body {
        padding: 0.5rem;
      }

      .container {
        padding: 0.75rem 0.5rem;
      }

      #site-header {
        padding: 0.5rem;
      }

      .site-header .brand-title {
        font-size: 0.75rem;
      }

      .icon-btn {
        width: 1.75rem;
        height: 1.75rem;
      }

      .product-card .card-img-top {
        min-height: 180px !important;
        max-height: 220px !important;
        padding: 0.5rem !important;
      }

      .product-card .card-body {
        padding: 1rem !important;
      }

      .product-card .card-title {
        font-size: 1rem !important;
      }

      .product-card .card-text {
        font-size: 0.8rem !important;
      }

      .product-card .h5 {
        font-size: 1.2rem !important;
      }

      .product-card .btn {
        padding: 0.5rem 0.75rem !important;
        font-size: 0.8rem !important;
      }

      .icon-btn i {
        font-size: 0.9rem;
      }

      #open-code-modal-btn {
        font-size: 0.75rem;
        padding: 0.3rem 0.5rem;
      }

      .nav-tabs .nav-link {
        font-size: 0.75rem;
        padding: 0.4rem 0.4rem;
      }

      .accordion-button {
        font-size: 0.8rem;
        padding: 0.6rem 0.7rem;
      }

      .btn {
        padding: 0.45rem 0.75rem;
        font-size: 0.8rem;
      }

      #customizer-panel {
        padding: 12px;
      }

      .modal-dialog {
        max-width: 98%;
        margin: 0.25rem auto;
      }
    }

    /* Landscape Orientation */
    @media (orientation: landscape) and (max-height: 600px) {
      #site-header {
        padding: 0.4rem 0.75rem;
      }

      #customizer-panel {
        max-height: calc(100vh - env(safe-area-inset-top) - 60px);
        top: calc(env(safe-area-inset-top) + 50px);
      }

      .nav-tabs {
        margin-bottom: 0.75rem;
      }

      .accordion-button {
        padding: 0.5rem 0.75rem;
      }
    }

    /* Touch-friendly improvements for mobile */
    @media (hover: none) and (pointer: coarse) {

      .btn,
      .icon-btn,
      .nav-link,
      .accordion-button,
      .dropdown-item {
        min-height: 44px;
        min-width: 44px;
      }

      .form-control,
      .form-select {
        min-height: 44px;
      }

      .card-attachment {
        min-height: 50px;
      }
    }

    /* High DPI displays optimization */
    @media (-webkit-min-device-pixel-ratio: 2),
    (min-resolution: 192dpi) {

      .site-logo-icon,
      .gender-icon {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
      }
    }

    /* Print styles */
    @media print {

      #site-header,
      #customizer-panel,
      .header-actions,
      .nav-tabs,
      .btn:not(.print-keep),
      footer {
        display: none !important;
      }

      .container {
        box-shadow: none;
        border: none;
        padding: 0;
        background: transparent;
      }

      #qr-preview {
        box-shadow: none;
        padding: 0;
        background: transparent;
      }

      body {
        background: white;
      }
    }

    @keyframes slideDown {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    #toggle-customizer-btn {
      transition: all var(--transition-base);
    }

    #toggle-customizer-btn:hover {
      transform: rotate(90deg);
      box-shadow: var(--shadow-md);
    }

    .qr-logo-note {
      font-size: 0.8rem;
      color: #6c757d;
      margin-top: 5px;
    }

    /* QR ØªØªÙƒÙŠÙ‘Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§ÙˆÙŠØ© (Container) - Modern */
    #qr-preview {
      display: inline-block;
      max-width: 100%;
      height: auto;
      padding: 24px;
      background: white;
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      transition: all var(--transition-base);
    }

    #qr-preview:hover {
      box-shadow: var(--shadow-xl);
      transform: translateY(-4px);
    }

    #qr-preview canvas,
    #qr-preview svg {
      max-width: 100%;
      height: auto;
      border-radius: var(--radius-md);
    }

    /* Ø§Ù„ÙÙˆØªØ± - Modern */
    footer {
      margin-top: 3rem;
      padding: 2rem 0;
      border-top: 2px solid rgba(0, 0, 0, 0.08);
      background: linear-gradient(135deg, rgba(248, 249, 250, 0.8) 0%, rgba(233, 236, 239, 0.8) 100%);
      backdrop-filter: blur(10px);
      border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    }

    /* Container - Modern */
    .container {
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(20px);
      border-radius: var(--radius-xl);
      padding: 2rem;
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(255, 255, 255, 0.18);
      margin-bottom: 2rem;
    }

    @media (max-width: 991px) {
      .container {
        padding: 1.5rem;
      }
    }

    @media (max-width: 767px) {
      .container {
        padding: 1rem;
      }
    }

    @media (max-width: 575px) {
      .container {
        padding: 0.75rem;
      }
    }

    /* Icon Buttons - Modern */
    .icon-btn {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
      transition: all var(--transition-base);
      box-shadow: var(--shadow-sm);
      background: white;
    }

    .icon-btn i {
      font-size: 1.1rem;
    }

    .icon-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: var(--shadow-md);
    }

    .icon-btn:active {
      transform: translateY(-1px) scale(0.98);
      box-shadow: var(--shadow-sm);
    }

    html,
    body {
      min-height: 100%;
    }

    body {
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
    @media (max-width: 576px) {
      #site-header {
        font-size: .95rem
      }

      #main-title {
        font-size: clamp(1rem, 4vw, 1.35rem)
      }
    }

    #site-header .brand {
      gap: .5rem;
    }

    /* Ø¯Ø¹Ù… landscape Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù‚ØµÙŠØ±Ø© */
    @media (orientation: landscape) and (max-height: 480px) {

      #qr-preview canvas,
      #qr-preview svg {
        max-width: 70vw;
        height: auto;
      }

      #customizer-panel {
        top: calc(env(safe-area-inset-top) + 50px);
        max-height: calc(100vh - env(safe-area-inset-top) - 60px);
      }

      #site-header {
        padding: 0.4rem 0.75rem;
      }
    }

    /* Ø§Ø­ØªØ±Ø§Ù… ØªÙØ¶ÙŠÙ„ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: .01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: .01ms !important
      }
    }

    /* Ø²Ø± Ù„ØºØ©/Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¯Ø§Ø¦Ø±ÙŠØ© ØµØºÙŠØ±Ø© */
    .icon-btn {
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 50%;
      padding: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
      transition: transform .25s ease, box-shadow .25s ease
    }

    .icon-btn i {
      font-size: 1.1rem
    }

    .icon-btn:hover {
      transform: translateY(-2px)
    }

    .icon-btn:active {
      transform: translateY(0) scale(.98)
    }

    .animate-spin-90 {
      animation: spin90 .45s ease
    }

    .animate-pop {
      animation: pop .35s cubic-bezier(.2, .8, .2, 1)
    }

    @keyframes spin90 {
      from {
        transform: rotate(0)
      }

      to {
        transform: rotate(90deg)
      }
    }

    @keyframes pop {
      0% {
        transform: scale(.9)
      }

      70% {
        transform: scale(1.03)
      }

      100% {
        transform: scale(1)
      }
    }

    /* Header Pro - Modern */
    #site-header {
      position: sticky;
      top: calc(8px + env(safe-area-inset-top));
      z-index: 1030;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: 1rem 1.25rem;
      box-shadow: var(--shadow-lg);
      transition: all var(--transition-base);
      overflow: visible !important;
    }

    #site-header:hover {
      box-shadow: var(--shadow-xl);
      transform: translateY(-2px);
    }

    #site-header .brand {
      gap: .75rem;
    }

    #site-header .controls .icon-btn {
      min-width: 2.5rem;
    }

    @media (max-width: 576px) {
      #site-header .h5 {
        font-size: .95rem;
      }

      #open-code-modal-btn {
        padding: .4rem .7rem;
        font-size: 0.9rem;
      }
    }

    .site-header {
      position: sticky;
      top: calc(8px + env(safe-area-inset-top));
      z-index: 1030;
      padding: 1rem 1.25rem;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      transition: all var(--transition-base);
      overflow: visible !important;
    }

    .site-header:hover {
      box-shadow: var(--shadow-xl);
    }

    .header-main {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      flex-wrap: nowrap;
      overflow: visible !important;
    }

    .header-main>div:first-child {
      flex: 1 1 auto;
      min-width: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      overflow: hidden;
    }

    .header-main .brand-title {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 0 1 auto;
      min-width: 0;
    }

    .header-actions,
    .header-actions-mobile {
      flex: 0 0 auto;
      flex-shrink: 0;
      position: relative;
      overflow: visible !important;
    }

    .header-actions .dropdown {
      position: relative;
      overflow: visible !important;
    }

    /* Mobile Menu Styles */
    .mobile-menu-btn {
      color: var(--text, #0b306e);
      text-decoration: none;
      border: none;
      background: transparent;
      transition: all var(--transition-base);
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mobile-menu-btn:hover {
      color: var(--primary, #0d6efd);
      transform: scale(1.1);
    }

    .mobile-menu-btn:focus {
      box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
      border-radius: var(--radius-sm);
    }

    .mobile-menu {
      margin-top: 1rem;
      padding-top: 0;
      border-top: 1px solid var(--glass-border);
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1),
        padding 0.4s cubic-bezier(0.4, 0, 0.2, 1),
        opacity 0.3s ease;
      opacity: 0;
    }

    .mobile-menu.show {
      max-height: 600px;
      padding-top: 1rem;
      opacity: 1;
    }

    .mobile-menu-content {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .mobile-menu-item {
      padding: 0.75rem 1rem;
      background: rgba(255, 255, 255, 0.5);
      border-radius: var(--radius-md);
      transition: all var(--transition-base);
      border: 1px solid transparent;
      margin-bottom: 0.5rem;
    }

    .mobile-menu-item:last-child {
      margin-bottom: 0;
    }

    .mobile-menu-item:hover,
    .mobile-menu-item:active {
      background: rgba(255, 255, 255, 0.9);
      border-color: var(--glass-border);
      transform: translateX(4px);
      box-shadow: var(--shadow-sm);
    }

    .mobile-menu-item .btn-link {
      color: var(--text, #0b306e);
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      width: 100%;
      min-height: 44px;
    }

    .mobile-menu-item .btn-link:hover {
      color: var(--primary, #0d6efd);
    }

    .mobile-menu-item .gender-icon {
      font-size: 1.5rem;
      margin-right: 0.5rem;
    }

    .header-actions-mobile .btn {
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .site-header .brand-title {
      font-weight: 800;
      letter-spacing: .3px;
      font-size: clamp(0.85rem, 2.4vw, 1.2rem);
      color: var(--text, #0b306e);
      background: linear-gradient(135deg, var(--text, #0b306e) 0%, var(--primary, #0d6efd) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .site-logo {
      width: 36px;
      height: 36px;
      object-fit: contain;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
      transition: transform var(--transition-base);
    }

    .site-logo:hover {
      transform: rotate(5deg) scale(1.1);
    }

    .gender-icon {
      font-size: 1.8rem;
      transition: all var(--transition-base);
      cursor: pointer;
    }

    .gender-icon:hover {
      transform: scale(1.15) rotate(5deg);
    }

    @media (max-width: 576px) {
      .site-header {
        padding: .75rem 1rem;
      }

      .site-header .brand-title {
        max-width: 52vw;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    }

    .site-logo-icon {
      font-size: 36px;
      line-height: 1;
      display: inline-flex;
      width: 36px;
      height: 36px;
      align-items: center;
      justify-content: center;
      color: var(--primary, #0d6efd);
      background: linear-gradient(135deg, var(--primary, #0d6efd) 0%, #0a58ca 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 2px 4px rgba(13, 110, 253, 0.3));
      transition: all var(--transition-base);
    }

    .site-logo-icon:hover {
      transform: scale(1.1) rotate(5deg);
    }

    /* Smooth Scrolling */
    html {
      scroll-behavior: smooth;
    }

    /* Modern Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
      border-radius: 10px;
      transition: background var(--transition-base);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #0a58ca 0%, #084298 100%);
    }

    /* Loading Animation */
    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .loading {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Fade In Animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    /* Accordion Item Modern */
    .accordion-item {
      border-radius: var(--radius-md);
      margin-bottom: 1rem;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .accordion-item:hover {
      box-shadow: var(--shadow-md);
      transform: translateX(-4px);
    }

    /* Input Group Modern */
    .input-group {
      box-shadow: var(--shadow-sm);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .input-group .form-control {
      border: none;
      box-shadow: none;
    }

    .input-group .form-control:focus {
      box-shadow: none;
      transform: none;
    }

    /* Dropdown Modern */
    .dropdown-menu {
      border-radius: var(--radius-md);
      border: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: var(--shadow-lg);
      padding: 0.5rem;
      margin-top: 0.5rem;
      z-index: 1050 !important;
      position: absolute !important;
    }

    .dropdown-item {
      border-radius: var(--radius-sm);
      padding: 0.6rem 1rem;
      transition: all var(--transition-fast);
    }

    .dropdown-item:hover {
      background: linear-gradient(135deg, rgba(13, 110, 253, 0.1) 0%, rgba(13, 110, 253, 0.05) 100%);
      transform: translateX(-4px);
    }

    /* Toast Modern */
    .toast {
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      border: 1px solid rgba(0, 0, 0, 0.05);
      backdrop-filter: blur(10px);
    }

    /* List Group Modern */
    .list-group-item {
      border-radius: var(--radius-sm);
      margin-bottom: 0.5rem;
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: all var(--transition-fast);
    }

    .list-group-item:hover {
      background: rgba(13, 110, 253, 0.05);
      transform: translateX(-4px);
      box-shadow: var(--shadow-sm);
    }

    /* Modern Subscription UI Styles */
    .subscription-card-modern {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .subscription-header-modern {
      padding-bottom: 1.25rem;
      border-bottom: 2px solid rgba(0, 0, 0, 0.06);
      margin-bottom: 1.25rem;
    }

    .subscription-status-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    .subscription-status-label {
      font-size: 0.75rem;
      color: #6c757d;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.25rem;
    }

    .subscription-status-value {
      font-size: 1rem;
    }

    .status-badge-modern {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.875rem;
      letter-spacing: 0.3px;
      background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
    }

    .status-badge-modern.bg-success,
    .status-badge-modern.active {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      box-shadow: 0 2px 12px rgba(72, 187, 120, 0.4);
    }

    .status-badge-modern.bg-danger,
    .status-badge-modern.expired {
      background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
      box-shadow: 0 2px 12px rgba(245, 101, 101, 0.4);
    }

    .btn-modern-subscription {
      background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
      border: none;
      color: white;
      padding: 0.625rem 1.25rem;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.875rem;
      box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .subscription-validity-modern {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      padding: 1rem;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .subscription-icon-modern {
      color: #667eea;
      font-size: 1.125rem;
    }

    .subscription-label-modern {
      font-size: 0.875rem;
      color: #6c757d;
      font-weight: 600;
    }

    .subscription-date-modern {
      font-size: 1.25rem;
      font-weight: 700;
      color: #2d3748;
      margin-top: 0.5rem;
    }

    .subscription-details-modern {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .subscription-details-header {
      font-size: 1.125rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid rgba(0, 0, 0, 0.06);
      display: flex;
      align-items: center;
    }

    .subscription-details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }

    .subscription-detail-card {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      border-radius: 12px;
      padding: 1.25rem;
      border: 1px solid rgba(0, 0, 0, 0.06);
      position: relative;
      overflow: hidden;
    }

    .subscription-detail-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .subscription-detail-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.125rem;
      margin-bottom: 0.75rem;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
    }

    .subscription-detail-label {
      font-size: 0.75rem;
      color: #6c757d;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }

    .subscription-detail-value {
      font-size: 1rem;
      font-weight: 700;
      color: #2d3748;
      word-break: break-word;
    }

    @media (max-width: 768px) {
      .subscription-details-grid {
        grid-template-columns: 1fr;
      }

      .subscription-card-modern {
        padding: 1rem;
      }

      .subscription-status-icon {
        width: 48px;
        height: 48px;
        font-size: 1.25rem;
      }
    }

    /* Range Input Modern */
    .form-range::-webkit-slider-thumb {
      background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-base);
    }

    .form-range::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: var(--shadow-lg);
    }

    /* Select Modern */
    .form-select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: left 0.75rem center;
      background-size: 16px 12px;
    }

    /* Focus Visible */
    *:focus-visible {
      outline: 2px solid var(--primary, #0d6efd);
      outline-offset: 2px;
      border-radius: var(--radius-sm);
    }
  </style>
</head>

<body class="p-4 transition">

  <!-- Modal ØªØ­Ø°ÙŠØ± -->
  <div class="modal fade" id="alertModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static"
    data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center">
        <div class="modal-header">
          <h5 class="modal-title w-100">
            <i class="bi bi-exclamation-triangle text-warning"></i> <span id="modal-alert-title">ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…</span>
          </h5>
        </div>
        <div class="modal-body">
          <div class="fs-5 mb-3" id="modal-alert-body">
            ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù‚Ø¨Ù„ ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² QR.<br>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ø¹Ù„Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©.
          </div>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary px-4" data-bs-dismiss="modal" id="accept-warning"><span
              id="modal-alert-button">Ù…ÙˆØ§ÙÙ‚</span></button>
        </div>
      </div>
    </div>
  </div>

  <div class="container position-relative">
    <!-- Backdrop overlay for customizer -->
    <div id="customizer-backdrop"></div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ®ØµÙŠØµ -->
    <div id="customizer-panel">
      <div class="mb-3 fw-bold"><i class="bi bi-palette"></i> <span id="customizer-title">ØªØ®ØµÙŠØµ Ø±Ù…Ø² QR</span></div>

      <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®ØµÙŠØµ - Grid Layout -->
      <div class="row g-3">
        <div class="col-12 col-sm-6 col-md-6 col-lg-4">
          <div class="mb-2">
            <label id="label-dots-color">Ù„ÙˆÙ† Ø§Ù„Ù†Ù‚Ø§Ø·:</label>
            <div id="pickr-dots"></div>
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-6 col-lg-4">
          <div class="mb-2">
            <label id="label-bg-color">Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©:</label>
            <div id="pickr-bg"></div>
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-6 col-lg-4">
          <div class="mb-2">
            <label id="label-dots-type">Ø´ÙƒÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·:</label>
            <select id="dots-type" class="form-select">
              <option value="rounded">Ù…Ø³ØªØ¯ÙŠØ±</option>
              <option value="dots">Ù…Ù†Ù‚Ø·</option>
              <option value="classy">ÙƒÙ„Ø§Ø³ÙŠÙƒ</option>
              <option value="square">Ù…Ø±Ø¨Ø¹</option>
              <option value="extra-rounded">Ù…Ø³ØªØ¯ÙŠØ± Ø¬Ø¯Ø§Ù‹</option>
            </select>
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-6 col-lg-4">
          <div class="mb-2">
            <label id="label-ecc">ØªØµØ­ÙŠØ­ Ø§Ù„Ø®Ø·Ø£ (ECC):</label>
            <select id="qr-ecc" class="form-select">
              <option value="L">L (Ø£Ù‚Ù„)</option>
              <option value="M" selected>M</option>
              <option value="Q">Q</option>
              <option value="H">H (Ø£Ø¹Ù„Ù‰)</option>
            </select>
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-6 col-lg-4">
          <div class="mb-2">
            <label id="label-export-type">Ù†ÙˆØ¹ Ø§Ù„ØªØµØ¯ÙŠØ±:</label>
            <select id="qr-type" class="form-select">
              <option value="canvas" selected>Canvas</option>
              <option value="svg">SVG</option>
            </select>
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-6 col-lg-4">
          <div class="mb-2">
            <label id="label-margin">Ø§Ù„Ø­ÙˆØ§Ù (Quiet Zone):</label>
            <input type="number" id="qr-margin" class="form-control" value="4" min="0" max="32">
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-6 col-lg-4">
          <div class="mb-3">
            <label id="label-qr-size">Ø­Ø¬Ù… QR:</label>
            <input type="range" min="240" max="560" value="500" id="qr-size" class="form-range">
          </div>
        </div>

        <div class="col-12 col-sm-6 col-md-6 col-lg-4">
          <div class="mb-3 qr-logo-row">
            <label id="label-logo">Ø¥Ø¶Ø§ÙØ© Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ÙŠ:</label>
            <input type="file" id="qr-logo" class="form-control" disabled>
            <div class="qr-logo-note" id="logo-note">Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
          </div>
        </div>
      </div>

      <button class="btn btn-outline-secondary w-100 mt-3" id="close-customizer"><span
          id="close-customizer-text">Ø¥ØºÙ„Ø§Ù‚</span></button>
    </div>

    <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
    <header id="site-header" class="site-header mb-3">
      <div class="header-main d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-2">
          <button id="mobile-menu-toggle" class="btn btn-link d-lg-none p-0 me-2 mobile-menu-btn" aria-label="Menu">
            <i class="bi bi-list" style="font-size: 1.5rem;"></i>
          </button>
          <i id="site-logo" class="bi bi-qr-code site-logo-icon" aria-hidden="true"></i>
          <span class="brand-title" id="main-title-header">QR Ø§Ø­ØªØ±Ø§ÙÙŠ | Professional QR Code Generator</span>
        </div>

        <div class="header-actions d-flex align-items-center gap-2 d-none d-lg-flex">
          <span id="gender-icon" class="gender-icon"><i class="bi bi-gender-ambiguous"></i></span>

          <div class="dropdown" style="position: relative;">
            <button class="btn btn-outline-secondary dropdown-toggle icon-btn" id="styleMenuBtn"
              data-bs-toggle="dropdown" aria-expanded="false" aria-label="ØªØºÙŠÙŠØ± Ø§Ù„Ø³ØªØ§ÙŠÙ„" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø³ØªØ§ÙŠÙ„">
              <i class="bi bi-person-gear"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" style="z-index: 1050; position: absolute;">
              <li><button class="dropdown-item" data-style="male">Ø³ØªØ§ÙŠÙ„ Ø±Ø¬Ø§Ù„ÙŠ ğŸ‘¨</button></li>
              <li><button class="dropdown-item" data-style="female">Ø³ØªØ§ÙŠÙ„ Ù†Ø³Ø§Ø¦ÙŠ ğŸ‘©</button></li>
              <li><button class="dropdown-item" data-style="neutral">Ø³ØªØ§ÙŠÙ„ Ù…Ø­Ø§ÙŠØ¯ğŸ‘©</button></li>
            </ul>
          </div>

          <button id="toggle-customizer-btn" class="btn btn-outline-secondary icon-btn" aria-label="Customize QR"
            title="Customize QR">
            <i class="bi bi-gear"></i>
          </button>

          <button id="toggle-bilingual" class="btn btn-outline-info icon-btn" aria-label="Bilingual Mode"
            title="Bilingual Mode" data-bilingual="true">
            <i class="bi bi-translate"></i>
          </button>

          <button id="toggle-lang" class="btn btn-outline-primary icon-btn" aria-label="English" title="English">
            <i class="bi bi-globe"></i>
          </button>

          <button id="open-code-modal-btn" class="btn btn-dark" style="white-space: nowrap;">
            <i class="bi bi-key"></i> <span id="enter-code-text">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯</span>
          </button>

          <a href="owner-panel.html?tab=products" class="btn btn-outline-success icon-btn" aria-label="Products"
            title="Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª | Products">
            <i class="bi bi-bag"></i>
          </a>
        </div>

        <!-- Mobile: Show only essential buttons -->
        <div class="header-actions-mobile d-flex align-items-center gap-2 d-lg-none">
          <button id="open-code-modal-btn-mobile" class="btn btn-dark btn-sm">
            <i class="bi bi-key"></i>
          </button>
          <a href="owner-panel.html?tab=products" class="btn btn-outline-success btn-sm" aria-label="Products"
            title="Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª | Products">
            <i class="bi bi-bag"></i>
          </a>
        </div>
      </div>

      <!-- Mobile Menu (Collapsible) -->
      <div id="mobile-menu" class="mobile-menu collapse">
        <div class="mobile-menu-content">
          <div class="mobile-menu-item">
            <span id="gender-icon-mobile" class="gender-icon"><i class="bi bi-gender-ambiguous"></i></span>
            <span class="ms-2">Gender Style</span>
          </div>

          <div class="mobile-menu-item">
            <button class="btn btn-link w-100 text-start p-0" id="styleMenuBtn-mobile" data-bs-toggle="dropdown">
              <i class="bi bi-person-gear me-2"></i>
              <span>Style Options</span>
              <i class="bi bi-chevron-down float-end"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end w-100">
              <li><button class="dropdown-item" data-style="male">Ø³ØªØ§ÙŠÙ„ Ø±Ø¬Ø§Ù„ÙŠ ğŸ‘¨</button></li>
              <li><button class="dropdown-item" data-style="female">Ø³ØªØ§ÙŠÙ„ Ù†Ø³Ø§Ø¦ÙŠ ğŸ‘©</button></li>
              <li><button class="dropdown-item" data-style="neutral">Ø³ØªØ§ÙŠÙ„ Ù…Ø­Ø§ÙŠØ¯ğŸ‘©</button></li>
            </ul>
          </div>

          <div class="mobile-menu-item">
            <button id="toggle-customizer-btn-mobile" class="btn btn-link w-100 text-start p-0">
              <i class="bi bi-gear me-2"></i>
              <span id="customize-text-mobile">Customize QR</span>
            </button>
          </div>

          <div class="mobile-menu-item">
            <button id="toggle-bilingual-mobile" class="btn btn-link w-100 text-start p-0">
              <i class="bi bi-translate me-2"></i>
              <span id="bilingual-text-mobile">Bilingual Mode</span>
            </button>
          </div>

          <div class="mobile-menu-item">
            <button id="toggle-lang-mobile" class="btn btn-link w-100 text-start p-0">
              <i class="bi bi-globe me-2"></i>
              <span id="lang-text-mobile">Switch Language</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ¨ÙŠØ± Ù…Ø®ÙÙŠ Ø¨ØµØ±ÙŠÙ‹Ø§ (Ù„Ù€ SEO ÙÙ‚Ø·) -->
    <h1 class="mb-3 visually-hidden" id="main-title">Ù…ÙˆÙ„Ø¯ Ø±Ù…Ø² QR Ø§Ø­ØªØ±Ø§ÙÙŠ | Professional QR Code Generator</h1>

    <!-- ØªÙ†Ø¨ÙŠÙ‡ -->
    <div class="p-3 text-primary-emphasis bg-primary-subtle border border-primary-subtle rounded-3 mb-3"
      id="info-alert">
      <i class="bi bi-info-circle me-1"></i>
      <span id="alert-text">Ù…ÙˆÙ„Ø¯ Ø±Ù…Ø² QR Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§ØªØŒ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.<br>Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¨Ø¯ÙˆÙ† Ø²Ø±
        ØªÙˆÙ„ÙŠØ¯.</span>
    </div>
    <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
    <ul class="nav nav-tabs mb-3" id="dataTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="text-tab" data-bs-toggle="tab" data-bs-target="#text-pane" type="button"
          role="tab"><span id="tab-text">Ù†Øµ | Text</span></button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="url-tab" data-bs-toggle="tab" data-bs-target="#url-pane" type="button"
          role="tab"><span id="tab-url">Ø±Ø§Ø¨Ø· | URL</span></button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="wifi-tab" data-bs-toggle="tab" data-bs-target="#wifi-pane" type="button"
          role="tab"><span id="tab-wifi">ÙˆØ§ÙŠ ÙØ§ÙŠ | Wi Fi</span></button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="vcard-tab" data-bs-toggle="tab" data-bs-target="#vcard-pane" type="button"
          role="tab"><span id="tab-vcard">Ø¨Ø·Ø§Ù‚Ø© ØªÙˆØ§ØµÙ„ | vCard</span></button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="social-tab" data-bs-toggle="tab" data-bs-target="#social-pane" type="button"
          role="tab"><span id="tab-social">ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ | Social</span></button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products-pane" type="button"
          role="tab">
          <span id="tab-products">Ù…Ù†ØªØ¬Ø§ØªÙŠ | My Products</span>
        </button>
      </li>
    </ul>

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
    <div class="tab-content mb-3" id="dataTabsContent">
      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Øµ -->
      <div class="tab-pane fade show active" id="text-pane" role="tabpanel" aria-labelledby="text-tab">
        <div class="accordion" id="textAccordion">
          <!-- 1) Ù…Ø­ØªÙˆÙ‰ Ø¹Ø§Ù… -->
          <div class="accordion-item custom-accordion-1">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#accordion1">
                <span class="accordion-header-title" id="accordion1-title">1ï¸âƒ£ Ù…Ø­ØªÙˆÙ‰ Ø¹Ø§Ù…</span>
              </button>
            </h2>
            <div id="accordion1" class="accordion-collapse collapse" data-bs-parent="#textAccordion">
              <div class="accordion-body">
                <div class="accordion-content-section">
                  <div class="mb-3" id="accordion1-cards-container"></div>
                  <button id="add-accordion1-card" class="btn btn-sm btn-outline-success mb-3 viewer-hide"
                    data-role="admin-only">
                    <i class="bi bi-plus-circle"></i> <span id="add-card-text">Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø©</span>
                  </button>
                  <button id="save-accordion1" class="btn btn-sm btn-outline-primary ms-2 viewer-hide"
                    data-role="admin-only"><i class="bi bi-save"></i> <span id="save-changes-text">Ø­ÙØ¸
                      Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</span></button>
                  <div class="accordion-qr-container">
                    <div class="accordion-qr" id="accordion-qr-1"></div>
                  </div>
                  <div class="accordion-qr-comment" id="accordion-qr-comment-1"></div>
                  <div class="shared-qr-note"><i class="bi bi-info-circle"></i> <span id="shared-qr-note-text">Ø¬Ù…ÙŠØ¹
                      Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† ØªØ´ØªØ±Ùƒ Ø¨Ù†ÙØ³ Ø±Ù…Ø² QR</span></div>
                </div>
              </div>
            </div>
          </div>

          <!-- 2) ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
          <div class="accordion-item custom-accordion-2">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#accordion2">
                <span class="accordion-header-title" id="accordion2-title">2ï¸âƒ£ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</span>
              </button>
            </h2>
            <div id="accordion2" class="accordion-collapse collapse" data-bs-parent="#textAccordion">
              <div class="accordion-body">
                <div class="accordion-content-section">
                  <div class="mb-3">
                    <label class="form-label fw-bold" id="accordion2-image-label">Ø§Ø®ØªØ± ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <input type="file" class="form-control mb-2 accordion-image" accept="image/*" data-accordion="2">
                    <div class="accordion-image-preview" data-accordion="2"></div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label fw-bold" id="accordion2-text-label">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</label>
                    <textarea class="form-control accordion-text viewer-hide" rows="3" data-role="admin-only"
                      placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..." data-accordion="2"></textarea>
                  </div>
                  <div class="mb-3">
                    <label class="form-label fw-bold" id="accordion2-table-label">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„:</label>
                    <table class="table table-bordered desc-table align-middle mb-0 accordion-table" data-accordion="2">
                      <thead class="table-light">
                        <tr>
                          <th id="desc-th">Ø§Ù„ÙˆØµÙ</th>
                          <th id="detail-th">Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                          <th id="remove-th">Ø­Ø°Ù</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                    <button class="btn btn-sm btn-outline-primary mt-2 accordion-add-row viewer-hide" data-accordion="2"
                      id="add-row-btn" data-role="admin-only">â• <span id="add-row-text">Ø£Ø¶Ù Ø³Ø·Ø±</span></button>
                  </div>
                  <div class="mb-3">
                    <label class="form-label fw-bold" id="accordion2-comment-label">ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR
                      (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <input type="text" class="form-control accordion-comment viewer-hide" data-role="admin-only"
                      placeholder="Ø£Ø¯Ø®Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..." data-accordion="2">
                  </div>
                  <div class="accordion-qr-container">
                    <div class="accordion-qr" id="accordion-qr-2"></div>
                  </div>
                  <div class="accordion-qr-comment" id="accordion-qr-comment-2"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- 3) Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
          <div class="accordion-item custom-accordion-3">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#accordion3">
                <span class="accordion-header-title" id="accordion3-title">3ï¸âƒ£ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</span>
              </button>
            </h2>
            <div id="accordion3" class="accordion-collapse collapse" data-bs-parent="#textAccordion">
              <div class="accordion-body">
                <div class="accordion-content-section">
                  <div class="mb-3">
                    <label class="form-label fw-bold" id="accordion3-comment-label">ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR
                      (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <input type="text" class="form-control accordion-comment" placeholder="Ø£Ø¯Ø®Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..."
                      data-accordion="3">
                  </div>
                  <div class="accordion-qr-container">
                    <div class="accordion-qr" id="accordion-qr-3"></div>
                  </div>
                  <div class="accordion-qr-comment" id="accordion-qr-comment-3"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- 4) Ø§Ø´ØªØ±Ø§ÙƒÙŠ -->
          <div class="accordion-item custom-accordion-4 mt-2">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#accordion4">
                <span class="accordion-header-title" id="accordion4-title">4ï¸âƒ£ Ø§Ø´ØªØ±Ø§ÙƒÙŠ</span>
              </button>
            </h2>
            <div id="accordion4" class="accordion-collapse collapse" data-bs-parent="#textAccordion">
              <div class="accordion-body pt-3">
                <!-- Modern Subscription Card -->
                <div class="subscription-card-modern mb-4">
                  <!-- Status Header -->
                  <div class="subscription-header-modern">
                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                      <div class="d-flex align-items-center gap-3">
                        <div class="subscription-status-icon">
                          <i class="bi bi-shield-check-fill"></i>
                        </div>
                        <div>
                          <div class="subscription-status-label">
                            <span id="status-text">Ø§Ù„Ø­Ø§Ù„Ø© | Status</span>
                          </div>
                          <div class="subscription-status-value">
                            <span id="sub-status-badge" class="status-badge-modern">
                              <span id="unknown-status-text">ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ | Unknown</span>
                            </span>
                          </div>
                        </div>
                      </div>
                      <button class="btn btn-modern-subscription" id="btn-show-sub-toast">
                        <i class="bi bi-bell"></i>
                        <span id="show-subscription-text">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ | Show Alert</span>
                      </button>
                    </div>
                  </div>

                  <!-- Valid Until Section -->
                  <div class="subscription-validity-modern">
                    <div class="d-flex align-items-center gap-2 mb-2">
                      <i class="bi bi-calendar-event subscription-icon-modern"></i>
                      <span class="subscription-label-modern" id="valid-until-text">ØµØ§Ù„Ø­ Ø­ØªÙ‰ | Valid Until</span>
                    </div>
                    <div class="subscription-date-modern" id="sub-until">--/--/----</div>
                  </div>
                </div>

                <!-- Client & Subscription Details -->
                <div class="subscription-details-modern">
                  <div class="subscription-details-header">
                    <i class="bi bi-info-circle me-2"></i>
                    <span id="notifications-text">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ | Subscription Details</span>
                  </div>
                  <div class="subscription-details-grid" id="sub-notifs"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /text-pane -->

      <!-- ØªØ¨ÙˆÙŠØ¨ Ù…Ù†ØªØ¬Ø§ØªÙŠ -->
      <div class="tab-pane fade" id="products-pane" role="tabpanel" aria-labelledby="products-tab">
        <div class="d-flex justify-content-end mb-3">
          <button class="btn btn-light position-relative" id="cartButton">
            <i class="bi bi-cart3 fs-4"></i>
            <span class="cart-badge badge bg-danger rounded-pill">0</span>
          </button>
        </div>

        <div class="accordion" id="productsAccordion">
          <!-- Ø£ÙƒÙˆØ§Ø¯ QR Ø´Ø®ØµÙŠØ© -->
          <div class="accordion-item" id="personal-qr-accordion" style="display: none;">
            <h2 class="accordion-header" id="qrAccordionHeader1">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#qrAccordionBody1">
                <i class="bi bi-qr-code me-2"></i> <span id="your-qr-text">Ø±Ù…Ø² QR Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</span>
              </button>
            </h2>
            <div id="qrAccordionBody1" class="accordion-collapse collapse" data-bs-parent="#productsAccordion">
              <div class="accordion-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                  <h3 class="mb-0"><span id="your-qr-title">Ø±Ù…Ø² QR Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</span></h3>
                </div>
                <div class="row g-4">
                  <div class="col-md-6">
                    <div class="card p-4 text-center qr-code-card border-primary h-100"
                      style="border-width: 2px !important;">
                      <div class="qr-card-header mb-3">
                        <h4 class="mb-2 fw-bold"><span id="admin-code-title">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø±Ù</span></h4>
                      </div>
                      <div class="mb-4">
                        <div class="qr-code-wrapper bg-light p-4 d-inline-block rounded-3 shadow-sm"
                          style="border: 2px solid rgba(13, 110, 253, 0.2);">
                          <img id="myqr-admin-img"
                            src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=ADMIN-CODE-123"
                            alt="QR Code" class="img-fluid" style="max-width: 180px;">
                        </div>
                      </div>
                      <p class="text-muted mb-4" style="line-height: 1.6;"><span id="admin-code-desc">Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯
                          Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©
                          Ø§Ù„ÙƒØ§Ù…Ù„Ø©</span></p>
                      <button class="btn btn-primary mt-2 px-4" data-download-qr data-type="admin"
                        style="border-radius: var(--radius-md); font-weight: 600;">
                        <i class="bi bi-download me-2"></i><span data-i18n="download-qr-text">ØªØ­Ù…ÙŠÙ„ Ø±Ù…Ø²
                          QR</span></button>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card p-4 text-center qr-code-card border-success h-100 mt-4 mt-md-0"
                      style="border-width: 2px !important;">
                      <div class="qr-card-header mb-3">
                        <h4 class="mb-2 fw-bold"><span id="viewer-code-title">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯</span></h4>
                        <span class="badge bg-success viewer-badge px-3 py-2" style="font-size: 0.85rem;">Viewer</span>
                      </div>
                      <div class="mb-4">
                        <div class="qr-code-wrapper bg-light p-4 d-inline-block rounded-3 shadow-sm"
                          style="border: 2px solid rgba(25, 135, 84, 0.2);">
                          <img id="myqr-viewer-img"
                            src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=VIEWER-CODE-456"
                            alt="QR Code" class="img-fluid" style="max-width: 180px;">
                        </div>
                      </div>
                      <p class="text-muted mb-4" style="line-height: 1.6;"><span id="viewer-code-desc">Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯
                          Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ø¹Ø±Ø¶
                          ÙÙ‚Ø·</span></p>
                      <button class="btn btn-success mt-2 px-4" data-download-qr data-type="viewer"
                        style="border-radius: var(--radius-md); font-weight: 600;">
                        <i class="bi bi-download me-2"></i><span id="download-qr-text-2">ØªØ­Ù…ÙŠÙ„ Ø±Ù…Ø² QR</span></button>
                    </div>
                  </div>
                </div>
                <div class="mt-5 pt-4 border-top">
                  <h4 class="mb-4 fw-bold"><span id="share-codes-text">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ù…ÙˆØ²</span></h4>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="d-flex flex-column gap-2">
                        <button class="btn btn-outline-primary w-100" data-copy-link="admin"
                          style="border-radius: var(--radius-md); font-weight: 600;">
                          <i class="bi bi-clipboard me-2"></i><span id="copy-admin-link-text">Ù†Ø³Ø® Ø±Ø§Ø¨Ø·
                            Ø§Ù„Ø£Ø¯Ù…Ù†</span></button>
                        <button class="btn btn-success w-100" data-share-wa="admin"
                          style="border-radius: var(--radius-md); font-weight: 600;">
                          <i class="bi bi-whatsapp me-2"></i> <span id="whatsapp-admin-text">ÙˆØ§ØªØ³Ø§Ø¨ (Ø£Ø¯Ù…Ù†)</span>
                        </button>
                        <button class="btn btn-outline-secondary w-100" data-download-qr data-type="admin"
                          style="border-radius: var(--radius-md); font-weight: 600;">
                          <i class="bi bi-download me-2"></i> <span id="download-admin-text">ØªØ­Ù…ÙŠÙ„ QR (Ø£Ø¯Ù…Ù†)</span>
                        </button>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="d-flex flex-column gap-2">
                        <button class="btn btn-outline-primary w-100" data-copy-link="viewer"
                          style="border-radius: var(--radius-md); font-weight: 600;">
                          <i class="bi bi-clipboard me-2"></i><span id="copy-viewer-link-text">Ù†Ø³Ø® Ø±Ø§Ø¨Ø·
                            Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯</span></button>
                        <button class="btn btn-success w-100" data-share-wa="viewer"
                          style="border-radius: var(--radius-md); font-weight: 600;">
                          <i class="bi bi-whatsapp me-2"></i> <span id="whatsapp-viewer-text">ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø´Ø§Ù‡Ø¯)</span>
                        </button>
                        <button class="btn btn-outline-secondary w-100" data-download-qr data-type="viewer"
                          style="border-radius: var(--radius-md); font-weight: 600;">
                          <i class="bi bi-download me-2"></i> <span id="download-viewer-text">ØªØ­Ù…ÙŠÙ„ QR (Ù…Ø´Ø§Ù‡Ø¯)</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="qrAccordionHeader2">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#qrAccordionBody2">
                <i class="bi bi-credit-card me-2"></i> <span id="subscriptions-text">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</span>
              </button>
            </h2>
            <div id="qrAccordionBody2" class="accordion-collapse collapse" data-bs-parent="#productsAccordion">
              <div class="accordion-body">
                <h3 class="mb-4"><span id="subscription-plans-text">Ø®Ø·Ø· Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</span></h3>

                <div class="row g-4">
                  <!-- 3 Ø£Ø´Ù‡Ø± -->
                  <div class="col-md-4">
                    <div class="subscription-card card h-100">
                      <div class="card-header bg-primary text-white text-center"><span id="sub-3months-text">Ø§Ø´ØªØ±Ø§Ùƒ 3
                          Ø£Ø´Ù‡Ø±</span></div>
                      <div class="card-body text-center">
                        <h4 class="card-title">150 <span data-i18n="currency-text">Ø±ÙŠØ§Ù„</span></h4>
                        <ul class="subscription-features">
                          <li><span id="feature-1-text">Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª</span></li>
                          <li><span id="feature-2-text">Ø±Ù…Ø² QR Ù…Ù…ÙŠØ²</span></li>
                          <li><span id="feature-3-text">Ø¯Ø¹Ù… ÙÙ†ÙŠ 24/7</span></li>
                          <li><span id="feature-4-text">ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø³ØªÙ…Ø±Ø©</span></li>
                        </ul>
                      </div>
                      <div class="card-footer bg-transparent text-center">
                        <button class="btn btn-primary w-100 add-to-cart" data-id="sub-1"><span
                            id="subscribe-now-text">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</span></button>
                      </div>
                    </div>
                  </div>

                  <!-- 6 Ø£Ø´Ù‡Ø± -->
                  <div class="col-md-4">
                    <div class="subscription-card card h-100">
                      <div class="card-header bg-info text-dark text-center"><span id="sub-6months-text">Ø§Ø´ØªØ±Ø§Ùƒ 6
                          Ø£Ø´Ù‡Ø±</span></div>
                      <div class="card-body text-center">
                        <h4 class="card-title">270 <span data-i18n="currency-text">Ø±ÙŠØ§Ù„</span></h4>
                        <p class="text-info"><span id="save-10-text">ÙˆÙØ± 10%</span></p>
                        <ul class="subscription-features">
                          <li><span id="feature-5-text">ÙƒÙ„ Ù…ÙŠØ²Ø§Øª 3 Ø£Ø´Ù‡Ø±</span></li>
                          <li><span id="feature-6-text">ØªØ®Ø²ÙŠÙ† ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯</span></li>
                          <li><span id="feature-7-text">Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¯Ø¹Ù…</span></li>
                        </ul>
                      </div>
                      <div class="card-footer bg-transparent text-center">
                        <button class="btn btn-info w-100 add-to-cart" data-id="sub-2"><span
                            id="subscribe-now-text-2">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</span></button>
                      </div>
                    </div>
                  </div>

                  <!-- Ø³Ù†ÙˆÙŠ -->
                  <div class="col-md-4">
                    <div class="subscription-card card h-100">
                      <div class="card-header bg-warning text-dark text-center"><span id="sub-yearly-text">Ø§Ø´ØªØ±Ø§Ùƒ
                          Ø³Ù†ÙˆÙŠ</span></div>
                      <div class="card-body text-center">
                        <h4 class="card-title">480 <span data-i18n="currency-text">Ø±ÙŠØ§Ù„</span></h4>
                        <p class="text-warning"><span id="save-20-text">ÙˆÙØ± 20%</span></p>
                        <ul class="subscription-features">
                          <li><span id="feature-8-text">ÙƒÙ„ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ 6 Ø£Ø´Ù‡Ø±</span></li>
                          <li><span id="feature-9-text">Ù†Ø·Ø§Ù‚ Ù…Ø®ØµØµ</span></li>
                          <li><span id="feature-10-text">Ù…Ø¯ÙŠØ± Ø­Ø³Ø§Ø¨</span></li>
                        </ul>
                      </div>
                      <div class="card-footer bg-transparent text-center">
                        <button class="btn btn-warning w-100 add-to-cart" data-id="sub-3"><span
                            id="subscribe-now-text-3">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</span></button>
                      </div>
                    </div>
                  </div>
                </div><!-- /.row -->
              </div><!-- /.accordion-body -->
            </div><!-- /.collapse -->
          </div><!-- /.accordion-item -->


          <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="qrAccordionHeader3">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#qrAccordionBody3">
                <i class="bi bi-bag me-2"></i> <span id="products-text">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
              </button>
            </h2>
            <div id="qrAccordionBody3" class="accordion-collapse collapse" data-bs-parent="#productsAccordion">
              <div class="accordion-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                  <h3 class="mb-0"><span id="products-list-text">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span></h3>
                  <div class="text-muted small">
                    <i class="bi bi-info-circle me-1"></i>
                    <span id="products-count-text">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                  </div>
                </div>
                <div class="row mb-4">
                  <div class="col-md-8 col-lg-6">
                    <div class="input-group input-group-lg">
                      <span class="input-group-text bg-white border-end-0">
                        <i class="bi bi-search text-muted"></i>
                      </span>
                      <input type="text" class="form-control border-start-0" id="search-products-input"
                        placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
                      <button class="btn btn-primary" type="button" id="search-products-btn">
                        <i class="bi bi-search me-1"></i>
                        <span id="search-text">Ø¨Ø­Ø«</span>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="row g-4" id="products-container" style="margin-top: 1rem;"><!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø±Ù…Ø¬ÙŠØ§ -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /products-pane -->

      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø±Ø§Ø¨Ø· -->
      <div class="tab-pane fade" id="url-pane" role="tabpanel" aria-labelledby="url-tab">
        <textarea id="qr-input-url" class="form-control" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§..."></textarea>
        <div class="mb-3 tab-comment">
          <label for="url-comment" class="form-label" id="url-comment-label">ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
          <input type="text" id="url-comment" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§...">
        </div>
      </div>

      <!-- ØªØ¨ÙˆÙŠØ¨ WiFi -->
      <div class="tab-pane fade" id="wifi-pane" role="tabpanel" aria-labelledby="wifi-tab">
        <select id="wifi-type" class="form-select mb-2">
          <option value="WPA">WPA/WPA2</option>
          <option value="WEP">WEP</option>
          <option value="nopass">Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</option>
        </select>
        <input id="wifi-ssid" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ© SSID" />
        <input id="wifi-password" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" id="wifi-hidden">
          <label class="form-check-label" for="wifi-hidden"><span id="hidden-network-text">Ø´Ø¨ÙƒØ© Ù…Ø®ÙÙŠØ©</span></label>
        </div>
        <div class="mb-3 tab-comment">
          <label for="wifi-comment" class="form-label" id="wifi-comment-label">ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
          <input type="text" id="wifi-comment" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§...">
        </div>
      </div>

      <!-- ØªØ¨ÙˆÙŠØ¨ vCard -->
      <div class="tab-pane fade" id="vcard-pane" role="tabpanel" aria-labelledby="vcard-tab">
        <input id="vcard-name" class="form-control mb-2" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" />
        <input id="vcard-title" class="form-control mb-2" placeholder="Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" />
        <input id="vcard-email" class="form-control mb-2" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
        <input id="vcard-org" class="form-control mb-2" placeholder="Ø§Ù„Ø´Ø±ÙƒØ© / Ø§Ù„Ù…Ø¤Ø³Ø³Ø©" />
        <input id="vcard-note" class="form-control mb-2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©" />
        <div id="vcard-phones"></div>
        <button id="add-phone" class="btn btn-sm btn-outline-primary mb-2 viewer-hide" data-role="admin-only"><span
            id="btn-add-phone">â• Ø£Ø¶Ù Ø±Ù‚Ù… Ù‡Ø§ØªÙ</span></button>
        <div class="mb-3 tab-comment">
          <label for="vcard-comment" class="form-label" id="vcard-comment-label">ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR
            (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
          <input type="text" id="vcard-comment" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§...">
        </div>
      </div>

      <!-- ØªØ¨ÙˆÙŠØ¨ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ -->
      <div class="tab-pane fade" id="social-pane" role="tabpanel" aria-labelledby="social-tab">
        <div class="shadow-sm p-3 mb-3 bg-body-tertiary rounded">
          <div id="social-accounts" class="mb-2"></div>
          <div class="mb-2 d-flex flex-wrap gap-2">
            <button id="add-social" class="btn btn-sm btn-outline-primary viewer-hide" data-role="admin-only">â• <span
                id="add-social-text">Ø£Ø¶Ù ÙˆØ³ÙŠÙ„Ø© ØªÙˆØ§ØµÙ„</span></button>
            <button id="copy-social" class="btn btn-sm btn-outline-secondary">ğŸ“‹ <span id="copy-all-links-text">Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹
                Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</span></button>
            <button id="generate-social-qrs" class="btn btn-sm btn-outline-success viewer-hide"
              data-role="admin-only">ğŸ”² <span id="generate-qr-text">ØªÙˆÙ„ÙŠØ¯
                QR Ù„ÙƒÙ„ Ø±Ø§Ø¨Ø·</span></button>
            <span id="copy-social-done" class="text-success small align-self-center" style="display:none;">âœ”ï¸ <span
                id="copied-text">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span></span>
          </div>
          <small class="text-muted d-block mb-3"><span id="social-help-text">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙˆØ³ÙŠÙ„Ø© Ø£Ùˆ Ø£ÙƒØ«Ø±ØŒ ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§ ÙˆØ³Ø­Ø¨Ù‡Ø§
              Ø¨Ø­Ø±ÙŠØ©</span></small>
          <div id="social-qrs" class="row gy-3"></div>
        </div>
        <div class="mb-3 tab-comment">
          <label for="social-comment" class="form-label" id="social-comment-label">ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR
            (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
          <input type="text" id="social-comment" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§...">
        </div>
      </div>
    </div><!-- /tab-content -->

    <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© QR Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="border p-3 text-center mb-3 position-relative" id="qr-result-fields" style="display:none;">
      <div id="qr-preview"></div>
      <div id="main-content-preview" class="my-3"></div>
      <div id="qr-comment-show" class="mt-3 text-muted report-comment" aria-live="polite"></div>
      <!-- Ø²Ø± ØªØ­Ù…ÙŠÙ„ QR ÙŠÙØ¶Ø§Ù Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ -->
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ§Ù„Ù…Ø³Ø­ -->
    <div class="d-flex gap-2" id="qr-buttons-fields">
      <button id="btn-report" class="btn btn-outline-info w-100"><i class="bi bi-clipboard-data"></i> <span
          id="btn-report-text">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span></button>
      <button id="clear-btn" class="btn btn-outline-danger w-100"><span id="btn-clear">ğŸ§¹ Ù…Ø³Ø­ ÙƒÙ„
          Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span></button>
    </div>
  </div><!-- /container -->

  <footer id="site-footer" class="text-center p-3 border-top bg-white shadow-sm small">
    &copy; <span id="year"></span> Eg.Future. <span id="rights-reserved-text">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</span>
  </footer>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
  <div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content report-modal-content">
        <div class="modal-header report-modal-header">
          <div class="d-flex align-items-center gap-3">
            <div class="report-icon-wrapper">
              <i class="bi bi-clipboard-data"></i>
            </div>
            <div>
              <h5 class="modal-title mb-0" id="report-title">ØªÙ‚Ø±ÙŠØ± QR | QR Report</h5>
              <small class="text-white-50">Ø¹Ø±Ø¶ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø£ÙƒÙˆØ§Ø¯ QR | Complete QR Codes Overview</small>
            </div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body report-modal-body" id="report-body"></div>
        <div class="modal-footer report-modal-footer">
          <div class="d-flex align-items-center gap-2 flex-wrap">
            <button id="report-pdf" class="btn btn-action-report btn-pdf" title="ØªØ­Ù…ÙŠÙ„ PDF | Download PDF">
              <i class="bi bi-file-earmark-pdf"></i>
              <span class="d-none d-md-inline">PDF</span>
            </button>
            <button id="report-jpg" class="btn btn-action-report btn-jpg" title="ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© | Download Image">
              <i class="bi bi-file-earmark-image"></i>
              <span class="d-none d-md-inline">Image</span>
            </button>
            <button id="report-docx" class="btn btn-action-report btn-docx" title="ØªØ­Ù…ÙŠÙ„ Word | Download Word">
              <i class="bi bi-file-earmark-word"></i>
              <span class="d-none d-md-inline">Word</span>
            </button>
            <button id="report-print" class="btn btn-action-report btn-print" title="Ø·Ø¨Ø§Ø¹Ø© | Print">
              <i class="bi bi-printer"></i>
              <span class="d-none d-md-inline">Print</span>
            </button>
          </div>
          <div class="ms-auto d-flex align-items-center gap-2">
            <span class="text-muted small">Â© Eg.Future</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø³Ù„Ø© -->
  <div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-cart3 me-2"></i><span id="cart-title">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="table table-bordered align-middle">
            <thead>
              <tr>
                <th id="thName">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                <th id="thQty">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                <th id="thPrice">Ø§Ù„Ø³Ø¹Ø±</th>
                <th id="thTotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="cart-modal-body"></tbody>
          </table>
          <div class="text-end fw-bold"><span id="cartTotalTitle">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span> <span id="cart-total">0 Ø±.Ø³</span>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-success" id="checkoutBtn"><span id="complete-purchase-text">Ø¥ØªÙ…Ø§Ù…
              Ø§Ù„Ø´Ø±Ø§Ø¡</span></button>
          <button class="btn btn-secondary" data-bs-dismiss="modal"><span id="close-text">Ø¥ØºÙ„Ø§Ù‚</span></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Method Selection Modal -->
  <div class="modal fade" id="paymentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content" style="border-radius: 20px; overflow: hidden;">
        <div class="modal-header"
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
          <h5 class="modal-title">
            <i class="bi bi-credit-card me-2"></i>
            <span id="payment-title">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ | Choose Payment Method</span>
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <div class="payment-methods">
            <div class="payment-method-card" data-method="bank">
              <div class="payment-icon">
                <i class="bi bi-bank"></i>
              </div>
              <div class="payment-details">
                <h6>Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ | Bank Account</h6>
                <p class="text-muted mb-2" id="bank-account-details">Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</p>
                <div class="bank-info" id="bankInfo" style="display: none;">
                  <p class="mb-1"><strong>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ:</strong> <span id="bankName">-</span></p>
                  <p class="mb-1"><strong>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</strong> <span id="bankAccount">-</span></p>
                  <p class="mb-0"><strong>IBAN:</strong> <span id="bankIBAN">-</span></p>
                </div>
              </div>
              <div class="payment-arrow">
                <i class="bi bi-chevron-left"></i>
              </div>
            </div>

            <div class="payment-method-card" data-method="instagram">
              <div class="payment-icon instagram">
                <i class="bi bi-instagram"></i>
              </div>
              <div class="payment-details">
                <h6>Instagram Pay</h6>
                <p class="text-muted mb-2" id="instagram-pay-details">Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Instagram Pay</p>
                <div class="instagram-info" id="instagramInfo" style="display: none;">
                  <p class="mb-1"><strong>Ø­Ø³Ø§Ø¨ Instagram:</strong> <span id="instagramAccount">-</span></p>
                </div>
              </div>
              <div class="payment-arrow">
                <i class="bi bi-chevron-left"></i>
              </div>
            </div>

            <div class="payment-method-card" data-method="vodafone">
              <div class="payment-icon vodafone">
                <i class="bi bi-phone"></i>
              </div>
              <div class="payment-details">
                <h6>Vodafone Cash</h6>
                <p class="text-muted mb-2" id="vodafone-details">Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Vodafone Cash</p>
                <div class="vodafone-info" id="vodafoneInfo" style="display: none;">
                  <p class="mb-1"><strong>Ø±Ù‚Ù… Vodafone Cash:</strong> <span id="vodafoneNumber">-</span></p>
                </div>
              </div>
              <div class="payment-arrow">
                <i class="bi bi-chevron-left"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer" style="border-top: 1px solid #e9ecef;">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <span id="cancel-payment-text">Ø¥Ù„ØºØ§Ø¡ | Cancel</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ -->
  <div class="modal fade" id="codeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-key"></i> <span id="enter-code-title">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯</span></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label" id="enter-code-label">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</label>
            <input type="text" id="input-code" class="form-control" autocomplete="one-time-code"
              data-viewer-editable="1" />
          </div>
          <div id="code-error" class="text-danger" style="display:none;"></div>
          <div id="code-countdown" class="text-warning" style="display:none;"></div>
          <button id="submit-code" class="btn btn-primary w-100 mt-3"><span id="verify-code-text">ØªØ­Ù‚Ù‚ Ù…Ù†
              Ø§Ù„ÙƒÙˆØ¯</span></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø­Ø§ÙˆÙŠØ© Toasts -->
  <div id="liveToastContainer" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- Ù…ÙƒØªØ¨Ø§Øª JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>
  <script src="database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>

  <!-- Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <script>
    // ===== Namespace + Schema Migration =====
    const APP_NS = 'egf.qr';
    const SCHEMA_VERSION = 2;
    function ns(k) { return `${APP_NS}.${k}`; }
    function lsGet(k, d = null) { const v = localStorage.getItem(ns(k)); return v == null ? d : v; }
    function lsSet(k, v) { localStorage.setItem(ns(k), v); }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ù…Ø¹ Namespacing
    (function migrateLS() {
      const cur = +lsGet('schema_version', 0);
      if (cur >= SCHEMA_VERSION) return;

      const LEGACY_KEYS = [
        ['cart', 'cart'],
        ['egf_userSubs', 'userSubs'],
        ['egf_userRole', 'userRole'],
        ['egf_currentSubId', 'currentSubId'],
        ['egf_codeAttempts', 'codeAttempts'],
        ['egf_codeLockUntil', 'codeLockUntil']
      ];

      LEGACY_KEYS.forEach(([oldK, newK]) => {
        const oldV = localStorage.getItem(oldK);
        if (oldV != null && lsGet(newK) == null) { lsSet(newK, oldV); }
        localStorage.removeItem(oldK);
      });

      lsSet('schema_version', String(SCHEMA_VERSION));
    })();

    // ===== Toast + Safe Open =====
    function showToast(message, color) {
      const cont = document.getElementById('liveToastContainer');
      if (!cont) return;

      const toastEl = document.createElement('div');
      const bg = color || 'dark';
      toastEl.className = `toast align-items-center text-bg-${bg} border-0`;
      toastEl.setAttribute('role', 'alert');
      toastEl.setAttribute('aria-live', 'assertive');
      toastEl.setAttribute('aria-atomic', 'true');

      toastEl.innerHTML = `
    <div class="d-flex">
      <div class="toast-body"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast" aria-label="Close"></button>
    </div>`;
      toastEl.querySelector('.toast-body').textContent = String(message ?? '');
      cont.appendChild(toastEl);

      const t = new bootstrap.Toast(toastEl, { delay: 4500 });
      toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
      t.show();
    }

    function safeHref(u) {
      try {
        const url = new URL(u, location.href);
        return ['http:', 'https:', 'mailto:', 'tel:'].includes(url.protocol) ? url.toString() : '';
      } catch { }
      return '';
    }

    function safeOpen(u) {
      const href = safeHref(u);
      if (!href) {
        if (typeof showToast === 'function') showToast('Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­', 'danger');
        return;
      }
      window.open(href, '_blank', 'noopener');
    }

    // ===== Download helper for QR Preview =====
    async function downloadNodeAsImage(node, filename = 'qr.png') {
      const c = node.querySelector('canvas');
      const s = node.querySelector('svg');

      if (c) {
        const a = document.createElement('a');
        a.href = c.toDataURL('image/png');
        a.download = filename;
        a.click();
        return;
      }

      if (s) {
        const blob = new Blob([s.outerHTML], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename.replace(/\.png$/i, '.svg');
        a.click();
        setTimeout(() => URL.revokeObjectURL(url), 600);
      }
    }

    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ­Ù…ÙŠÙ„ QR Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    (function addMainQrDownloadBtn() {
      const host = document.getElementById('qr-result-fields');
      if (!host) return;

      const btn = document.createElement('button');
      btn.id = 'main-qr-download';
      btn.className = 'btn btn-sm btn-outline-secondary position-absolute';
      btn.style.right = '12px';
      btn.style.bottom = '12px';
      btn.textContent = document.documentElement.lang === 'ar' ? 'ØªØ­Ù…ÙŠÙ„ QR' : 'Download QR';

      btn.addEventListener('click', () => downloadNodeAsImage(document.getElementById('qr-preview'), 'qr.png'));
      host.appendChild(btn);
    })();

    // ===== Report modal scale handling =====
    let reportResizeHandler = null;

    function fitReportToModal() {
      const cont = document.getElementById('report-body');
      const page = cont?.querySelector('.a2-page');
      if (!page) return;

      page.style.transform = 'none';
      const avail = cont.clientWidth - 16;
      const needed = page.getBoundingClientRect().width;
      const scale = Math.min(1, avail / needed);

      page.style.transform = `scale(${isFinite(scale) ? scale : 1})`;
    }

    document.getElementById('reportModal')?.addEventListener('shown.bs.modal', () => {
      if (!reportResizeHandler) {
        reportResizeHandler = () => fitReportToModal();
        window.addEventListener('resize', reportResizeHandler, { passive: true });
      }
      fitReportToModal();
    });
    const debounced = (fn, ms = 120) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms) } }
    const refreshLayout = debounced(() => {
      try { updateMainQR(); } catch { }
      try { fitReportToModal(); } catch { }
    }, 120);

    window.addEventListener('resize', refreshLayout, { passive: true });
    window.addEventListener('orientationchange', refreshLayout);

    document.getElementById('reportModal')?.addEventListener('hidden.bs.modal', () => {
      if (reportResizeHandler) {
        window.removeEventListener('resize', reportResizeHandler);
        reportResizeHandler = null;
      }
    });

    // ===== Service Worker register =====
    if ('serviceWorker' in navigator && (location.protocol === 'https:' || location.hostname === 'localhost' || location.protocol === 'http:')) {
      navigator.serviceWorker.register('sw.js', { scope: './' }).catch(() => { });
    }
    // sw.js
    const CACHE = 'egf-qr-v1';
    const ASSETS = [
      './', './index.html',
      'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css',
      'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css',
      'https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js',
      'https://cdn.jsdelivr.net/npm/flatpickr',
      'https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js'
    ];

    self.addEventListener('install', e => {
      e.waitUntil(caches.open(CACHE).then(c => c.addAll(ASSETS)));
    });

    self.addEventListener('activate', e => {
      e.waitUntil(
        caches.keys().then(keys => Promise.all(
          keys.filter(k => k !== CACHE).map(k => caches.delete(k))
        ))
      );
    });

    self.addEventListener('fetch', e => {
      const { request } = e;
      if (request.method !== 'GET') return;
      e.respondWith(
        caches.match(request).then(cached =>
          cached || fetch(request).then(resp => {
            const clone = resp.clone();
            caches.open(CACHE).then(c => c.put(request, clone));
            return resp;
          }).catch(() => cached) // offline fallback
        )
      );
    });

    // ===== File validation =====
    async function _readHead(file, n = 12) {
      const buf = await file.slice(0, n).arrayBuffer();
      return new Uint8Array(buf);
    }

    async function isRealImage(file) {
      const h = await _readHead(file, 12);
      const isPNG = h[0] === 0x89 && h[1] === 0x50 && h[2] === 0x4E && h[3] === 0x47 && h[4] === 0x0D && h[5] === 0x0A && h[6] === 0x1A && h[7] === 0x0A;
      const isJPG = h[0] === 0xFF && h[1] === 0xD8 && h[2] === 0xFF;
      const isGIF = h[0] === 0x47 && h[1] === 0x49 && h[2] === 0x46 && h[3] === 0x38 && (h[4] === 0x37 || h[4] === 0x39) && h[5] === 0x61;
      const isWEBP = h[0] === 0x52 && h[1] === 0x49 && h[2] === 0x46 && h[3] === 0x46 && h[8] === 0x57 && h[9] === 0x45 && h[10] === 0x42 && h[11] === 0x50;

      return isPNG || isJPG || isGIF || isWEBP;
    }

    async function isRealPDF(file) {
      const h = await _readHead(file, 5);
      const sig = new TextDecoder().decode(h);
      return sig === '%PDF-';
    }

    async function validateFile(file) {
      const MAX = 5 * 1024 * 1024; // 5MB
      const errors = [];
      if (!file) {
        errors.push('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.');
        return errors;
      }

      if (file.size > MAX) {
        errors.push('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø£ÙƒØ¨Ø± Ù…Ù† 5MB.');
      }

      const type = file.type || '';
      const isImg = /^image\//.test(type);
      const isPDF = type === 'application/pdf';
      const isDoc = /msword|officedocument\.wordprocessingml\.document/.test(type);

      if (isImg && !(await isRealImage(file))) {
        errors.push('Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ØªØ§Ù„Ù.');
      }
      if (isPDF && !(await isRealPDF(file))) {
        errors.push('Ù…Ù„Ù PDF ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ØªØ§Ù„Ù.');
      }
      if (!isImg && !isPDF && !isDoc) {
        errors.push('ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© (Ø§Ù„Ù…Ø³Ù…ÙˆØ­: ØµÙˆØ±ØŒ PDFØŒ DOC/DOCX).');
      }

      return errors;
    }

    // ===== Utilities =====
    const idle = window.requestIdleCallback || (fn => setTimeout(fn, 50));
    document.getElementById("year").textContent = new Date().getFullYear();

    function esc(s) {
      return String(s ?? '').replace(/[&<>\"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
    }
    function normalizeUrl(u) {
      u = (u || '').trim();
      if (!u) return '';

      const proto = u.split(':')[0].toLowerCase();
      // mailto/tel: Ø£Ø±Ø¬Ø¹Ù‡Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ (Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù€ new URL)
      if (proto === 'mailto' || proto === 'tel') return u;

      // http/https Ø£Ùˆ Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„
      if (proto === 'http' || proto === 'https') {
        try { return new URL(u).toString(); } catch { return ''; }
      }
      // Ø£Ø¶Ù https:// Ù„Ùˆ Ù†Ø§Ù‚Øµ
      if (!/^https?:\/\//i.test(u)) u = 'https://' + u;
      try { return new URL(u).toString(); } catch { return ''; }
    }

    function escWifi(s) {
      return String(s ?? '').replace(/([\\;,:"])/g, '\\$1');
    }
    function buildWifiString() {
      const t = document.getElementById('wifi-type').value; // WPA | WEP | nopass
      const s = escWifi(document.getElementById('wifi-ssid').value.trim());
      const pRaw = document.getElementById('wifi-password').value.trim();
      const h = document.getElementById('wifi-hidden').checked ? 'true' : 'false';

      // Ø¨Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹ÙŠØ§Ø±: WIFI:T:<type>;S:<ssid>;P:<password>;H:<hidden>;;
      const parts = [`WIFI:T:${t};S:${s};`];
      if (t !== 'nopass') parts.push(`P:${escWifi(pRaw)};`);
      parts.push(`H:${h};;`);
      return parts.join('');
    }


    function buildVcardString({ name, title, email, org, note, phones }) {
      const CRLF = '\r\n';
      const escV = s => String(s ?? '').replace(/([,;\\])/g, '\\$1');
      let given = '', family = '', additional = '';
      if ((name || '').trim()) {
        const parts = name.trim().split(/\s+/);
        given = parts.shift() || '';
        family = parts.pop() || '';
        additional = parts.join(' ');
      }
      let v = 'BEGIN:VCARD' + CRLF + 'VERSION:3.0' + CRLF;
      if (name) {
        v += `FN:${escV(name)}${CRLF}`;
        v += `N:${escV(family)};${escV(given)};${escV(additional)};;${CRLF}`;
      }
      if (title) v += `TITLE:${escV(title)}${CRLF}`;
      if (email) v += `EMAIL;TYPE=INTERNET:${escV(email)}${CRLF}`;
      if (org) v += `ORG:${escV(org)}${CRLF}`;
      (phones || []).forEach(ph => { if (ph) v += `TEL;TYPE=CELL,VOICE:${escV(ph)}${CRLF}`; });
      if (note) v += `NOTE:${escV(note)}${CRLF}`;
      v += 'END:VCARD';
      return v;
    }

    function debounce(fn, delay) {
      let t;
      return function (...args) {
        clearTimeout(t);
        t = setTimeout(() => fn.apply(this, args), delay);
      };
    }

    function safeAppendQR(container, instance) {
      if (!container) return;
      if (!container.firstChild) instance.append(container);
    }

    // ===== Data =====
    const products = [
      {
        id: 1,
        name: { ar: 'Ø³Ù…Ø§Ø¹Ø© Ù„Ø§Ø³Ù„ÙƒÙŠØ©', en: 'Wireless Headphones' },
        desc: { ar: 'Ø³Ù…Ø§Ø¹Ø© Ø¨Ù„ÙˆØªÙˆØ« Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©', en: 'High-quality Bluetooth headphones' },
        price: 199,
        img: 'https://placehold.co/300x180/6c757d/ffffff?text=' + encodeURIComponent('Ø³Ù…Ø§Ø¹Ø© Ù„Ø§Ø³Ù„ÙƒÙŠØ©')
      },
      {
        id: 2,
        name: { ar: 'Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ©', en: 'Smart Watch' },
        desc: { ar: 'Ø³Ø§Ø¹Ø© Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ù…Ø§Ø¡ Ù…Ø¹ ØªØªØ¨Ø¹ Ø§Ù„Ù†Ø´Ø§Ø·', en: 'Waterproof watch with activity tracking' },
        price: 349,
        img: 'https://placehold.co/300x180/0d6efd/ffffff?text=' + encodeURIComponent('Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ©')
      },
      {
        id: 3,
        name: { ar: 'Ø´Ø§Ø­Ù† Ù…ØªÙ†Ù‚Ù„', en: 'Power Bank' },
        desc: { ar: 'Ø´Ø§Ø­Ù† Ø¨Ø·Ø§Ø±ÙŠØ© Ø¨Ø³Ø¹Ø© 10000 Ù…Ù„Ù„ÙŠ Ø£Ù…Ø¨ÙŠØ±', en: '10000mAh power bank' },
        price: 129,
        img: 'https://placehold.co/300x180/198754/ffffff?text=' + encodeURIComponent('Ø´Ø§Ø­Ù† Ù…ØªÙ†Ù‚Ù„')
      }
    ];

    const subscriptions = [
      { id: 1, months: 3, price: 150, features: { ar: ['Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„', 'ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ', 'ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø³ØªÙ…Ø±Ø©'], en: ['Full support', 'Free delivery', 'Regular updates'] } },
      { id: 2, months: 6, price: 270, discount: 10, features: { ar: ['ÙƒÙ„ Ù…ÙŠØ²Ø§Øª 3 Ø£Ø´Ù‡Ø±', 'ØªØ®Ø²ÙŠÙ† ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯', 'Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¯Ø¹Ù…'], en: ['All 3-month features', 'Unlimited storage', 'Priority support'] } },
      { id: 3, months: 12, price: 480, discount: 20, features: { ar: ['ÙƒÙ„ Ù…ÙŠØ²Ø§Øª 6 Ø£Ø´Ù‡Ø±', 'Ù†Ø·Ø§Ù‚ Ù…Ø®ØµØµ', 'Ù…Ø¯ÙŠØ± Ø­Ø³Ø§Ø¨'], en: ['All 6-month features', 'Custom domain', 'Dedicated manager'] } }
    ];

    // ===== Cart =====
    let cart = JSON.parse(lsGet('cart') || '[]');
    window.cart = cart;

    function saveCart() {
      lsSet('cart', JSON.stringify(cart));
      window.cart = cart;
    }

    function updateCartBadge() {
      const count = cart.reduce((t, i) => t + i.qty, 0);
      document.querySelector('.cart-badge').textContent = count;
    }

    function renderCartModal() {
      const lang = document.documentElement.lang;
      const fmt = n => n.toLocaleString(lang === 'ar' ? 'ar-SA' : 'en-US', { style: 'currency', currency: 'SAR' }); // âœ… ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù…Ù„Ø©
      let html = '', total = 0;

      cart.forEach((item, idx) => {
        const itemTotal = item.price * item.qty;
        total += itemTotal;

        html += `<tr>
      <td>${esc(item.name)}</td>
      <td><input type="number" min="1" value="${item.qty}" data-idx="${idx}" class="form-control form-control-sm cart-qty" style="width:70px;"></td>
      <td>${fmt(item.price)}</td>
      <td>${fmt(itemTotal)}</td>
      <td><button class="btn btn-danger btn-sm remove-cart-item" data-idx="${idx}"><i class="bi bi-trash"></i></button></td>
    </tr>`;
      });

      document.getElementById('cart-modal-body').innerHTML = html || `<tr><td colspan="5" class="text-center">${combineTexts('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'Cart is empty', 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©')}</td></tr>`;
      document.getElementById('cart-total').textContent = fmt(total);
    }

    function addToCart(id) {
      const lang = document.documentElement.lang;
      let item;

      const isProduct = /^\d+$/.test(String(id));
      if (isProduct) {
        const pid = parseInt(id, 10);
        item = products.find(p => p.id === pid);
        if (!item) return;
      }
      else if (typeof id === 'string' && id.startsWith('sub-')) {
        const subId = parseInt(id.split('-')[1], 10);
        item = subscriptions.find(s => s.id === subId);
        if (!item) return;
      }
      else return;

      const existing = cart.find(x => String(x.id) === String(id));

      if (existing) existing.qty++;
      else {
        const displayName = isProduct
          ? combineTexts(item.name?.ar, item.name?.en, item.name?.[lang])
          : combineTexts(`${item.months} Ø£Ø´Ù‡Ø±`, `${item.months} Months`, `${item.months} ${(lang === 'ar') ? 'Ø£Ø´Ù‡Ø±' : 'Months'}`);

        cart.push({
          id: String(id),
          qty: 1,
          name: displayName,
          price: item.price
        });
      }

      saveCart();
      updateCartBadge();
    }

    // ===== QR Main =====
    const qrOptions = {
      width: 500,
      height: 500,
      type: "canvas",
      data: "",
      qrOptions: { errorCorrectionLevel: "M" },
      margin: 4,
      dotsOptions: { color: "#000", type: "rounded" },
      backgroundOptions: { color: "#fff" }
    };

    const qrCode = new QRCodeStyling(qrOptions);
    qrCode.append(document.getElementById("qr-preview"));

    const qrCustomization = {
      dotsColor: "#000",
      bgColor: "#fff",
      dotsType: "rounded",
      size: 500,
      ecc: "M",
      margin: 4,
      type: "canvas"
    };

    // Customizer
    // Update customizer panel position based on header
    function updateCustomizerPosition() {
      const header = document.getElementById('site-header');
      const panel = document.getElementById('customizer-panel');
      if (header && panel) {
        const headerRect = header.getBoundingClientRect();
        const topPosition = headerRect.bottom + 8 + (window.scrollY || 0);
        panel.style.top = `${topPosition}px`;
      }
    }

    // Mobile Menu Toggle
    $("#mobile-menu-toggle").click(function () {
      const menu = $("#mobile-menu");
      menu.toggleClass("show");
      const icon = $(this).find("i");
      if (menu.hasClass("show")) {
        icon.removeClass("bi-list").addClass("bi-x-lg");
      } else {
        icon.removeClass("bi-x-lg").addClass("bi-list");
      }
    });

    // Close mobile menu when clicking outside
    $(document).click(function (e) {
      if (!$(e.target).closest("#site-header").length) {
        $("#mobile-menu").removeClass("show");
        $("#mobile-menu-toggle i").removeClass("bi-x-lg").addClass("bi-list");
      }
    });

    // Mobile menu button handlers - connect to desktop functionality
    $("#toggle-customizer-btn-mobile").click(function () {
      $("#toggle-customizer-btn").click();
      $("#mobile-menu").removeClass("show");
      $("#mobile-menu-toggle i").removeClass("bi-x-lg").addClass("bi-list");
    });

    $("#toggle-bilingual-mobile").click(function () {
      $("#toggle-bilingual").click();
      $("#mobile-menu").removeClass("show");
      $("#mobile-menu-toggle i").removeClass("bi-x-lg").addClass("bi-list");
    });

    $("#toggle-lang-mobile").click(function () {
      $("#toggle-lang").click();
      $("#mobile-menu").removeClass("show");
      $("#mobile-menu-toggle i").removeClass("bi-x-lg").addClass("bi-list");
    });

    $("#open-code-modal-btn-mobile").click(function () {
      $("#open-code-modal-btn").click();
    });

    // Style menu mobile handler
    $(".dropdown-item[data-style]").click(function () {
      $("#mobile-menu").removeClass("show");
      $("#mobile-menu-toggle i").removeClass("bi-x-lg").addClass("bi-list");
    });

    let scrollPosition = 0;

    function toggleCustomizerPanel(show) {
      const panel = $("#customizer-panel");
      const backdrop = $("#customizer-backdrop");
      const body = $("body");
      const isMobile = window.innerWidth < 992;

      if (show === undefined) {
        show = !panel.hasClass("show");
      }

      if (show) {
        // Save scroll position on mobile
        if (isMobile) {
          scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
          body.css({
            'position': 'fixed',
            'top': `-${scrollPosition}px`,
            'width': '100%',
            'overflow': 'hidden'
          });
        }

        backdrop.addClass("show");
        panel.addClass("show").show();
        body.addClass("customizer-open");
        updateCustomizerPosition();
      } else {
        backdrop.removeClass("show");
        panel.removeClass("show").hide();
        body.removeClass("customizer-open");

        // Restore scroll position on mobile
        if (isMobile) {
          body.css({
            'position': '',
            'top': '',
            'width': '',
            'overflow': ''
          });
          window.scrollTo(0, scrollPosition);
        }
      }
    }

    $("#toggle-customizer-btn").click(function () {
      toggleCustomizerPanel();
    });

    $("#toggle-customizer-btn-mobile").click(function () {
      toggleCustomizerPanel(true);
    });

    // Close on backdrop click
    $("#customizer-backdrop").click(function () {
      toggleCustomizerPanel(false);
    });

    $("#close-customizer").click(function () {
      toggleCustomizerPanel(false);
    });

    // Update position on scroll and resize
    window.addEventListener('scroll', updateCustomizerPosition);
    window.addEventListener('resize', updateCustomizerPosition);

    const pickrDots = Pickr.create({
      el: '#pickr-dots',
      theme: 'nano',
      default: '#000',
      components: { preview: true, opacity: true, hue: true, interaction: { input: true, save: true } }
    });

    const pickrBg = Pickr.create({
      el: '#pickr-bg',
      theme: 'nano',
      default: '#fff',
      components: { preview: true, opacity: true, hue: true, interaction: { input: true, save: true } }
    });

    pickrDots.on('save', c => {
      const hex = c.toHEXA().toString();
      qrOptions.dotsOptions.color = hex;
      qrCustomization.dotsColor = hex;
      qrCode.update({ dotsOptions: { color: hex } });
      pickrDots.hide();
    });

    pickrBg.on('save', c => {
      const hex = c.toHEXA().toString();
      qrOptions.backgroundOptions.color = hex;
      qrCustomization.bgColor = hex;
      qrCode.update({ backgroundOptions: { color: hex } });
      pickrBg.hide();
    });

    $("#dots-type").on("change", function () {
      qrOptions.dotsOptions.type = this.value;
      qrCustomization.dotsType = this.value;
      qrCode.update({ dotsOptions: { type: this.value } });
    });

    $("#qr-ecc").on("change", function () {
      qrOptions.qrOptions = { errorCorrectionLevel: this.value };
      qrCustomization.ecc = this.value;
      qrCode.update({ qrOptions: qrOptions.qrOptions });
    });

    $("#qr-type").on("change", function () {
      qrOptions.type = this.value;
      qrCustomization.type = this.value;
      qrCode.update({ type: qrOptions.type });
    });

    $("#qr-margin").on("input", function () {
      const m = Math.max(0, Math.min(32, +this.value || 0));
      qrOptions.margin = m;
      qrCustomization.margin = m;
      qrCode.update({ margin: m });
    });

    $("#qr-size").on("input", function () {
      const s = +this.value;
      qrOptions.width = qrOptions.height = s;
      qrCustomization.size = s;
      qrCode.update({ width: s, height: s });
    });

    // Gender style
    const STYLE_KEY = 'egf.qr.gender_style';
    let genderStyle = lsGet(STYLE_KEY) || 'neutral';

    function applyGenderStyle(style) {
      genderStyle = (style === 'male' || style === 'female') ? style : 'neutral';
      document.body.classList.remove('male-style', 'female-style');

      if (genderStyle === 'male') document.body.classList.add('male-style');
      if (genderStyle === 'female') document.body.classList.add('female-style');

      lsSet(STYLE_KEY, genderStyle);

      // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
      const iconSpan = document.getElementById('gender-icon');
      if (iconSpan) {
        if (genderStyle === 'male') {
          iconSpan.innerHTML = '<i class="bi bi-gender-male"></i>';
          iconSpan.style.color = '#2157c2';
        }
        else if (genderStyle === 'female') {
          iconSpan.innerHTML = '<i class="bi bi-gender-female"></i>';
          iconSpan.style.color = '#E1306C';
        }
        else {
          iconSpan.innerHTML = '<i class="bi bi-gender-ambiguous"></i>';
          iconSpan.style.color = '#6c757d';
        }
      }

      // Ø¹Ù†ÙˆØ§Ù† Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      const btn = document.getElementById('styleMenuBtn');
      if (btn) {
        btn.classList.add('icon-btn');
        btn.innerHTML = '<i class="bi bi-person-gear"></i>'; // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø«Ø§Ø¨ØªØ©
        const title = genderStyle === 'male' ? 'Ø³ØªØ§ÙŠÙ„ Ø±Ø¬Ø§Ù„ÙŠ' : (genderStyle === 'female' ? 'Ø³ØªØ§ÙŠÙ„ Ù†Ø³Ø§Ø¦ÙŠ' : 'Ø³ØªØ§ÙŠÙ„ Ù…Ø­Ø§ÙŠØ¯');
        btn.setAttribute('title', title);
        btn.setAttribute('aria-label', title);
      }
    }
    document.addEventListener('click', (e) => {
      const item = e.target.closest('.dropdown-item[data-style]');
      if (!item) return;
      const btn = document.getElementById('styleMenuBtn');
      if (btn) { btn.classList.remove('animate-spin-90'); void btn.offsetWidth; btn.classList.add('animate-spin-90'); }
      applyGenderStyle(item.getAttribute('data-style'));
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    document.addEventListener('DOMContentLoaded', () => {
      applyGenderStyle(genderStyle);
    });

    // Accordion state
    const accordionData = {
      1: { image: '', text: '', table: [], comment: '', qr: null },
      2: { image: '', text: '', table: [], comment: '', qr: null },
      3: { image: '', text: '', table: [], comment: '', qr: null }
    };

    function initAccordionQR(id) {
      const opts = {
        width: 150,
        height: 150,
        type: "canvas",
        data: "",
        qrOptions: { errorCorrectionLevel: "M" },
        margin: 4,
        dotsOptions: { color: "#000", type: "rounded" },
        backgroundOptions: { color: "#fff" }
      };

      accordionData[id].qr = new QRCodeStyling(opts);
      accordionData[id].qr.append(document.getElementById(`accordion-qr-${id}`));
    }

    function updateAccordionQR(id) {
      if (id === 1) {
        updateGeneralAccordionQr();
        return;
      }

      const data = accordionData[id];
      let qrContent = '';

      if (id === 2 && data.table.length > 0) {
        data.table.forEach(row => {
          if (row.title || row.value) qrContent += `${row.title}: ${row.value}\n`;
        });
      }

      if (id === 2 && data.text) {
        qrContent += data.text;
      }

      const el = document.getElementById(`accordion-qr-${id}`);
      if (qrContent) {
        accordionData[id].qr.update({
          data: qrContent,
          dotsOptions: { color: qrCustomization.dotsColor, type: qrCustomization.dotsType },
          backgroundOptions: { color: qrCustomization.bgColor },
          qrOptions: { errorCorrectionLevel: qrCustomization.ecc },
          margin: qrCustomization.margin
        });
        el.style.display = 'block';
      }
      else {
        el.style.display = 'none';
      }

      const commentEl = document.getElementById(`accordion-qr-comment-${id}`);
      if (data.comment) {
        commentEl.textContent = data.comment;
        commentEl.style.display = 'block';
      } else {
        commentEl.style.display = 'none';
      }
    }

    // Accordion 1 general cards
    const generalCards = [];
    const cardColors = ['success', 'primary', 'warning', 'info', 'danger', 'secondary'];
    let cardColorIndex = 0;

    const cardSortable = new Sortable(document.getElementById('accordion1-cards-container'), {
      animation: 150,
      handle: '.card-header',
      ghostClass: 'bg-light'
    });

    function addAccordion1Card() {
      const color = cardColors[cardColorIndex % cardColors.length];
      cardColorIndex++;

      const idx = generalCards.length;
      generalCards.push({ date: '', description: '', files: [], notes: '' });

      const card = document.createElement('div');
      card.className = `custom-card card border-${color} mb-3`;
      card.setAttribute('data-card-id', idx); // âœ… Ø±Ø¨Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù…Ø¹Ø±Ù‘ÙÙ‡Ø§

      card.innerHTML = `
    <div class="card-header bg-transparent border-${color} d-flex justify-content-between align-items-center">
      <span><i class="bi bi-journal-text"></i> <span class="card-number-text">Ø¨Ø·Ø§Ù‚Ø© ${idx + 1}</span></span>
      <button type="button" class="btn btn-sm btn-outline-danger remove-card viewer-hide" data-card-id="${idx}"><i class="bi bi-trash"></i></button>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-calendar"></i> <span class="date-label-text">Ø§Ù„ØªØ§Ø±ÙŠØ®</span></label>
        <input type="text" class="form-control card-date" data-card-id="${idx}" placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®">
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-card-text"></i> <span class="description-label-text">Ø§Ù„ÙˆØµÙ/Ø§Ù„Ø±Ø§Ø¨Ø·/Ø§Ù„Ø±Ù‚Ù…/Ø§Ù„ØªØ§Ø±ÙŠØ®</span></label>
        <textarea class="form-control card-description" data-card-id="${idx}" rows="1" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØµÙ Ù‡Ù†Ø§..."></textarea>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-paperclip"></i> <span class="attachments-label-text">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 3 Ù…Ù„ÙØ§Øª)</span></label>
        <input type="file" class="form-control card-attachments" data-card-id="${idx}" multiple>
        <div class="card-file-error" data-card-id="${idx}" style="display:none;"></div>
        <div class="card-attachments-preview d-flex flex-wrap" data-card-id="${idx}"></div>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-chat-dots"></i> <span class="notes-label-text">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span></label>
        <textarea class="form-control card-notes" data-card-id="${idx}" rows="1" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§..."></textarea>
      </div>
    </div>
  `;

      document.getElementById('accordion1-cards-container').appendChild(card);
      initCardLogic(idx);
    }

    document.getElementById('add-accordion1-card').addEventListener('click', () => {
      if (typeof getRole === 'function' && getRole() === 'viewer') {
        showToast(document.documentElement.lang === 'ar' ? 'ØºÙŠØ± Ù…ÙØµØ±Ù‘Ø­ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯.' : 'Not allowed for viewer.', 'danger');
        return;
      }
      addAccordion1Card();
    });
    document.addEventListener('click', function (e) {
      if (e.target.closest('.remove-card')) {
        if (typeof getRole === 'function' && getRole() === 'viewer') {
          showToast(document.documentElement.lang === 'ar' ? 'ØºÙŠØ± Ù…ÙØµØ±Ù‘Ø­ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯.' : 'Not allowed for viewer.', 'danger');
          return;
        }
        const btn = e.target.closest('.remove-card');
        const card = btn.closest('.custom-card');
        const id = parseInt(btn.getAttribute('data-card-id'), 10);

        if (card) card.remove();
        if (!isNaN(id)) generalCards[id] = null;
        updateGeneralAccordionQr();
      }
    });

    function initCardLogic(index) {
      const dateInput = document.querySelector(`input.card-date[data-card-id="${index}"]`);

      flatpickr(dateInput, {
        dateFormat: "Y-m-d",
        locale: document.documentElement.lang === "ar" ? "ar" : "default",
        minDate: "today",
        onChange: function (_, dateStr) {
          if (generalCards[index]) {
            generalCards[index].date = dateStr;
            updateGeneralAccordionQr();
          }
        }
      });

      dateInput.addEventListener('change', () => {
        if (generalCards[index]) {
          generalCards[index].date = dateInput.value;
          updateGeneralAccordionQr();
        }
      });

      const descArea = document.querySelector(`textarea.card-description[data-card-id="${index}"]`);
      descArea.addEventListener('input', function () {
        if (!generalCards[index]) return;
        generalCards[index].description = this.value.trim();
        this.style.height = 'auto';
        this.style.height = `${this.scrollHeight}px`;
        updateGeneralAccordionQr();
      });

      const notesArea = document.querySelector(`textarea.card-notes[data-card-id="${index}"]`);
      notesArea.addEventListener('input', function () {
        if (!generalCards[index]) return;
        generalCards[index].notes = this.value.trim();
        this.style.height = 'auto';
        this.style.height = `${this.scrollHeight}px`;
        updateGeneralAccordionQr();
      });

      const fileInput = document.querySelector(`input.card-attachments[data-card-id="${index}"]`);
      fileInput.addEventListener('change', function () {
        handleAttachmentsChange(index, this.files);
        this.value = '';
      });
    }

    async function handleAttachmentsChange(index, fileList) {
      const card = generalCards[index];
      if (!card) return;

      const errorEl = document.querySelector(`.card-file-error[data-card-id="${index}"]`);
      let hasError = false;

      if (card.files.length >= 3) {
        errorEl.style.display = 'block';
        errorEl.innerHTML = 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ø£ÙƒØ«Ø± Ù…Ù† 3 Ù…Ù„ÙØ§Øª.';
        return;
      }

      for (let i = 0; i < fileList.length; i++) {
        if (card.files.length >= 3) {
          hasError = true;
          break;
        }

        const file = fileList[i];
        const errors = await validateFile(file);

        if (errors.length) {
          hasError = true;
          errorEl.style.display = 'block';
          errorEl.innerHTML = errors.map(esc).join('<br>');
          continue;
        }

        const isImage = file.type.startsWith('image/');
        const isPDF = file.type === 'application/pdf';
        const isDoc = /msword|officedocument\.wordprocessingml\.document/.test(file.type);

        if (isImage) {
          const reader = new FileReader();
          reader.onload = function (e) {
            card.files.push({ name: file.name, type: 'image', preview: e.target.result });
            updateAttachmentsPreview(index);
            updateGeneralAccordionQr();
          };
          reader.readAsDataURL(file);
        } else {
          let type = isPDF ? 'pdf' : (isDoc ? 'doc' : 'file');
          card.files.push({ name: file.name, type, preview: '' });
          updateAttachmentsPreview(index);
          updateGeneralAccordionQr();
        }
      }

      if (!hasError) {
        errorEl.innerHTML = '';
        errorEl.style.display = 'none';
      }
    }

    function updateAttachmentsPreview(index) {
      const card = generalCards[index];
      if (!card) return;

      const container = document.querySelector(`.card-attachments-preview[data-card-id="${index}"]`);
      container.innerHTML = '';

      card.files.forEach((file, idx) => {
        const d = document.createElement('div');
        d.className = 'card-attachment';

        if (file.type === 'image') {
          d.innerHTML = `
        <img src="${file.preview}" alt="${esc(file.name)}">
        <span>${esc(file.name)}</span>
        <button type="button" class="btn btn-sm btn-outline-danger file-delete" data-card-id="${index}" data-file-index="${idx}"><i class="bi bi-trash"></i></button>
      `;
        }
        else {
          const icon = file.type === 'pdf' ? 'bi-file-earmark-pdf-fill' : 'bi-file-earmark-word-fill';
          d.innerHTML = `
        <i class="bi ${icon}"></i>
        <span>${esc(file.name)}</span>
        <button type="button" class="btn btn-sm btn-outline-danger file-delete viewer-hide" data-card-id="${index}" data-file-index="${idx}"><i class="bi bi-trash"></i></button>
      `;
        }

        container.appendChild(d);
      });
    }

    document.addEventListener('click', function (e) {
      if (e.target.closest('.file-delete')) {
        if (typeof getRole === 'function' && getRole() === 'viewer') {
          showToast(document.documentElement.lang === 'ar' ? 'ØºÙŠØ± Ù…ÙØµØ±Ù‘Ø­ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯.' : 'Not allowed for viewer.', 'danger');
          return;
        }
        const btn = e.target.closest('.file-delete');
        const cardId = parseInt(btn.getAttribute('data-card-id'), 10);
        const fileIndex = parseInt(btn.getAttribute('data-file-index'), 10);

        if (!isNaN(cardId) && !isNaN(fileIndex) && generalCards[cardId]) {
          generalCards[cardId].files.splice(fileIndex, 1);
          updateAttachmentsPreview(cardId);
          updateGeneralAccordionQr();
        }
      }
    });

    function updateGeneralAccordionQr() {
      let content = '';

      generalCards.forEach(card => {
        if (!card) return;

        let part = '';
        if (card.date) part += `Date: ${card.date}\n`;
        if (card.description) part += `${card.description}\n`;

        if (card.files?.length) {
          const names = card.files.map(f => f.name).join(', ');
          part += `Files: ${names}\n`;
        }

        if (card.notes) part += `${card.notes}\n`;
        if (part) content += part.trim() + '\n';
      });

      content = content.trim();
      const qrEl = document.getElementById('accordion-qr-1');
      const cEl = document.getElementById('accordion-qr-comment-1');

      if (!content) {
        if (qrEl) qrEl.style.display = 'none';
        if (cEl) cEl.style.display = 'none';
        return;
      }

      accordionData[1].qr.update({
        data: content,
        dotsOptions: { color: qrCustomization.dotsColor, type: qrCustomization.dotsType },
        backgroundOptions: { color: qrCustomization.bgColor },
        qrOptions: { errorCorrectionLevel: qrCustomization.ecc },
        margin: qrCustomization.margin
      });

      if (qrEl) qrEl.style.display = 'block';

      const c = accordionData[1].comment;
      if (c) {
        cEl.textContent = c;
        cEl.style.display = 'block';
      } else {
        cEl.style.display = 'none';
      }
    }

    function getAccordionQRData(id) {
      const data = accordionData[id];
      let qrContent = '';

      if (id === 1) {
        generalCards.forEach(card => {
          if (!card) return;

          let part = '';
          if (card.date) part += `Date: ${card.date}\n`;
          if (card.description) part += `${card.description}\n`;

          if (card.files?.length) {
            const names = card.files.map(f => f.name).join(', ');
            part += `Files: ${names}\n`;
          }

          if (card.notes) part += `${card.notes}\n`;
          if (part) qrContent += part.trim() + '\n';
        });

        return qrContent.trim();
      }

      if (id === 2) {
        if (data.table.length) {
          data.table.forEach(row => {
            if (row.title || row.value) qrContent += `${row.title}: ${row.value}\n`;
          });
        }

        if (data.text) qrContent += data.text;
      }

      return qrContent;
    }

    // ===== Inputs -> Main QR =====
    function getDataFromActiveTab() {
      const active = document.querySelector('.tab-pane.active');
      if (!active) return '';

      if (active.id === 'url-pane') {
        const raw = document.getElementById('qr-input-url').value.trim();
        const url = normalizeUrl(raw);
        return url || '';
      }

      if (active.id === 'wifi-pane') {
        const ssid = document.getElementById('wifi-ssid').value.trim();
        const pwd = document.getElementById('wifi-password').value.trim();
        const t = document.getElementById('wifi-type').value;

        if (!ssid) return '';
        if (t !== 'nopass' && !pwd) return '';

        return buildWifiString();
      }

      if (active.id === 'vcard-pane') {
        const name = document.getElementById('vcard-name').value.trim();
        const title = document.getElementById('vcard-title').value.trim();
        const email = document.getElementById('vcard-email').value.trim();
        const org = document.getElementById('vcard-org').value.trim();
        const note = document.getElementById('vcard-note').value.trim();

        const phones = [];
        document.querySelectorAll('.vcard-phone').forEach(inp => {
          const v = inp.value.trim();
          if (v) phones.push(v);
        });

        const has = name || title || email || org || note || phones.length;
        return has ? buildVcardString({ name, title, email, org, note, phones }) : '';
      }

      return '';
    }

    function renderMainContent() {
      const out = document.getElementById('main-content-preview');
      if (!out) return;

      const active = document.querySelector('.tab-pane.active');
      if (!active) {
        out.innerHTML = '';
        return;
      }

      if (active.id === 'url-pane') {
        const url = normalizeUrl(document.getElementById('qr-input-url').value.trim());
        out.innerHTML = url ? `<a href="${esc(url)}" target="_blank" rel="noopener">${esc(url)}</a>` : '';
        return;
      }

      if (active.id === 'wifi-pane') {
        const ssid = esc(document.getElementById('wifi-ssid').value.trim());
        const t = document.getElementById('wifi-type').value;
        out.textContent = ssid ? `Wi-Fi (${t}) Â· SSID: ${ssid}` : '';
        return;
      }

      if (active.id === 'vcard-pane') {
        const name = esc(document.getElementById('vcard-name').value.trim());
        const email = esc(document.getElementById('vcard-email').value.trim());
        out.textContent = name || email ? `${name}${name && email ? ' Â· ' : ''}${email}` : '';
        return;
      }

      out.innerHTML = '';
    }

    const updateMainQR = debounce(function () {
      const activeTab = document.querySelector('.tab-pane.active');
      if (!activeTab || activeTab.id === 'text-pane' || activeTab.id === 'social-pane') return;

      const data = getDataFromActiveTab();
      const previewEl = document.getElementById('qr-preview');
      const commentEl = document.getElementById('qr-comment-show');
      const previewFields = document.getElementById('qr-result-fields');

      if (!data) {
        previewFields.style.display = 'none';
        previewEl.innerHTML = '';
        commentEl.textContent = '';
        commentEl.style.display = 'none';
        return;
      }

      previewFields.style.display = 'block';
      // Ø­Ø¬Ù… Ø«Ø§Ø¨Øª Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
      const size = 150;

      safeAppendQR(previewEl, qrCode);

      qrCode.update({
        width: size,
        height: size,
        data,
        dotsOptions: { color: qrCustomization.dotsColor, type: qrCustomization.dotsType },
        backgroundOptions: { color: qrCustomization.bgColor },
        qrOptions: { errorCorrectionLevel: qrCustomization.ecc },
        margin: qrCustomization.margin
      });

      let txt = '';
      if (activeTab.id === 'url-pane') txt = document.getElementById('url-comment').value.trim();
      if (activeTab.id === 'wifi-pane') txt = document.getElementById('wifi-comment').value.trim();
      if (activeTab.id === 'vcard-pane') txt = document.getElementById('vcard-comment').value.trim();

      commentEl.textContent = txt;
      commentEl.style.display = txt ? 'block' : 'none';

      renderMainContent();
    }, 140);

    // Bind inputs
    ['qr-input-url', 'url-comment', 'wifi-type', 'wifi-ssid', 'wifi-password', 'wifi-comment', 'wifi-hidden',
      'vcard-name', 'vcard-title', 'vcard-email', 'vcard-org', 'vcard-note', 'vcard-comment'].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;

        const evt = (id === 'wifi-type' || id === 'wifi-hidden') ? 'change' : 'input';
        el.addEventListener(evt, updateMainQR);
      });

    // vCard phones
    document.getElementById("add-phone").addEventListener("click", () => {
      const div = document.createElement("div");
      div.className = "input-group mb-2 align-items-center";

      div.innerHTML = `
    <span class="input-group-text handle" style="cursor:grab;">â†•ï¸</span>
    <input type="tel" class="form-control vcard-phone" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ" />
    <button type="button" class="btn btn-outline-danger remove-phone">ğŸ—‘ï¸</button>
  `;

      document.getElementById("vcard-phones").appendChild(div);
      updateMainQR();
    });

    document.addEventListener("click", e => {
      if (e.target.classList.contains("remove-phone")) {
        e.target.closest(".input-group").remove();
        updateMainQR();
      }

      if (e.target.classList.contains("remove-social")) {
        e.target.closest(".input-group").remove();
        qrCode.update({ data: getDataFromActiveTab() });
      }
    });

    new Sortable(document.getElementById("vcard-phones"), {
      animation: 150,
      handle: ".handle",
      ghostClass: "bg-light"
    });

    // Social
    const socialTypes = [
      { icon: "bi-whatsapp", name_ar: "ÙˆØ§ØªØ³Ø§Ø¨", name_en: "WhatsApp", value: "whatsapp" },
      { icon: "bi-snapchat", name_ar: "Ø³Ù†Ø§Ø¨ Ø´Ø§Øª", name_en: "Snapchat", value: "snapchat" },
      { icon: "bi-instagram", name_ar: "Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…", name_en: "Instagram", value: "instagram" },
      { icon: "bi-telegram", name_ar: "ØªÙ„Ø¬Ø±Ø§Ù…", name_en: "Telegram", value: "telegram" },
      { icon: "bi-youtube", name_ar: "ÙŠÙˆØªÙŠÙˆØ¨", name_en: "YouTube", value: "youtube" },
      { icon: "bi-tiktok", name_ar: "ØªÙŠÙƒ ØªÙˆÙƒ", name_en: "TikTok", value: "tiktok" },
      { icon: "bi-linkedin", name_ar: 'Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù†', name_en: "LinkedIn", value: "linkedin" },
      { icon: "bi-link-45deg", name_ar: "Ø£Ø®Ø±Ù‰", name_en: "Other", value: "other" }
    ];

    function isFullLink(v) {
      try {
        const u = new URL(v);
        return ['http:', 'https:', 'mailto:', 'tel:'].includes(u.protocol);
      } catch { return false; }
    }

    function formatSocialLink(type, value, labelPrefix) {
      if (isFullLink(value)) {
        const showName = (socialTypes.find(x => x.value === type)?.name_ar) || type;
        return labelPrefix ? `${showName}: ${value}` : value;
      }

      switch (type) {
        case "whatsapp":
          return (labelPrefix ? "ÙˆØ§ØªØ³Ø§Ø¨: " : "") + `https://wa.me/${value.replace(/[^\d+]/g, "")}`;
        case "telegram":
          return (labelPrefix ? "ØªÙ„Ø¬Ø±Ø§Ù…: " : "") + `https://t.me/${value.replace(/^@/, "")}`;
        case "instagram":
          return (labelPrefix ? "Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…: " : "") + `https://instagram.com/${value.replace(/^@/, "")}`;
        case "snapchat":
          return (labelPrefix ? "Ø³Ù†Ø§Ø¨ Ø´Ø§Øª: " : "") + `https://snapchat.com/add/${value.replace(/^@/, "")}`;
        case "youtube":
          return (labelPrefix ? "ÙŠÙˆØªÙŠÙˆØ¨: " : "") + `https://youtube.com/${value.replace(/^@/, "")}`;
        case "tiktok":
          return (labelPrefix ? "ØªÙŠÙƒ ØªÙˆÙƒ: " : "") + `https://tiktok.com/@${value.replace(/^@/, "")}`;
        case "linkedin":
          return (labelPrefix ? "Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù†: " : "") + `https://linkedin.com/in/${value.replace(/^@/, "")}`;
        case "other":
        default:
          return (labelPrefix ? "Ø£Ø®Ø±Ù‰: " : "") + value;
      }
    }

    function updateSocialIcon(select) {
      const iconSpan = select.parentElement.querySelector('.social-icon i');
      const found = socialTypes.find(st => st.value === select.value);
      iconSpan.className = "bi " + (found ? found.icon : "bi-link-45deg");
    }

    document.getElementById("add-social").addEventListener("click", () => {
      const div = document.createElement("div");
      div.className = "input-group mb-2 align-items-center";

      div.innerHTML = `
    <span class="input-group-text handle" style="cursor:grab;">â†•ï¸</span>
    <span class="input-group-text social-icon"><i class="bi bi-link-45deg"></i></span>
    <select class="form-select social-type" style="max-width:110px;">
      ${socialTypes.map(t => `<option value="${t.value}">${t.name_ar}</option>`).join("")}
    </select>
    <input type="text" class="form-control social-value" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø·" />
    <button type="button" class="btn btn-outline-danger remove-social">ğŸ—‘ï¸</button>
  `;

      document.getElementById("social-accounts").appendChild(div);
      updateSocialIcon(div.querySelector('.social-type'));
      qrCode.update({ data: getDataFromActiveTab() });
    });

    document.addEventListener("change", e => {
      if (e.target.classList.contains("social-type")) updateSocialIcon(e.target);
    });

    new Sortable(document.getElementById("social-accounts"), {
      animation: 150,
      handle: ".handle",
      ghostClass: "bg-light"
    });

    document.getElementById("social-accounts").addEventListener("input", function () {
      const paneActive = document.querySelector(".tab-pane.active")?.id;

      if (paneActive === "social-pane") {
        document.getElementById('qr-preview').innerHTML = "";
        document.getElementById('main-content-preview').innerHTML = "";
      }
      else {
        qrCode.update({ data: getDataFromActiveTab() });
        renderMainContent();
      }
    });

    document.getElementById("copy-social").addEventListener("click", () => {
      const accounts = [];
      document.querySelectorAll("#social-accounts .input-group").forEach(row => {
        const type = row.querySelector(".social-type").value;
        const value = row.querySelector(".social-value").value.trim();
        if (value) accounts.push({ type, value });
      });
      if (!accounts.length) return;
      const links = accounts.map(acc => formatSocialLink(acc.type, acc.value, true));
      navigator.clipboard.writeText(links.join('\n')).then(() => {
        const ok = document.getElementById("copy-social-done");
        ok.style.display = 'inline-block';
        setTimeout(() => { ok.style.display = 'none'; }, 1400);
      });
    });

    document.getElementById("generate-social-qrs")?.addEventListener("click", () => {
      // Check if user is in viewer mode - prevent QR generation
      if (typeof getRole === 'function' && getRole() === 'viewer') {
        showToast(document.documentElement.lang === 'ar' ? 'ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©: Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆÙ„ÙŠØ¯ QR.' : 'Viewer mode: QR generation disabled.', 'danger');
        return;
      }

      const wrap = document.getElementById("social-qrs");
      wrap.innerHTML = "";

      const accounts = [];
      document.querySelectorAll("#social-accounts .input-group").forEach(row => {
        const type = row.querySelector(".social-type").value;
        const value = row.querySelector(".social-value").value.trim();
        if (value) accounts.push({ type, value });
      });

      if (!accounts.length) return;

      accounts.forEach((acc, i) => {
        const link = formatSocialLink(acc.type, acc.value, false);
        const id = `social-qr-${i}`;

        const col = document.createElement("div");
        col.className = "col-12 col-sm-6 col-lg-4";

        col.innerHTML = `
      <div class="card p-3 text-center h-100">
        <div id="${id}"></div>
        <div class="fw-bold mt-2 mb-1">${esc(socialTypes.find(t => t.value === acc.type)?.name_ar || acc.type)}</div>
        <div class="text-truncate small">${esc(link)}</div>
      </div>
    `;

        wrap.appendChild(col);

        idle(() => {
          const qr = new QRCodeStyling({
            width: 180,
            height: 180,
            type: "canvas",
            data: link,
            dotsOptions: { color: qrCustomization.dotsColor, type: qrCustomization.dotsType },
            backgroundOptions: { color: qrCustomization.bgColor },
            qrOptions: { errorCorrectionLevel: qrCustomization.ecc },
            margin: qrCustomization.margin
          });

          qr.append(document.getElementById(id));
        });
      });
    });

    // ===== Clear Button =====
    document.getElementById("clear-btn").addEventListener("click", () => {
      document.querySelectorAll("input, textarea").forEach(e => e.value = "");
      document.getElementById("qr-preview").innerHTML = "";
      document.getElementById("vcard-phones").innerHTML = "";
      document.getElementById("main-content-preview").innerHTML = "";
      document.getElementById("qr-comment-show").textContent = "";

      for (let i = 1; i <= 3; i++) {
        accordionData[i] = { image: '', text: '', table: [], comment: '', qr: accordionData[i].qr };
        document.querySelector(`.accordion-image-preview[data-accordion="${i}"]`).innerHTML = '';
        document.querySelector(`.accordion-table[data-accordion="${i}"] tbody`).innerHTML = '';
        document.getElementById(`accordion-qr-${i}`).style.display = 'none';
        document.getElementById(`accordion-qr-comment-${i}`).style.display = 'none';
      }

      generalCards.length = 0;
      document.getElementById("accordion1-cards-container").innerHTML = "";
      cardColorIndex = 0;

      document.getElementById("social-accounts").innerHTML = "";
      document.getElementById("social-qrs").innerHTML = "";

      qrCode.update({ data: "" });
      updateGeneralAccordionQr();
      document.getElementById('qr-result-fields').style.display = 'none';

      // âœ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù€ QR + Ø§Ù„Ø£Ù„ÙˆØ§Ù†
      pickrDots.setColor('#000'); pickrBg.setColor('#fff');
      qrCustomization.dotsColor = '#000';
      qrCustomization.bgColor = '#fff';
      qrCustomization.dotsType = 'rounded';
      qrCustomization.ecc = 'M';
      qrCustomization.margin = 4;
      qrCustomization.size = 500;
      qrCode.update({
        width: 500, height: 500, data: '',
        dotsOptions: { color: '#000', type: 'rounded' },
        backgroundOptions: { color: '#fff' },
        qrOptions: { errorCorrectionLevel: 'M' },
        margin: 4
      });
    });

    // ===== Product Search Functionality =====
    let allProducts = [];
    let filteredProducts = [];

    // Store all products when rendering
    async function renderProducts(searchTerm = '') {
      const wrap = document.querySelector('#products-container');
      if (!wrap) return;

      try {
        // Load products from database
        let productsToRender = [];
        if (typeof db !== 'undefined' && db) {
          try {
            if (!db.db) await db.init();
            const dbProducts = await db.getAllProducts();
            // Filter only active products
            productsToRender = dbProducts.filter(p => p.isActive !== false);
          } catch (error) {
            console.warn('Error loading products from database, using fallback:', error);
            // Fallback to hardcoded products if database fails
            productsToRender = products;
          }
        } else {
          // Fallback to hardcoded products if database not available
          productsToRender = products;
        }

        // Store all products
        allProducts = productsToRender;

        // Filter products based on search term
        if (searchTerm && searchTerm.trim() !== '') {
          const searchLower = searchTerm.toLowerCase().trim();
          productsToRender = productsToRender.filter(p => {
            const nameAr = (p.name?.ar || p.name || '').toLowerCase();
            const nameEn = (p.name?.en || p.name || '').toLowerCase();
            const descAr = (p.desc?.ar || p.desc || '').toLowerCase();
            const descEn = (p.desc?.en || p.desc || '').toLowerCase();
            const category = (p.category || '').toLowerCase();

            return nameAr.includes(searchLower) ||
              nameEn.includes(searchLower) ||
              descAr.includes(searchLower) ||
              descEn.includes(searchLower) ||
              category.includes(searchLower);
          });
        }

        filteredProducts = productsToRender;
        const lang = document.documentElement.lang;

        if (!productsToRender || productsToRender.length === 0) {
          wrap.innerHTML = `
            <div class="col-12">
              <div class="text-center py-5">
                <i class="bi bi-bag" style="font-size: 3rem; color: #cbd5e0;"></i>
                <p class="mt-3 text-muted">${searchTerm ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø« | No search results' : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© | No products available'}</p>
              </div>
            </div>
          `;
          return;
        }

        wrap.innerHTML = productsToRender.map(p => {
          const nameText = combineTexts(p.name?.ar, p.name?.en, p.name?.[lang]);
          const descText = combineTexts(p.desc?.ar, p.desc?.en, p.desc?.[lang]);
          const addLabel = combineTexts('Ø¥Ø¶Ø§ÙØ©', 'Add', lang === 'ar' ? 'Ø¥Ø¶Ø§ÙØ©' : 'Add');
          const altFallback = esc(nameText);
          const placeholderName = encodeURIComponent(p.name?.ar || p.name?.en || 'Product');
          const productImg = p.img || `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='180'><rect width='100%' height='100%' fill='%236c757d'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23fff' font-family='Cairo' font-size='22'>${encodeURIComponent(placeholderName)}</text></svg>`;

          const fallbackImg = `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='220'><rect width='100%' height='100%' fill='%236c757d'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23fff' font-family='Cairo' font-size='20'>${encodeURIComponent(placeholderName)}</text></svg>`;

          // Display price in selected currency
          const currency = p.currency || 'SAR';
          const displayPrice = (p.price || 0).toLocaleString('ar-EG', {
            style: 'currency',
            currency: currency,
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          });

          return `
    <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4 mb-4" style="max-width: 100%;">
      <div class="product-card card h-100" style="max-width: 100%;">
        <div class="card-img-top">
          <img src="${productImg}" 
               class="product-img" 
               alt="${altFallback}"
               loading="lazy"
               onerror="this.onerror=null;this.src='${fallbackImg}'">
        </div>
        <div class="card-body">
          <h5 class="card-title">${esc(nameText)}</h5>
          <p class="card-text">${esc(descText)}</p>
          <div class="d-flex justify-content-between align-items-center mt-auto pt-3 flex-wrap gap-2">
            <span class="h5 mb-0 flex-grow-1">${displayPrice}</span>
            <button class="btn btn-sm add-to-cart" data-id="${p.id}">
              <i class="bi bi-cart-plus me-1"></i> ${addLabel}
            </button>
          </div>
        </div>
      </div>
    </div>`;
        }).join('');
      } catch (error) {
        console.error('Error rendering products:', error);
        wrap.innerHTML = `
          <div class="col-12">
            <div class="alert alert-warning">
              <i class="bi bi-exclamation-triangle me-2"></i>
              Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª | Error loading products
            </div>
          </div>
        `;
      }
    }

    // Search products function
    function searchProducts() {
      const searchInput = document.getElementById('search-products-input');
      const searchTerm = searchInput ? searchInput.value.trim() : '';
      renderProducts(searchTerm);
    }

    // Add event listeners for search
    function initSearchProducts() {
      const searchBtn = document.getElementById('search-products-btn');
      const searchInput = document.getElementById('search-products-input');

      if (searchBtn) {
        // Remove existing listeners to avoid duplicates
        const newBtn = searchBtn.cloneNode(true);
        searchBtn.parentNode.replaceChild(newBtn, searchBtn);
        newBtn.addEventListener('click', searchProducts);
      }

      if (searchInput) {
        // Search on Enter key
        searchInput.addEventListener('keypress', function (e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            searchProducts();
          }
        });

        // Real-time search as user types
        let searchTimeout;
        searchInput.addEventListener('input', function () {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            searchProducts();
          }, 300); // Wait 300ms after user stops typing
        });
      }
    }

    // Initialize search when DOM is ready or immediately if already loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initSearchProducts);
    } else {
      // DOM already loaded, initialize immediately
      setTimeout(initSearchProducts, 100);
    }

    // ===== Language Management =====
    const uiText = {
      ar: {
        "tab-text": "Ù†Øµ | Text",
        "tab-url": "Ø±Ø§Ø¨Ø· | URL",
        "tab-wifi": "ÙˆØ§ÙŠ ÙØ§ÙŠ | Wi Fi",
        "tab-vcard": "Ø¨Ø·Ø§Ù‚Ø© ØªÙˆØ§ØµÙ„ | vCard",
        "tab-social": "ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ | Social",
        "tab-products": "Ù…Ù†ØªØ¬Ø§ØªÙŠ | My Products",
        "accordion1-title": "1ï¸âƒ£ Ù…Ø­ØªÙˆÙ‰ Ø¹Ø§Ù…",
        "accordion2-title": "2ï¸âƒ£ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰",
        "accordion3-title": "3ï¸âƒ£ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©",
        "accordion4-title": "4ï¸âƒ£ Ø§Ø´ØªØ±Ø§ÙƒÙŠ",
        "accordion2-image-label": "Ø§Ø®ØªØ± ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
        "accordion2-text-label": "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:",
        "accordion2-table-label": "Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„:",
        "accordion2-comment-label": "ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
        "accordion3-comment-label": "ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
        "url-comment-label": "ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
        "wifi-comment-label": "ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
        "vcard-comment-label": "ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
        "social-comment-label": "ØªØ¹Ù„ÙŠÙ‚ ÙŠØ¸Ù‡Ø± ØªØ­Øª Ø±Ù…Ø² QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
        "btn-add-phone": "â• Ø£Ø¶Ù Ø±Ù‚Ù… Ù‡Ø§ØªÙ",
        "btn-report-text": "Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±",
        "btn-clear": "ğŸ§¹ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
        "report-title": "ØªÙ‚Ø±ÙŠØ± QR | QR Report",
        "thName": "Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬",
        "thQty": "Ø§Ù„ÙƒÙ…ÙŠØ©",
        "thPrice": "Ø§Ù„Ø³Ø¹Ø±",
        "thTotal": "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
        "cartTotalTitle": "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:",
        "desc-th": "Ø§Ù„ÙˆØµÙ",
        "detail-th": "Ø§Ù„ØªÙØ§ØµÙŠÙ„",
        "remove-th": "Ø­Ø°Ù",
        "vcard-phone-placeholder": "Ø±Ù‚Ù… Ù‡Ø§ØªÙ",
        "social-value-placeholder": "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø·",
        "modal-alert-title": "ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…",
        "modal-alert-body": "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù‚Ø¨Ù„ ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² QR.<br>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ø¹Ù„Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©.",
        "modal-alert-button": "Ù…ÙˆØ§ÙÙ‚",
        "customizer-title": "ØªØ®ØµÙŠØµ Ø±Ù…Ø² QR",
        "label-dots-color": "Ù„ÙˆÙ† Ø§Ù„Ù†Ù‚Ø§Ø·:",
        "label-bg-color": "Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©:",
        "label-dots-type": "Ø´ÙƒÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·:",
        "label-ecc": "ØªØµØ­ÙŠØ­ Ø§Ù„Ø®Ø·Ø£ (ECC):",
        "label-export-type": "Ù†ÙˆØ¹ Ø§Ù„ØªØµØ¯ÙŠØ±:",
        "label-margin": "Ø§Ù„Ø­ÙˆØ§Ù (Quiet Zone):",
        "label-qr-size": "Ø­Ø¬Ù… QR:",
        "label-logo": "Ø¥Ø¶Ø§ÙØ© Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ÙŠ:",
        "logo-note": "Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
        "close-customizer-text": "Ø¥ØºÙ„Ø§Ù‚",
        "enter-code-text": "Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯",
        "alert-text": "Ù…ÙˆÙ„Ø¯ Ø±Ù…Ø² QR Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§ØªØŒ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.<br>Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¨Ø¯ÙˆÙ† Ø²Ø± ØªÙˆÙ„ÙŠØ¯.",
        "add-card-text": "Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø©",
        "save-changes-text": "Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª",
        "shared-qr-note-text": "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† ØªØ´ØªØ±Ùƒ Ø¨Ù†ÙØ³ Ø±Ù…Ø² QR",
        "add-row-text": "Ø£Ø¶Ù Ø³Ø·Ø±",
        "status-text": "Ø§Ù„Ø­Ø§Ù„Ø©:",
        "unknown-status-text": "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
        "valid-until-text": "Ù„Ø¯ÙŠÙƒ Ø§Ø´ØªØ±Ø§Ùƒ ÙØ¹Ø§Ù„ Ø­ØªÙ‰:",
        "admin-code-text": "Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:",
        "viewer-code-text": "Ø±Ù…Ø² Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©:",
        "show-subscription-text": "Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",
        "notifications-text": "Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
        "your-qr-text": "Ø±Ù…Ø² QR Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ",
        "your-qr-title": "Ø±Ù…Ø² QR Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ",
        "admin-code-title": "ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø±Ù",
        "admin-code-desc": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©",
        "download-qr-text": "ØªØ­Ù…ÙŠÙ„ Ø±Ù…Ø² QR",
        "viewer-code-title": "ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯",
        "viewer-code-desc": "Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·",
        "download-qr-text-2": "ØªØ­Ù…ÙŠÙ„ Ø±Ù…Ø² QR",
        "share-codes-text": "Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ù…ÙˆØ²",
        "copy-admin-link-text": "Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¯Ù…Ù†",
        "whatsapp-admin-text": "ÙˆØ§ØªØ³Ø§Ø¨ (Ø£Ø¯Ù…Ù†)",
        "download-admin-text": "ØªØ­Ù…ÙŠÙ„ QR (Ø£Ø¯Ù…Ù†)",
        "copy-viewer-link-text": "Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯",
        "whatsapp-viewer-text": "ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø´Ø§Ù‡Ø¯)",
        "download-viewer-text": "ØªØ­Ù…ÙŠÙ„ QR (Ù…Ø´Ø§Ù‡Ø¯)",
        "subscriptions-text": "Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª",
        "subscription-plans-text": "Ø®Ø·Ø· Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",
        "sub-3months-text": "Ø§Ø´ØªØ±Ø§Ùƒ 3 Ø£Ø´Ù‡Ø±",
        "currency-text": "Ø±ÙŠØ§Ù„",
        "feature-1-text": "Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª",
        "feature-2-text": "Ø±Ù…Ø² QR Ù…Ù…ÙŠØ²",
        "feature-3-text": "Ø¯Ø¹Ù… ÙÙ†ÙŠ 24/7",
        "feature-4-text": "ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ø³ØªÙ…Ø±Ø©",
        "subscribe-now-text": "Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†",
        "sub-6months-text": "Ø§Ø´ØªØ±Ø§Ùƒ 6 Ø£Ø´Ù‡Ø±",
        "currency-text-2": "Ø±ÙŠØ§Ù„",
        "save-10-text": "ÙˆÙØ± 10%",
        "feature-5-text": "ÙƒÙ„ Ù…ÙŠØ²Ø§Øª 3 Ø£Ø´Ù‡Ø±",
        "feature-6-text": "ØªØ®Ø²ÙŠÙ† ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯",
        "feature-7-text": "Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¯Ø¹Ù…",
        "subscribe-now-text-2": "Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†",
        "sub-yearly-text": "Ø§Ø´ØªØ±Ø§Ùƒ Ø³Ù†ÙˆÙŠ",
        "currency-text-3": "Ø±ÙŠØ§Ù„",
        "save-20-text": "ÙˆÙØ± 20%",
        "feature-8-text": "ÙƒÙ„ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ 6 Ø£Ø´Ù‡Ø±",
        "feature-9-text": "Ù†Ø·Ø§Ù‚ Ù…Ø®ØµØµ",
        "feature-10-text": "Ù…Ø¯ÙŠØ± Ø­Ø³Ø§Ø¨",
        "subscribe-now-text-3": "Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†",
        "products-text": "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
        "products-list-text": "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
        "hidden-network-text": "Ø´Ø¨ÙƒØ© Ù…Ø®ÙÙŠØ©",
        "add-social-text": "Ø£Ø¶Ù ÙˆØ³ÙŠÙ„Ø© ØªÙˆØ§ØµÙ„",
        "copy-all-links-text": "Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·",
        "generate-qr-text": "ØªÙˆÙ„ÙŠØ¯ QR Ù„ÙƒÙ„ Ø±Ø§Ø¨Ø·",
        "copied-text": "ØªÙ… Ø§Ù„Ù†Ø³Ø®!",
        "social-help-text": "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙˆØ³ÙŠÙ„Ø© Ø£Ùˆ Ø£ÙƒØ«Ø±ØŒ ÙˆØªØ±ØªÙŠØ¨Ù‡Ø§ ÙˆØ³Ø­Ø¨Ù‡Ø§ Ø¨Ø­Ø±ÙŠØ©",
        "rights-reserved-text": "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.",
        "cart-title": "Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª",
        "complete-purchase-text": "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡",
        "close-text": "Ø¥ØºÙ„Ø§Ù‚",
        "enter-code-title": "Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯",
        "enter-code-label": "Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£Ùˆ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©",
        "verify-code-text": "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯",
        "date-label-text": "Ø§Ù„ØªØ§Ø±ÙŠØ®",
        "description-label-text": "Ø§Ù„ÙˆØµÙ/Ø§Ù„Ø±Ø§Ø¨Ø·/Ø§Ù„Ø±Ù‚Ù…/Ø§Ù„ØªØ§Ø±ÙŠØ®",
        "attachments-label-text": "Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 3 Ù…Ù„ÙØ§Øª)",
        "notes-label-text": "Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"
      },
      en: {
        "tab-text": "Text | Ù†Øµ",
        "tab-url": "URL | Ø±Ø§Ø¨Ø·",
        "tab-wifi": "Wi Fi | ÙˆØ§ÙŠ ÙØ§ÙŠ",
        "tab-vcard": "vCard | Ø¨Ø·Ø§Ù‚Ø© ØªÙˆØ§ØµÙ„",
        "tab-social": "Social | ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„",
        "tab-products": "My Products | Ù…Ù†ØªØ¬Ø§ØªÙŠ",
        "accordion1-title": "1ï¸âƒ£ General Content",
        "accordion2-title": "2ï¸âƒ£ Content Details",
        "accordion3-title": "3ï¸âƒ£ Additional Notes",
        "accordion4-title": "4ï¸âƒ£ My Subscription",
        "accordion2-image-label": "Choose image (optional):",
        "accordion2-text-label": "Enter main text:",
        "accordion2-table-label": "Description and details table:",
        "accordion2-comment-label": "Comment below QR (optional):",
        "accordion3-comment-label": "Comment below QR (optional):",
        "url-comment-label": "Comment below QR (optional):",
        "wifi-comment-label": "Comment below QR (optional):",
        "vcard-comment-label": "Comment below QR (optional):",
        "social-comment-label": "Comment below QR (optional):",
        "btn-add-phone": "â• Add phone",
        "btn-report-text": "Show Report",
        "btn-clear": "ğŸ§¹ Clear All",
        "report-title": "QR Report | ØªÙ‚Ø±ÙŠØ± QR",
        "thName": "Product Name",
        "thQty": "Quantity",
        "thPrice": "Price",
        "thTotal": "Total",
        "cartTotalTitle": "Total:",
        "desc-th": "Description",
        "detail-th": "Details",
        "remove-th": "Remove",
        "vcard-phone-placeholder": "Phone number",
        "social-value-placeholder": "Enter username or link",
        "modal-alert-title": "Important Notice",
        "modal-alert-body": "Please verify the entered data before generating QR code.<br>Use this tool at your own responsibility.",
        "modal-alert-button": "OK",
        "customizer-title": "Customize QR Code",
        "label-dots-color": "Dots Color:",
        "label-bg-color": "Background Color:",
        "label-dots-type": "Dots Type:",
        "label-ecc": "Error Correction (ECC):",
        "label-export-type": "Export Type:",
        "label-margin": "Margin (Quiet Zone):",
        "label-qr-size": "QR Size:",
        "label-logo": "Add Internal Logo:",
        "logo-note": "Will be activated later by administration",
        "close-customizer-text": "Close",
        "enter-code-text": "Enter Code",
        "alert-text": "Multi-purpose QR generator, supports Arabic and English.<br>Real-time update without generate button.",
        "add-card-text": "Add Card",
        "save-changes-text": "Save Changes",
        "shared-qr-note-text": "All cards in this accordion share the same QR code",
        "add-row-text": "Add Row",
        "status-text": "Status:",
        "unknown-status-text": "Unknown",
        "valid-until-text": "Your subscription is valid until:",
        "admin-code-text": "Admin Code:",
        "viewer-code-text": "Viewer Code:",
        "show-subscription-text": "Show Subscription Alert",
        "notifications-text": "Notifications",
        "your-qr-text": "Your QR Code",
        "your-qr-title": "Your QR Code",
        "admin-code-title": "Admin Code",
        "admin-code-desc": "Use this code to access the control panel and full administration",
        "download-qr-text": "Download QR",
        "viewer-code-title": "Viewer Code",
        "viewer-code-desc": "Use this code to access content for viewing only",
        "download-qr-text-2": "Download QR",
        "share-codes-text": "Share Codes",
        "copy-admin-link-text": "Copy Admin Link",
        "whatsapp-admin-text": "WhatsApp (Admin)",
        "download-admin-text": "Download QR (Admin)",
        "copy-viewer-link-text": "Copy Viewer Link",
        "whatsapp-viewer-text": "WhatsApp (Viewer)",
        "download-viewer-text": "Download QR (Viewer)",
        "subscriptions-text": "Subscriptions",
        "subscription-plans-text": "Subscription Plans",
        "sub-3months-text": "3 Months Subscription",
        "currency-text": "SAR",
        "feature-1-text": "Full product management",
        "feature-2-text": "Premium QR code",
        "feature-3-text": "24/7 technical support",
        "feature-4-text": "Continuous updates",
        "subscribe-now-text": "Subscribe Now",
        "sub-6months-text": "6 Months Subscription",
        "currency-text-2": "SAR",
        "save-10-text": "Save 10%",
        "feature-5-text": "All 3-month features",
        "feature-6-text": "Unlimited storage",
        "feature-7-text": "Priority support",
        "subscribe-now-text-2": "Subscribe Now",
        "sub-yearly-text": "Yearly Subscription",
        "currency-text-3": "SAR",
        "save-20-text": "Save 20%",
        "feature-8-text": "All 6-month features",
        "feature-9-text": "Custom domain",
        "feature-10-text": "Account manager",
        "subscribe-now-text-3": "Subscribe Now",
        "products-text": "Products",
        "products-list-text": "Products List",
        "hidden-network-text": "Hidden network",
        "add-social-text": "Add social media",
        "copy-all-links-text": "Copy all links",
        "generate-qr-text": "Generate QR for each link",
        "copied-text": "Copied!",
        "social-help-text": "You can add one or more, arrange and drag them freely",
        "rights-reserved-text": "All rights reserved.",
        "cart-title": "Shopping Cart",
        "complete-purchase-text": "Complete Purchase",
        "close-text": "Close",
        "enter-code-title": "Enter Code",
        "enter-code-label": "Enter admin or viewer code",
        "verify-code-text": "Verify Code",
        "date-label-text": "Date",
        "description-label-text": "Description/Link/Number/Date",
        "attachments-label-text": "Attachments (max 3 files)",
        "notes-label-text": "Notes"
      }
    };

    let bilingualEnabled = lsGet('egf.qr.bilingual') !== 'false'; // Default: true, can be toggled
    const bilingualSeparator = ' | ';
    const hasPipe = value => typeof value === 'string' && value.includes('|');
    const combineTexts = (arVal, enVal, fallback = '') => {
      if (!bilingualEnabled) return (document.documentElement.lang === 'ar' ? (arVal ?? fallback) : (enVal ?? fallback));
      if (hasPipe(arVal)) return arVal;
      if (hasPipe(enVal)) return enVal;
      if (arVal && enVal) return `${arVal}${bilingualSeparator}${enVal}`;
      return arVal || enVal || fallback;
    };
    const both = (arVal, enVal) => combineTexts(arVal, enVal);

    // Bilingual toggle button functionality
    function updateBilingualButton() {
      const btn = document.getElementById('toggle-bilingual');
      if (!btn) return;

      if (bilingualEnabled) {
        btn.classList.remove('btn-outline-info');
        btn.classList.add('btn-info');
        btn.setAttribute('aria-label', both('ÙˆØ¶Ø¹ Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù„ØºØ©', 'Bilingual Mode'));
        btn.setAttribute('title', both('ÙˆØ¶Ø¹ Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù„ØºØ©', 'Bilingual Mode'));
        btn.setAttribute('data-bilingual', 'true');
      } else {
        btn.classList.remove('btn-info');
        btn.classList.add('btn-outline-info');
        btn.setAttribute('aria-label', both('ÙˆØ¶Ø¹ Ù„ØºØ© ÙˆØ§Ø­Ø¯Ø©', 'Single Language'));
        btn.setAttribute('title', both('ÙˆØ¶Ø¹ Ù„ØºØ© ÙˆØ§Ø­Ø¯Ø©', 'Single Language'));
        btn.setAttribute('data-bilingual', 'false');
      }
    }

    document.getElementById('toggle-bilingual')?.addEventListener('click', function () {
      bilingualEnabled = !bilingualEnabled;
      lsSet('egf.qr.bilingual', bilingualEnabled ? 'true' : 'false');
      updateBilingualButton();
      setLanguage(document.documentElement.lang); // Re-apply current language with new mode
      showToast(both(
        bilingualEnabled ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù„ØºØ©' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ ÙˆØ¶Ø¹ Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù„ØºØ©',
        bilingualEnabled ? 'Bilingual mode enabled' : 'Bilingual mode disabled'
      ), 'info');
    });

    function applyBilingualStatics() {
      if (!bilingualEnabled) return;

      const setNodeContent = (node, value) => {
        if (value == null || value === '') return;
        if (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA') node.placeholder = value;
        else node.innerHTML = value;
      };

      const allKeys = new Set([
        ...Object.keys(uiText.ar || {}),
        ...Object.keys(uiText.en || {})
      ]);

      allKeys.forEach(key => {
        const node = document.getElementById(key);
        if (!node) return;
        const combined = combineTexts(uiText.ar?.[key], uiText.en?.[key], node.innerHTML);
        setNodeContent(node, combined);
      });

      document.querySelectorAll('[data-i18n]').forEach(node => {
        const k = node.getAttribute('data-i18n');
        if (!k) return;
        const combined = combineTexts(uiText.ar?.[k], uiText.en?.[k], node.innerHTML);
        setNodeContent(node, combined);
      });

      document.querySelectorAll('.vcard-phone').forEach(el => {
        el.placeholder = combineTexts(uiText.ar?.['vcard-phone-placeholder'], uiText.en?.['vcard-phone-placeholder'], el.placeholder);
      });

      document.querySelectorAll('.social-value').forEach(el => {
        el.placeholder = combineTexts(uiText.ar?.['social-value-placeholder'], uiText.en?.['social-value-placeholder'], el.placeholder);
      });

      document.querySelectorAll('.card-number-text').forEach(el => {
        const id = el.closest('.custom-card')?.getAttribute('data-card-id');
        const idx = id != null ? Number(id) + 1 : undefined;
        el.textContent = combineTexts(idx ? `Ø¨Ø·Ø§Ù‚Ø© ${idx}` : 'Ø¨Ø·Ø§Ù‚Ø©', idx ? `Card ${idx}` : 'Card', el.textContent);
      });

      document.querySelectorAll('.date-label-text').forEach(el => {
        el.textContent = combineTexts(uiText.ar?.['date-label-text'], uiText.en?.['date-label-text'], el.textContent);
      });
      document.querySelectorAll('.description-label-text').forEach(el => {
        el.textContent = combineTexts(uiText.ar?.['description-label-text'], uiText.en?.['description-label-text'], el.textContent);
      });
      document.querySelectorAll('.attachments-label-text').forEach(el => {
        el.textContent = combineTexts(uiText.ar?.['attachments-label-text'], uiText.en?.['attachments-label-text'], el.textContent);
      });
      document.querySelectorAll('.notes-label-text').forEach(el => {
        el.textContent = combineTexts(uiText.ar?.['notes-label-text'], uiText.en?.['notes-label-text'], el.textContent);
      });

      const bilingualStaticNodes = [
        { selector: '#dots-type option[value="rounded"]', ar: 'Ù…Ø³ØªØ¯ÙŠØ±', en: 'Rounded' },
        { selector: '#dots-type option[value="dots"]', ar: 'Ù…Ù†Ù‚Ø·', en: 'Dotted' },
        { selector: '#dots-type option[value="classy"]', ar: 'ÙƒÙ„Ø§Ø³ÙŠÙƒ', en: 'Classy' },
        { selector: '#dots-type option[value="square"]', ar: 'Ù…Ø±Ø¨Ø¹', en: 'Square' },
        { selector: '#dots-type option[value="extra-rounded"]', ar: 'Ù…Ø³ØªØ¯ÙŠØ± Ø¬Ø¯Ø§Ù‹', en: 'Extra Rounded' },
        { selector: '#qr-ecc option[value="L"]', ar: 'L (Ø£Ù‚Ù„)', en: 'L (Low)' },
        { selector: '#qr-ecc option[value="M"]', ar: 'M (Ù…ØªÙˆØ³Ø·)', en: 'M (Medium)' },
        { selector: '#qr-ecc option[value="Q"]', ar: 'Q (Ø¬ÙŠØ¯)', en: 'Q (Quality)' },
        { selector: '#qr-ecc option[value="H"]', ar: 'H (Ø£Ø¹Ù„Ù‰)', en: 'H (High)' },
        { selector: '#qr-type option[value="canvas"]', ar: 'ÙƒØ§Ù†ÙØ³', en: 'Canvas' },
        { selector: '#qr-type option[value="svg"]', ar: 'Ø¥Ø³ ÙÙŠ Ø¬ÙŠ', en: 'SVG' },
        { selector: '#wifi-type option[value="WPA"]', ar: 'Ù…Ø­Ù…ÙŠØ© (WPA/WPA2)', en: 'Protected (WPA/WPA2)' },
        { selector: '#wifi-type option[value="WEP"]', ar: 'Ù…Ø­Ù…ÙŠØ© (WEP)', en: 'Protected (WEP)' },
        { selector: '#wifi-type option[value="nopass"]', ar: 'Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±', en: 'No password' },
        { selector: '#wifi-hidden', ar: 'Ø´Ø¨ÙƒØ© Ù…Ø®ÙÙŠØ©', en: 'Hidden network', attr: 'label' },
        { selector: '#qr-logo', ar: 'Ø¥Ø¶Ø§ÙØ© Ø´Ø¹Ø§Ø± Ø¯Ø§Ø®Ù„ÙŠ', en: 'Embed inner logo', attr: 'label' }
      ];

      bilingualStaticNodes.forEach(cfg => {
        document.querySelectorAll(cfg.selector).forEach(node => {
          const value = combineTexts(cfg.ar, cfg.en, node.textContent || node.placeholder || '');
          if (cfg.attr === 'label') {
            if (node.nextElementSibling && node.nextElementSibling.tagName === 'LABEL') node.nextElementSibling.textContent = value;
            else node.setAttribute('aria-label', value);
          }
          else if (node.tagName === 'OPTION') node.textContent = value;
          else if (node.tagName === 'INPUT') node.placeholder = value;
          else node.textContent = value;
        });
      });
    }

    function setLanguage(lang) {
      document.documentElement.lang = lang;
      document.documentElement.dir = (lang === "ar") ? "rtl" : "ltr";

      const currentMap = uiText[lang] || {};

      // (1) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø°Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª IDs
      for (const key in currentMap) {
        const el = document.getElementById(key);
        if (!el) continue;
        const value = combineTexts(uiText.ar?.[key], uiText.en?.[key], currentMap[key]);
        if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") el.placeholder = value;
        else el.innerHTML = value;
      }

      // (2) ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ØµØ± data-i18n
      document.querySelectorAll('[data-i18n]').forEach(node => {
        const k = node.getAttribute('data-i18n');
        if (!k) return;
        const value = combineTexts(uiText.ar?.[k], uiText.en?.[k], uiText[lang]?.[k] ?? node.innerHTML);
        if (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA') node.placeholder = value;
        else node.innerHTML = value;
      });

      // (3) ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„
      document.querySelectorAll('.vcard-phone').forEach(e => {
        e.placeholder = combineTexts(uiText.ar?.['vcard-phone-placeholder'], uiText.en?.['vcard-phone-placeholder'], e.placeholder);
      });

      document.querySelectorAll('.social-value').forEach(e => {
        e.placeholder = combineTexts(uiText.ar?.['social-value-placeholder'], uiText.en?.['social-value-placeholder'], e.placeholder);
      });

      document.querySelectorAll('.card-number-text').forEach(e => {
        const id = e.closest('.custom-card')?.getAttribute('data-card-id');
        const n = (id != null) ? (Number(id) + 1) : '';
        e.textContent = combineTexts(n ? `Ø¨Ø·Ø§Ù‚Ø© ${n}` : 'Ø¨Ø·Ø§Ù‚Ø©', n ? `Card ${n}` : 'Card', e.textContent);
      });

      document.querySelectorAll('.date-label-text').forEach(e => {
        e.textContent = combineTexts(uiText.ar?.['date-label-text'], uiText.en?.['date-label-text'], e.textContent);
      });
      document.querySelectorAll('.description-label-text').forEach(e => {
        e.textContent = combineTexts(uiText.ar?.['description-label-text'], uiText.en?.['description-label-text'], e.textContent);
      });
      document.querySelectorAll('.attachments-label-text').forEach(e => {
        e.textContent = combineTexts(uiText.ar?.['attachments-label-text'], uiText.en?.['attachments-label-text'], e.textContent);
      });
      document.querySelectorAll('.notes-label-text').forEach(e => {
        e.textContent = combineTexts(uiText.ar?.['notes-label-text'], uiText.en?.['notes-label-text'], e.textContent);
      });

      const langBtn = document.getElementById('toggle-lang');
      if (langBtn) {
        const label = combineTexts('Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'English', lang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©');
        langBtn.setAttribute('title', label);
        langBtn.setAttribute('aria-label', label);
      }

      const dlBtn = document.getElementById('main-qr-download');
      if (dlBtn) {
        dlBtn.textContent = combineTexts('ØªØ­Ù…ÙŠÙ„ QR', 'Download QR', dlBtn.textContent);
      }

      // (4) Ø¥Ø¹Ø§Ø¯Ø© Ø±Ù†Ø¯Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆÙÙ‚ Ø§Ù„Ù„ØºØ©
      renderProducts();
      applyBilingualStatics();
      updateBilingualButton(); // Update button state after language change
    }



    function observeDynamicPlaceholders() {
      document.addEventListener('click', function (e) {
        if (e.target && e.target.id === 'add-phone') setTimeout(() => setLanguage(document.documentElement.lang), 10);
        if (e.target && e.target.id === 'add-social') setTimeout(() => setLanguage(document.documentElement.lang), 10);
      });
    }

    function refreshFlatpickrLocale() {
      const locale = document.documentElement.lang === "ar" ? "ar" : "default";
      document.querySelectorAll('input.card-date').forEach(inp => {
        if (inp._flatpickr) inp._flatpickr.set('locale', locale);
      });
    }

    document.getElementById("toggle-lang").addEventListener("click", function () {
      this.classList.remove('animate-pop'); void this.offsetWidth; this.classList.add('animate-pop');
      const lang = document.documentElement.lang === "ar" ? "en" : "ar";
      setLanguage(lang);
      setTimeout(() => refreshFlatpickrLocale(), 250);
    });

    // ===== Image upload for accordion 2 =====
    document.addEventListener('change', function (e) {
      if (e.target && e.target.classList.contains('accordion-image')) {
        if (typeof getRole === 'function' && getRole() === 'viewer') {
          showToast(document.documentElement.lang === 'ar' ? 'ØºÙŠØ± Ù…ÙØµØ±Ù‘Ø­ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯.' : 'Not allowed for viewer.', 'danger');
          e.target.value = '';
          return;
        }
        const accordionId = e.target.getAttribute('data-accordion');
        const file = e.target.files[0];
        const previewEl = document.querySelector(`.accordion-image-preview[data-accordion="${accordionId}"]`);

        if (file) {
          const reader = new FileReader();
          reader.onload = function (ev) {
            accordionData[accordionId].image = ev.target.result;
            previewEl.innerHTML = `<img src="${ev.target.result}" class="img-preview shadow-sm" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©">`;
            updateAccordionQR(accordionId);
          };
          reader.readAsDataURL(file);
        } else {
          accordionData[accordionId].image = '';
          previewEl.innerHTML = '';
          updateAccordionQR(accordionId);
        }
      }
    });

    document.addEventListener('input', function (e) {
      if (e.target && e.target.classList.contains('accordion-text')) {
        const accordionId = e.target.getAttribute('data-accordion');
        accordionData[accordionId].text = e.target.value;
        updateAccordionQR(accordionId);
      }
    });

    document.addEventListener('input', function (e) {
      if (e.target && e.target.classList.contains('accordion-comment')) {
        const accordionId = e.target.getAttribute('data-accordion');
        accordionData[accordionId].comment = e.target.value;
        updateAccordionQR(accordionId);
      }
    });

    // ===== Table rows for accordion 2 =====
    document.addEventListener('click', function (e) {
      if (e.target.closest('.accordion-add-row')) {
        if (typeof getRole === 'function' && getRole() === 'viewer') {
          showToast(document.documentElement.lang === 'ar' ? 'ØºÙŠØ± Ù…ÙØµØ±Ù‘Ø­ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯.' : 'Not allowed for viewer.', 'danger');
          return;
        }
        const accordionId = e.target.closest('.accordion-add-row').getAttribute('data-accordion');
        const table = document.querySelector(`.accordion-table[data-accordion="${accordionId}"] tbody`);

        table.innerHTML += `
      <tr>
        <td><input type="text" class="form-control desc-title" placeholder="${document.documentElement.lang === 'ar' ? 'Ø§Ù„ÙˆØµÙ' : 'Description'}"></td>
        <td><input type="text" class="form-control desc-value" placeholder="${document.documentElement.lang === 'ar' ? 'Ø§Ù„ØªÙØ§ØµÙŠÙ„' : 'Details'}"></td>
        <td><span class="remove-desc viewer-hide" title="${document.documentElement.lang === 'ar' ? 'Ø­Ø°Ù' : 'Delete'}"><i class="bi bi-trash"></i></span></td>
      </tr>
    `;
      }

      if (e.target.closest('.remove-desc')) {
        if (typeof getRole === 'function' && getRole() === 'viewer') {
          showToast(document.documentElement.lang === 'ar' ? 'ØºÙŠØ± Ù…ÙØµØ±Ù‘Ø­ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯.' : 'Not allowed for viewer.', 'danger');
          return;
        }
        const row = e.target.closest('tr');
        const accordionId = row.closest('.accordion-table').getAttribute('data-accordion');
        row.remove();
        updateTableData(accordionId);
        updateAccordionQR(accordionId);
      }
    });

    document.addEventListener('input', function (e) {
      if (e.target && (e.target.classList.contains('desc-title') || e.target.classList.contains('desc-value'))) {
        const accordionId = e.target.closest('.accordion-table').getAttribute('data-accordion');
        updateTableData(accordionId);
        updateAccordionQR(accordionId);
      }
    });

    function updateTableData(accordionId) {
      const tableData = [];

      document.querySelectorAll(`.accordion-table[data-accordion="${accordionId}"] tbody tr`).forEach(function (row) {
        const title = row.querySelector('.desc-title').value.trim();
        const value = row.querySelector('.desc-value').value.trim();
        tableData.push({ title, value });
      });

      accordionData[accordionId].table = tableData;
    }

    // ===== Report Generation =====
    document.getElementById('btn-report').addEventListener('click', function () {
      let html = '';
      const lang = document.documentElement.lang;

      // === Accordions ===
      html += generateAccordionReport();

      // === URL ===
      let rawUrl = document.getElementById('qr-input-url').value.trim();
      let url = normalizeUrl(rawUrl);

      if (url) {
        const title = lang === "ar" ? "Ø§Ù„Ø±Ø§Ø¨Ø·" : "URL";
        const safeUrl = esc(url);

        html += `<div class="report-tab-section">`;
        html += `<h4><i class="bi bi-link-45deg"></i> ${title}</h4>`;
        html += `<div class="p-2 bg-light rounded"><a href="${safeUrl}" target="_blank" rel="noopener">${safeUrl}</a></div>`;
        html += `<div class="report-qr-container mt-4"><div class="report-qr" id="url-report-qr"></div>`;

        const urlComment = esc(document.getElementById("url-comment").value || '');
        if (urlComment) html += `<div class="report-comment">${urlComment}</div>`;

        html += `</div></div>`;
      }

      // === Wi-Fi ===
      const ssid = document.getElementById('wifi-ssid').value.trim();
      const pwd = document.getElementById('wifi-password').value.trim();
      const wtype = document.getElementById('wifi-type').value;
      const hidden = document.getElementById('wifi-hidden').checked;

      const wifiPayload = (ssid && (wtype === 'nopass' || pwd)) ? buildWifiString() : '';

      if (wifiPayload) {
        const title = "Wi-Fi";

        html += `<div class="report-tab-section">`;
        html += `<h4><i class="bi bi-wifi"></i> ${title}</h4>`;
        html += `<div class="row">`;
        html += `<div class="col-6"><strong>${lang === "ar" ? "Ø§Ù„Ø§Ø³Ù…:" : "SSID:"}</strong> ${esc(ssid)}</div>`;
        html += `<div class="col-6"><strong>${lang === "ar" ? "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:" : "Password:"}</strong> ${esc(wtype === 'nopass' ? 'â€”' : pwd)}</div>`;
        html += `<div class="col-6"><strong>${lang === "ar" ? "Ù…Ø®ÙÙŠ:" : "Hidden:"}</strong> ${hidden ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</div>`;
        html += `</div>`;
        html += `<div class="report-qr-container mt-4"><div class="report-qr" id="wifi-report-qr"></div>`;

        const wifiComment = esc(document.getElementById("wifi-comment").value || '');
        if (wifiComment) html += `<div class="report-comment">${wifiComment}</div>`;

        html += `</div></div>`;
      }

      // === vCard ===
      const vName = document.getElementById('vcard-name').value.trim();
      const vTitle = document.getElementById('vcard-title').value.trim();
      const vEmail = document.getElementById('vcard-email').value.trim();
      const vOrg = document.getElementById('vcard-org').value.trim();
      const vNote = document.getElementById('vcard-note').value.trim();

      const vPhones = [];
      document.querySelectorAll(".vcard-phone").forEach(input => {
        let val = input.value.trim();
        if (val) vPhones.push(val);
      });

      const vHas = vName || vTitle || vEmail || vOrg || vNote || vPhones.length;

      if (vHas) {
        const title = lang === "ar" ? "Ø¨Ø·Ø§Ù‚Ø© vCard" : "vCard";

        html += `<div class="report-tab-section">`;
        html += `<h4><i class="bi bi-person-badge"></i> ${title}</h4>`;
        html += `<ul class="mb-1">`;

        if (vName) html += `<li><strong>${lang === "ar" ? "Ø§Ù„Ø§Ø³Ù…:" : "Name:"}</strong> ${esc(vName)}</li>`;
        if (vTitle) html += `<li><strong>${lang === "ar" ? "Ø§Ù„Ù…Ø³Ù…Ù‰:" : "Title:"}</strong> ${esc(vTitle)}</li>`;
        if (vEmail) html += `<li><strong>${lang === "ar" ? "Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:" : "Email:"}</strong> ${esc(vEmail)}</li>`;
        if (vOrg) html += `<li><strong>${lang === "ar" ? "Ø§Ù„Ø´Ø±ÙƒØ©:" : "Company:"}</strong> ${esc(vOrg)}</li>`;
        if (vNote) html += `<li><strong>${lang === "ar" ? "Ù…Ù„Ø§Ø­Ø¸Ø©:" : "Note:"}</strong> ${esc(vNote)}</li>`;

        vPhones.forEach(ph => html += `<li><strong>${lang === "ar" ? "Ù‡Ø§ØªÙ:" : "Phone:"}</strong> ${esc(ph)}</li>`);

        html += `</ul>`;
        html += `<div class="report-qr-container mt-4"><div class="report-qr" id="vcard-report-qr"></div>`;

        const vComment = esc(document.getElementById("vcard-comment").value || '');
        if (vComment) html += `<div class="report-comment">${vComment}</div>`;

        html += `</div></div>`;
      }

      // === Social Media ===
      let socials = [];
      document.querySelectorAll("#social-accounts .input-group").forEach(row => {
        let type = row.querySelector(".social-type").value;
        let value = row.querySelector(".social-value").value.trim();
        if (value) socials.push({ type, value });
      });

      if (socials.length) {
        const title = lang === "ar" ? "ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„" : "Social Media";

        html += `<div class="report-tab-section">`;
        html += `<h4><i class="bi bi-share"></i> ${title}</h4>`;
        html += `<div class="row g-3">`;

        socials.forEach(acc => {
          let meta = socialTypes.find(s => s.value === acc.type);
          let socialIcon = meta?.icon || "bi-link-45deg";
          let name = lang === "ar" ? (meta?.name_ar || "Ø£Ø®Ø±Ù‰") : (meta?.name_en || "Other");
          let link = formatSocialLink(acc.type, acc.value, false);
          const href = safeHref(link);

          html += `
        <div class="col-12 col-md-6">
          <div class="d-flex align-items-center gap-2 border rounded p-2 bg-light">
            <span class="social-icon"><i class="bi ${socialIcon}"></i></span>
            <span class="fw-bold">${esc(name)}</span>
            ${href ? `<a href="${esc(href)}" target="_blank" class="text-break ms-2" rel="noopener">${esc(link)}</a>` : `<span class="text-break ms-2">${esc(link)}</span>`}
          </div>
          <div class="text-center mt-3"><div class="social-qr-report" style="display:inline-block; width:150px; height:150px;" data-link="${esc(link)}"></div></div>
        </div>
      `;
        });

        const socialComment = esc(document.getElementById("social-comment").value || '');
        html += `</div>${socialComment ? `<div class="report-comment">${socialComment}</div>` : ''}</div>`;
      }

      // --- A2 wrapper with fixed header/footer on print ---
      const bilingualTitle = 'ØªÙ‚Ø±ÙŠØ± QR | QR Report';
      const logoSrc = (document.getElementById('site-logo')?.src) || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”·</text></svg>';

      const wrapper = `
    <div class="a2-page">
      <div class="a2-header print-header">
        <img src="${logoSrc}" alt="logo" style="width:28mm;height:28mm;object-fit:contain;">
        <div style="font-weight:700;font-size:16pt">${bilingualTitle}</div>
      </div>
      <div class="a2-content print-content" id="a2-content">
        ${html}
      </div>
      <div class="a2-footer print-footer">
        <span>Eg.Future Â©</span>
        <span id="a2-date"></span>
      </div>
    </div>
  `;

      document.getElementById('report-body').innerHTML = wrapper;
      document.getElementById('a2-date').textContent = new Date().toLocaleDateString();

      // Ø®Ù„ÙÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù†Ø³
      const reportBody = document.getElementById('report-body');
      reportBody.style.background = genderStyle === 'male' ? '#eef4ff' : genderStyle === 'female' ? '#fff7fa' : '#fff';

      // âš ï¸ Ù„Ø§ Ù†Ø¹ÙŠØ¯ ØªØ¹Ø±ÙŠÙ fitReportToModal Ù‡Ù†Ø§ â€” Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
      fitReportToModal();

      // ØªÙˆÙ„ÙŠØ¯ Ø£ÙƒÙˆØ§Ø¯ QR Ø¯Ø§Ø®Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
      setTimeout(() => {
        const appendQR = (selector, data, big = false) => {
          const host = document.querySelector(selector);
          if (!host || !data) return;

          host.innerHTML = '';
          const size = big ? 250 : 150;

          const qr = new QRCodeStyling({
            width: size,
            height: size,
            type: "canvas",
            data,
            dotsOptions: { color: qrCustomization.dotsColor, type: qrCustomization.dotsType },
            backgroundOptions: { color: qrCustomization.bgColor },
            qrOptions: { errorCorrectionLevel: qrCustomization.ecc },
            margin: qrCustomization.margin
          });

          qr.append(host);
        };

        // Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ†Ø§Øª
        if (document.querySelector('#report-accordion-qr-1')) {
          appendQR('#report-accordion-qr-1', getAccordionQRData(1), true);
        }
        appendQR('#report-accordion-qr-2', getAccordionQRData(2), true);
        appendQR('#report-accordion-qr-3', getAccordionQRData(3), true);

        // URL / Wi-Fi / vCard
        appendQR('#url-report-qr', url, true);
        appendQR('#wifi-report-qr', wifiPayload, true);

        const vPhones = [];
        document.querySelectorAll(".vcard-phone").forEach(input => {
          let val = input.value.trim();
          if (val) vPhones.push(val);
        });

        if (vHas) {
          appendQR('#vcard-report-qr', buildVcardString({
            name: vName,
            title: vTitle,
            email: vEmail,
            org: vOrg,
            note: vNote,
            phones: vPhones
          }), true);
        }

        // Socials
        document.querySelectorAll('.social-qr-report').forEach(container => {
          const link = container.getAttribute('data-link');
          if (!link) return;

          container.innerHTML = '';
          const qr = new QRCodeStyling({
            width: 150,
            height: 150,
            type: 'canvas',
            data: link,
            dotsOptions: { color: qrCustomization.dotsColor, type: qrCustomization.dotsType },
            backgroundOptions: { color: qrCustomization.bgColor },
            qrOptions: { errorCorrectionLevel: qrCustomization.ecc },
            margin: qrCustomization.margin
          });

          qr.append(container);
        });

        // Ø£Ø¹ÙØ¯ Ø¶Ø¨Ø· Ø§Ù„Ù€ Scale Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ canvases
        fitReportToModal();
      }, 80);

      var reportModal = new bootstrap.Modal(document.getElementById('reportModal'));
      reportModal.show();
    });

    function generateAccordionReport() {
      let html = '';
      const lang = document.documentElement.lang;

      for (let i = 1; i <= 3; i++) {
        const titles = {
          1: { ar: "1ï¸âƒ£ Ù…Ø­ØªÙˆÙ‰ Ø¹Ø§Ù…", en: "1ï¸âƒ£ General Content" },
          2: { ar: "2ï¸âƒ£ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰", en: "2ï¸âƒ£ Content Details" },
          3: { ar: "3ï¸âƒ£ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©", en: "3ï¸âƒ£ Additional Notes" }
        };

        const title = lang === "ar" ? titles[i].ar : titles[i].en;

        if (i === 1) {
          const hasCards = generalCards.some(c => c);
          if (!hasCards) continue;

          html += `<div class="report-accordion-section"><h4>${esc(title)}</h4>`;

          generalCards.forEach((card) => {
            if (!card) return;

            html += `<div class="mb-3 p-3 border rounded">`;

            if (card.date) {
              html += `<div><strong>${lang === "ar" ? "Ø§Ù„ØªØ§Ø±ÙŠØ®:" : "Date:"}</strong> ${esc(card.date)}</div>`;
            }

            if (card.description) {
              html += `<div><strong>${lang === "ar" ? "Ø§Ù„ÙˆØµÙ:" : "Description:"}</strong> ${esc(card.description)}</div>`;
            }

            if (card.files && card.files.length > 0) {
              html += `<div><strong>${lang === "ar" ? "Ø§Ù„Ù…Ù„ÙØ§Øª:" : "Files:"}</strong><ul class="list-unstyled ms-3">`;

              card.files.forEach(file => {
                if (file.type === 'image') {
                  html += `<li><img src="${file.preview}" class="img-preview shadow-sm" alt="${esc(file.name)}"> ${esc(file.name)}</li>`;
                } else {
                  let iconClass = file.type === 'pdf' ? 'bi-file-earmark-pdf-fill' : 'bi-file-earmark-word-fill';
                  html += `<li><i class="bi ${iconClass}"></i> ${esc(file.name)}</li>`;
                }
              });

              html += `</ul></div>`;
            }

            if (card.notes) {
              html += `<div><strong>${lang === "ar" ? "Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:" : "Notes:"}</strong> <div class="p-2 bg-light rounded">${esc(card.notes)}</div></div>`;
            }

            html += `</div>`;
          });

          html += `<div class="report-qr-container"><div class="report-qr" id="report-accordion-qr-1"></div></div>`;

          const c = accordionData[1].comment;
          if (c) html += `<div class="report-comment">${esc(c)}</div>`;

          html += `</div>`;
          continue;
        }

        const data = accordionData[i];
        const hasContent = data.text || data.image || data.table.length > 0 || data.comment;

        if (!hasContent) continue;

        html += `<div class="report-accordion-section"><h4>${esc(title)}</h4>`;

        if (i === 2 && data.image) {
          html += `<div class="text-center mb-3"><img src="${data.image}" class="img-preview shadow-sm" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©"></div>`;
        }

        if (i === 2 && data.text) {
          html += `<div class="mb-3 p-2 bg-light rounded">${esc(data.text)}</div>`;
        }

        if (i === 2 && data.table.length > 0) {
          let tableRows = '';

          data.table.forEach(row => {
            if (row.title || row.value) {
              tableRows += `<tr><td>${esc(row.title)}</td><td>${esc(row.value)}</td></tr>`;
            }
          });

          if (tableRows) {
            const descLabel = lang === "ar" ? "Ø§Ù„ÙˆØµÙ" : "Description";
            const detailLabel = lang === "ar" ? "Ø§Ù„ØªÙØ§ØµÙŠÙ„" : "Details";

            html += `<table class="table table-bordered mb-3"><thead><tr><th>${descLabel}</th><th>${detailLabel}</th></tr></thead><tbody>${tableRows}</tbody></table>`;
          }
        }

        html += `<div class="report-qr-container"><div class="report-qr" id="report-accordion-qr-${i}"></div></div>`;

        if (data.comment) html += `<div class="report-comment">${esc(data.comment)}</div>`;
        html += `</div>`;
      }

      return html;
    }

    // ===== Export Functions =====
    document.getElementById('report-pdf').onclick = function () {
      const element = document.getElementById('report-body');
      const options = {
        margin: 0,
        filename: 'qr-report-a2.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 4, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a2', orientation: 'portrait' },
        pagebreak: { mode: ['css', 'legacy'] }
      };

      html2pdf().set(options).from(element).save();
    };
    document.getElementById('report-jpg').onclick = async function () {
      const node = document.querySelector('#report-body .a2-page');
      if (!node) return;
      const canvas = await html2canvas(node, {
        scale: 2,
        useCORS: true,
        backgroundColor: '#ffffff'
      });
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/jpeg', 0.95);
      a.download = 'qr-report-a2.jpg';
      a.click();
    };
    document.getElementById('report-docx').onclick = async function () {
      alert('ØªØµØ¯ÙŠØ± DOCX ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„Ù‡ ÙÙŠ Ø¥ØµØ¯Ø§Ø±Ø§Øª Ù„Ø§Ø­Ù‚Ø©.');
    };
    document.getElementById('report-print').onclick = function () {
      window.print();
    };
    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù…Ø¹Ø§ÙŠÙ†Ø© QR Ø­Ø³Ø¨ Ø§Ù„ØªØ¨ÙˆÙŠØ¨
    document.querySelectorAll('#dataTabs button').forEach(button => {
      button.addEventListener('shown.bs.tab', function (e) {
        var activeTab = e.target.getAttribute('aria-controls');

        if (activeTab === 'url-pane' || activeTab === 'wifi-pane' || activeTab === 'vcard-pane') {
          if (getDataFromActiveTab().trim() !== '') {
            document.getElementById('qr-result-fields').style.display = 'block';
          } else {
            document.getElementById('qr-result-fields').style.display = 'none';
          }

          updateMainQR();
        } else {
          document.getElementById('qr-result-fields').style.display = 'none';
        }
      });
    });

    // ===== PATCH: Save/Load for Accordion #1 (admin only) =====
    document.getElementById('save-accordion1')?.addEventListener('click', () => {
      if (typeof getRole === 'function' && getRole() !== 'admin') {
        showToast(document.documentElement.lang === 'ar' ? 'ØºÙŠØ± Ù…ÙØµØ±Ù‘Ø­: Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·.' : 'Not authorized: Admin only.', 'danger');
        return;
      }

      // ØªØ­Ù‚Ù‚ Ø¨Ø³ÙŠØ·: ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ©
      const payload = generalCards
        .filter(Boolean)
        .map(({ date, description, notes, files }) => ({
          date: (date || '').trim(),
          description: (description || '').trim(),
          notes: (notes || '').trim(),
          // Ù†Ø­ÙØ¸ Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ ÙÙ‚Ø· Ù„ØªØ¬Ù†Ø¨ ØªØ¶Ø®ÙŠÙ… Ø§Ù„ØªØ®Ø²ÙŠÙ†
          files: (files || []).map(f => ({ name: f.name, type: f.type }))
        }))
        .filter(c => c.date || c.description || c.notes || (c.files && c.files.length));

      if (!payload.length) {
        showToast(document.documentElement.lang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© Ù„Ù„Ø­ÙØ¸.' : 'Nothing to save.', 'warning');
        return;
      }

      try {
        lsSet('a1_saved', JSON.stringify(payload));
        showToast(document.documentElement.lang === 'ar' ? 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª.' : 'Saved successfully.', 'success');
      } catch {
        showToast(document.documentElement.lang === 'ar' ? 'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ (Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦ØŸ)' : 'Save failed (storage full?)', 'danger');
      }
    });

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø¥Ù† ÙˆÙØ¬Ø¯)
    document.addEventListener('DOMContentLoaded', () => {
      try {
        const saved = JSON.parse(lsGet('a1_saved') || '[]');
        if (!Array.isArray(saved) || !saved.length) return;

        // ØªÙØ±ÙŠØº ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡
        document.getElementById('accordion1-cards-container').innerHTML = '';
        generalCards.length = 0;
        cardColorIndex = 0;

        saved.forEach(c => {
          addAccordion1Card(); // ÙŠÙ†Ø´Ø¦ Ø¨Ø·Ø§Ù‚Ø© ÙˆÙŠØ¬Ù‡Ù‘Ø² Ø£Ø­Ø¯Ø§Ø«Ù‡Ø§
          const idx = generalCards.length - 1;
          const card = generalCards[idx];

          card.date = c.date || '';
          card.description = c.description || '';
          card.notes = c.notes || '';
          card.files = (c.files || []).map(f => ({ name: f.name, type: f.type, preview: '' }));

          // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
          const d = document.querySelector(`input.card-date[data-card-id="${idx}"]`);
          const t = document.querySelector(`textarea.card-description[data-card-id="${idx}"]`);
          const n = document.querySelector(`textarea.card-notes[data-card-id="${idx}"]`);
          if (d) d.value = card.date;
          if (t) t.value = card.description;
          if (n) n.value = card.notes;
          updateAttachmentsPreview(idx);
        });

        updateGeneralAccordionQr();
      } catch { }
    });
    // Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    document.addEventListener("DOMContentLoaded", function () {
      setLanguage(document.documentElement.lang || "ar");
      updateBilingualButton(); // Initialize bilingual button state

      for (let i = 1; i <= 3; i++) initAccordionQR(i);

      updateGeneralAccordionQr();
      document.getElementById('accordion1').classList.remove('show');
      document.getElementById('accordion2').classList.remove('show');
      document.getElementById('accordion3').classList.remove('show');

      var myModal = new bootstrap.Modal(document.getElementById('alertModal'));
      myModal.show();

      updateCartBadge();
      observeDynamicPlaceholders();

      // ØªÙ‡ÙŠØ¦Ø© Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
      renderProducts();
    });

    // Refresh products when products tab is clicked
    document.getElementById('products-tab')?.addEventListener('shown.bs.tab', function () {
      renderProducts();
    });

    // ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø± =====
    // Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
    const LS_ROLE = 'userRole';
    const LS_SUBS = 'userSubs';
    const LS_CUR_SUB = 'currentSubId';
    const LS_ATTEMPTS = 'codeAttempts';
    const LS_LOCK_UNTIL = 'codeLockUntil';

    // Ø£Ø¯ÙˆØ§Øª ÙˆÙ‚Øª
    const now = () => Date.now();
    const minutes = n => n * 60 * 1000;

    // =====  Lock UI for viewer role (attribute-driven) =====
    function lockViewerUI() {
      const isViewer = (typeof getRole === 'function' && getRole() === 'viewer');
      document.documentElement.toggleAttribute('data-role-viewer', isViewer);

      document.querySelectorAll('[data-role="admin-only"], .viewer-hide').forEach(el => {
        el.style.display = isViewer ? 'none' : '';
      });

      const nodes = document.querySelectorAll('input, textarea, select, [contenteditable="true"]');
      nodes.forEach(el => {
        if (el.matches('[type="button"],[type="submit"]')) return;
        const allow = el.getAttribute('data-viewer-editable') === '1';
        if (isViewer && !allow) {
          el.setAttribute('disabled', 'disabled');
          if (el.hasAttribute('contenteditable')) {
            if (!el.hasAttribute('data-restore-ce')) el.setAttribute('data-restore-ce', '1');
            el.setAttribute('contenteditable', 'false');
          }
        } else {
          el.removeAttribute('disabled');
          if (el.getAttribute('data-restore-ce') === '1') el.setAttribute('contenteditable', 'true');
        }
      });
    }

    // NOTE: call lockViewerUI from within applyUserRole so it always runs.

    // Ù‚Ø±Ø§Ø¡Ø©/ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø­Ø§Ù„Ø©
    function getRole() { return lsGet(LS_ROLE) || ''; }
    function setRole(r) { lsSet(LS_ROLE, r || ''); applyUserRole(r || ''); }

    // Get subscription from database based on current code
    async function getSubs() {
      try {
        // First check if we have a current code stored
        const currentCode = lsGet('current_verified_code') || '';
        if (!currentCode) {
          // Fallback to localStorage for backward compatibility
          const stored = lsGet(LS_SUBS);
          if (stored) {
            try {
              return JSON.parse(stored);
            } catch {
              return {};
            }
          }
          return {};
        }

        // Try to get subscription from database
        if (typeof db !== 'undefined' && db) {
          try {
            if (!db.db) {
              await db.init();
            }

            // Verify code to get user info
            const codeResult = await db.verifyCode(currentCode);
            if (codeResult && codeResult.ok) {
              // Get user from payload
              const userId = codeResult.payload?.userId;
              if (userId) {
                const user = await db.getUser(userId);
                if (user) {
                  // Get codes for this user
                  const userCodes = await db.getUserCodes(userId);
                  const adminCode = userCodes.find(c => c.type === 'admin' && c.isActive);
                  const viewerCode = userCodes.find(c => c.type === 'viewer' && c.isActive);

                  // Build subscription object
                  const expiryDate = user.expiryDate ? new Date(user.expiryDate).getTime() : null;
                  const until = expiryDate || (Date.now() + 180 * 24 * 60 * 60 * 1000);

                  // Determine tier
                  let tier = 'Basic-3';
                  if (user.product && user.product.includes('6')) {
                    tier = 'Pro-6';
                  } else if (user.product && (user.product.includes('Ø³Ù†ÙˆÙŠ') || user.product.includes('Yearly'))) {
                    tier = 'Pro-12';
                  }

                  return {
                    id: userId,
                    tier: tier,
                    until: until,
                    codes: {
                      admin: adminCode ? adminCode.code : '',
                      viewer: viewerCode ? viewerCode.code : ''
                    },
                    payload: {
                      userId: user.id,
                      name: user.name,
                      email: user.email,
                      product: user.product
                    }
                  };
                }
              }
            }
          } catch (error) {
            console.warn('Error fetching subscription from database:', error);
          }
        }

        // Fallback to localStorage
        const stored = lsGet(LS_SUBS);
        if (stored) {
          try {
            return JSON.parse(stored);
          } catch {
            return {};
          }
        }
        return {};
      } catch (error) {
        console.error('Error in getSubs:', error);
        return {};
      }
    }

    // Save subscription to database and localStorage
    async function setSubs(obj) {
      try {
        // Save to localStorage for quick access
        lsSet(LS_SUBS, JSON.stringify(obj || {}));

        // Also save to database if we have user info
        if (obj && obj.payload && obj.payload.userId && typeof db !== 'undefined' && db) {
          try {
            if (!db.db) {
              await db.init();
            }

            const userId = obj.payload.userId;

            // Update or create subscription record
            const existingSub = await db.getUserSubscription(userId);
            if (existingSub) {
              await db.updateSubscription(existingSub.id, {
                tier: obj.tier || 'Basic',
                expiryDate: obj.until ? new Date(obj.until).toISOString() : null,
                isActive: obj.until > Date.now()
              });
            } else {
              await db.addSubscription({
                userId: userId,
                tier: obj.tier || 'Basic',
                startDate: new Date().toISOString(),
                expiryDate: obj.until ? new Date(obj.until).toISOString() : null,
                isActive: obj.until > Date.now()
              });
            }
          } catch (error) {
            console.warn('Error saving subscription to database:', error);
          }
        }
      } catch (error) {
        console.error('Error in setSubs:', error);
      }
    }
    function getAttempts() { return +(lsGet(LS_ATTEMPTS) || 0); }
    function setAttempts(n) { lsSet(LS_ATTEMPTS, String(n)); }
    function getLockUntil() { return +(lsGet(LS_LOCK_UNTIL) || 0); }
    function setLockUntil(ts) { lsSet(LS_LOCK_UNTIL, String(ts || 0)); }

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    function applyUserRole(role) {
      document.body.classList.remove('role-viewer');
      if (role === 'viewer') document.body.classList.add('role-viewer');

      // Ø§Ù„Ø¬Ø¯ÙŠØ¯: ØªØ£ÙƒÙŠØ¯ Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
      lockViewerUI();

      // ØªÙˆØ³Øª Ù„Ø·ÙŠÙ
      if (role) showToast(role === 'admin'
        ? (document.documentElement.lang === 'ar' ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±Ù.' : 'Admin privileges enabled.')
        : (document.documentElement.lang === 'ar' ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©.' : 'Viewer mode enabled.')
        , 'primary');
    }

    // ØªÙ†Ø³ÙŠÙ‚ ØªØ§Ø±ÙŠØ® Ø¨Ø³ÙŠØ·
    function fmtDate(ts) {
      try {
        const d = new Date(ts);
        return d.toLocaleDateString(document.documentElement.lang || 'ar', { year: 'numeric', month: 'short', day: '2-digit' });
      } catch { return '--/--/----'; }
    }

    // Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø§Ù„ÙƒÙˆØ¯
    function buildShareUrl(code) {
      const base = location.origin + location.pathname; // Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
      return `${base}?code=${encodeURIComponent(code)}`;
    }

    // ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø§Øª "Ø±Ù…Ø² QR Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ" ÙˆØ±ÙˆØ§Ø¨Ø·Ù‡Ø§
    async function updatePersonalQRCards() {
      const subs = await getSubs();
      const adminCode = subs?.codes?.admin || '';
      const viewerCode = subs?.codes?.viewer || '';
      const adminUrl = adminCode ? buildShareUrl(adminCode) : '';
      const viewerUrl = viewerCode ? buildShareUrl(viewerCode) : '';

      // ØµÙˆØ± QR (Ù…Ø²ÙˆØ¯ Ø®Ø§Ø±Ø¬ÙŠ Ø¨Ø³ÙŠØ·) â€” ÙˆÙ„Ù„ØªÙ†Ø²ÙŠÙ„ Ù†Ù†Ø´Ø¦ ØµÙˆØ±Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§
      const adminImg = document.getElementById('myqr-admin-img');
      const viewerImg = document.getElementById('myqr-viewer-img');

      // Ø¥Ø¶Ø§ÙØ© fallback Ù„Ù„ØµÙˆØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
      if (adminImg && adminUrl) {
        adminImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(adminUrl)}`;
        adminImg.onerror = function () {
          this.onerror = null;
          const fallbackDiv = document.createElement('div');
          fallbackDiv.style.width = '150px';
          fallbackDiv.style.height = '150px';
          this.parentNode.replaceChild(fallbackDiv, this);
          new QRCodeStyling({
            width: 150,
            height: 150,
            type: 'canvas',
            data: adminUrl,
            dotsOptions: { color: '#000', type: 'rounded' },
            backgroundOptions: { color: '#fff' }
          }).append(fallbackDiv);
        };
      }

      if (viewerImg && viewerUrl) {
        viewerImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(viewerUrl)}`;
        viewerImg.onerror = function () {
          this.onerror = null;
          const fallbackDiv = document.createElement('div');
          fallbackDiv.style.width = '150px';
          fallbackDiv.style.height = '150px';
          this.parentNode.replaceChild(fallbackDiv, this);
          new QRCodeStyling({
            width: 150,
            height: 150,
            type: 'canvas',
            data: viewerUrl,
            dotsOptions: { color: '#000', type: 'rounded' },
            backgroundOptions: { color: '#fff' }
          }).append(fallbackDiv);
        };
      }

      // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø³Ø®/Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©/Ø§Ù„ØªØ­Ù…ÙŠÙ„
      document.querySelectorAll('[data-copy-link]').forEach(btn => {
        btn.onclick = () => {
          const t = btn.getAttribute('data-copy-link');
          const link = t === 'admin' ? adminUrl : viewerUrl;
          if (!link) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù…ØªØ§Ø­ Ø¨Ø¹Ø¯.', 'warning');
          navigator.clipboard.writeText(link).then(() => showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·.', 'success'));
        };
      });

      document.querySelectorAll('[data-share-wa]').forEach(btn => {
        btn.onclick = () => {
          const t = btn.getAttribute('data-share-wa');
          const link = t === 'admin' ? adminUrl : viewerUrl;
          if (!link) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù…ØªØ§Ø­ Ø¨Ø¹Ø¯.', 'warning');
          const txt = `ØªÙØ¶Ù„ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„: ${link}`;
          safeOpen(`https://wa.me/?text=${encodeURIComponent(txt)}`);
        };
      });

      document.querySelectorAll('[data-download-qr]').forEach(btn => {
        btn.onclick = async () => {
          const t = btn.getAttribute('data-type');
          const link = t === 'admin' ? adminUrl : viewerUrl;
          if (!link) return showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù…Ø² Ù„ØªÙˆÙ„ÙŠØ¯Ù‡.', 'warning');
          // ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ø¨Ø± Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø«Ù… ØªÙ†Ø²ÙŠÙ„Ù‡Ø§
          const tmp = document.createElement('div');
          tmp.style.position = 'fixed'; tmp.style.left = '-9999px'; tmp.style.top = '-9999px';
          document.body.appendChild(tmp);
          const q = new QRCodeStyling({
            width: 600, height: 600, type: 'canvas', data: link,
            dotsOptions: { color: qrCustomization.dotsColor, type: qrCustomization.dotsType },
            backgroundOptions: { color: qrCustomization.bgColor },
            qrOptions: { errorCorrectionLevel: qrCustomization.ecc },
            margin: qrCustomization.margin
          });
          q.append(tmp);
          setTimeout(() => {
            const c = tmp.querySelector('canvas');
            if (c) {
              const a = document.createElement('a');
              a.href = c.toDataURL('image/png');
              a.download = `myqr-${t}.png`;
              a.click();
            }
            tmp.remove();
          }, 60);
        };
      });
    }

    // Ø±Ù†Ø¯Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    async function renderSubscriptionUI() {
      const subs = await getSubs();
      const badge = document.getElementById('sub-status-badge');
      const untilEl = document.getElementById('sub-until');
      const ul = document.getElementById('sub-notifs');

      const untilTs = subs?.until || 0;
      const active = untilTs > now();
      const role = getRole();

      // Show/hide personal QR codes section - only for admin with valid subscription
      const qrAccordion = document.getElementById('personal-qr-accordion');
      if (qrAccordion) {
        const isAdmin = role === 'admin';
        const hasValidSubscription = active && untilTs > 0;
        const hasCodes = subs?.codes?.admin && subs?.codes?.viewer;

        // Show only if: admin role + valid subscription + has codes
        if (isAdmin && hasValidSubscription && hasCodes) {
          qrAccordion.style.display = 'block';
        } else {
          qrAccordion.style.display = 'none';
        }
      }

      if (badge) {
        badge.className = 'status-badge-modern ' + (active ? 'active' : 'expired');
        badge.textContent = active ? (document.documentElement.lang === 'ar' ? 'Ù†Ø´Ø· | Active' : 'Active') : (document.documentElement.lang === 'ar' ? 'Ù…Ù†ØªÙ‡ÙŠ | Expired' : 'Expired');
      }
      if (untilEl) untilEl.textContent = untilTs ? fmtDate(untilTs) : '--/--/----';

      if (ul) {
        ul.innerHTML = '';

        // Helper function to create modern detail card
        const createDetailCard = (icon, label, value, iconClass = '') => {
          const card = document.createElement('div');
          card.className = 'subscription-detail-card';

          const iconEl = document.createElement('div');
          iconEl.className = 'subscription-detail-icon';
          iconEl.innerHTML = `<i class="${icon}"></i>`;

          const labelEl = document.createElement('div');
          labelEl.className = 'subscription-detail-label';
          labelEl.textContent = label;

          const valueEl = document.createElement('div');
          valueEl.className = 'subscription-detail-value';
          valueEl.textContent = value;

          card.appendChild(iconEl);
          card.appendChild(labelEl);
          card.appendChild(valueEl);

          return card;
        };

        // Add client information (name and email) if available
        if (subs?.payload) {
          if (subs.payload.name) {
            const nameCard = createDetailCard(
              'bi bi-person',
              document.documentElement.lang === 'ar' ? 'Ø§Ù„Ø§Ø³Ù… | Name' : 'Name',
              subs.payload.name
            );
            ul.appendChild(nameCard);
          }

          if (subs.payload.email) {
            const emailCard = createDetailCard(
              'bi bi-envelope',
              document.documentElement.lang === 'ar' ? 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ | Email' : 'Email',
              subs.payload.email
            );
            ul.appendChild(emailCard);
          }
        }

        // Add role card
        const roleCard = createDetailCard(
          'bi bi-shield-check',
          document.documentElement.lang === 'ar' ? 'Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ | Current Role' : 'Current Role',
          role || 'â€”'
        );
        ul.appendChild(roleCard);

        // Add tier/plan card
        if (subs?.tier) {
          const tierCard = createDetailCard(
            'bi bi-box',
            document.documentElement.lang === 'ar' ? 'Ø§Ù„Ø¨Ø§Ù‚Ø© | Plan' : 'Plan',
            subs.tier
          );
          ul.appendChild(tierCard);
        }

        // Add expiration date card
        const expiryCard = createDetailCard(
          'bi bi-calendar-check',
          document.documentElement.lang === 'ar' ? 'ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ | Expires On' : 'Expires On',
          untilTs ? fmtDate(untilTs) : 'â€”'
        );
        ul.appendChild(expiryCard);
      }

      // Only update QR cards if user is admin with valid subscription
      if (role === 'admin' && active && untilTs > 0 && subs?.codes?.admin) {
        await updatePersonalQRCards();
      }

      // Ù‡ÙˆÙƒ Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ø¹Ø±Ø¶ Ø­Ù…ÙˆÙ„Ø© Ø¥Ø¶Ø§ÙÙŠØ©
      if (typeof window.onSubscriptionPayload === 'function' && subs?.payload) {
        try { window.onSubscriptionPayload(subs.payload); } catch { }
      }
    }

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ (Ø¨Ø¯ÙŠÙ„ Ø¯ÙŠÙ…Ùˆ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ØªÙˆÙØ± Ø§Ù„Ø³ÙŠØ±ÙØ±)
    async function apiVerifyCode(code) {
      code = String(code || '').trim();
      if (!code) return { ok: false, message: 'EMPTY' };

      // First, try to verify from local database
      try {
        if (typeof db !== 'undefined' && db) {
          // Ensure database is initialized
          if (!db.db) {
            await db.init();
          }

          const dbResult = await db.verifyCode(code);
          if (dbResult && dbResult.ok) {
            console.log('âœ… Code verified from database:', code);
            return dbResult;
          }
        }
      } catch (error) {
        console.warn('Database verification failed, trying API:', error);
      }

      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
      try {
        const r = await fetch('api/verify-code', { // âœ… Ù…Ø³Ø§Ø± Ù†Ø³Ø¨ÙŠ
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code })
        });
        if (r.ok) {
          const data = await r.json();
          // ØªÙˆÙ‚Ù‘Ø¹Ù†Ø§ Ù‡ÙŠÙƒÙ„Ù‹Ø§: {ok, role, until, codes:{admin,viewer}, tier, payload}
          if (data && data.ok) return data;
        }
      } catch { /* ÙŠØ³Ù‚Ø· Ù„Ù„Ù€ Ø¯ÙŠÙ…Ùˆ */ }

      // Ø¯ÙŠÙ…Ùˆ Ù…Ø­Ù„ÙŠ: Ø±Ù…ÙˆØ² Ù…Ø¹Ø±ÙˆÙØ©
      const lower = code.toUpperCase();
      if (lower === 'DEMO-ADMIN' || lower === 'ADMIN-CODE-123') {
        const until = now() + 180 * 24 * 60 * 60 * 1000; // 6 Ø£Ø´Ù‡Ø± ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§
        return { ok: true, role: 'admin', until, tier: 'Pro-6', codes: { admin: 'ADM-123456', viewer: 'VWR-987654' }, payload: { note: 'Demo payload for admin' } };
      }
      if (lower === 'DEMO-VIEWER' || lower === 'VIEWER-CODE-456') {
        const until = now() + 90 * 24 * 60 * 60 * 1000;
        return { ok: true, role: 'viewer', until, tier: 'Basic-3', codes: { admin: 'ADM-123456', viewer: 'VWR-987654' }, payload: { note: 'Demo payload for viewer' } };
      }

      return { ok: false, message: 'INVALID' };
    }

    // Ø¹Ø¯Ù‘ ØªÙ†Ø§Ø²Ù„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
    let lockTimer = null;
    function startLockCountdown() {
      const cd = document.getElementById('code-countdown');
      const lockTs = getLockUntil();
      if (!cd || !lockTs) return;

      cd.style.display = 'block';
      function tick() {
        const left = Math.max(0, lockTs - now());
        const mm = String(Math.floor(left / 60000)).padStart(2, '0');
        const ss = String(Math.floor((left % 60000) / 1000)).padStart(2, '0');
        cd.textContent = (document.documentElement.lang === 'ar' ? 'Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø¹Ø¯: ' : 'Try again in: ') + `${mm}:${ss}`;
        if (left <= 0) { clearInterval(lockTimer); cd.style.display = 'none'; setAttempts(0); setLockUntil(0); }
      }
      tick();
      clearInterval(lockTimer);
      lockTimer = setInterval(tick, 1000);
    }

    // Function to open code modal (reusable)
    function openCodeModal() {
      const m = new bootstrap.Modal(document.getElementById('codeModal'));
      document.getElementById('input-code').value = '';
      document.getElementById('code-error').style.display = 'none';

      // Clear lockout if it's been more than 30 seconds (allow early unlock)
      const lockTs = getLockUntil();
      if (lockTs && lockTs > now()) {
        const remaining = lockTs - now();
        // If less than 30 seconds remaining, clear it automatically
        if (remaining < 30000) {
          setLockUntil(0);
          setAttempts(0);
          const cd = document.getElementById('code-countdown');
          if (cd) cd.style.display = 'none';
        }
      }

      m.show();
      setTimeout(() => document.getElementById('input-code').focus(), 100);
    }

    // Update UI to show client name instead of code input button
    function updateClientNameDisplay(clientName) {
      const codeBtn = document.getElementById('open-code-modal-btn');
      const codeBtnMobile = document.getElementById('open-code-modal-btn-mobile');

      // Hide the buttons
      if (codeBtn) {
        codeBtn.style.display = 'none';
      }
      if (codeBtnMobile) {
        codeBtnMobile.style.display = 'none';
      }

      // Check if client name display already exists
      let clientNameDisplay = document.getElementById('client-name-display');
      let clientNameDisplayMobile = document.getElementById('client-name-display-mobile');

      // Create desktop display if it doesn't exist
      if (!clientNameDisplay && codeBtn) {
        clientNameDisplay = document.createElement('button');
        clientNameDisplay.id = 'client-name-display';
        clientNameDisplay.className = 'btn btn-success';
        clientNameDisplay.style.cssText = 'white-space: nowrap; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer;';
        clientNameDisplay.title = document.documentElement.lang === 'ar' ? 'Ø§Ù†Ù‚Ø± Ù„ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙˆØ¯ | Click to change code' : 'Click to change code';
        clientNameDisplay.innerHTML = `<i class="bi bi-person-check"></i> <span>${clientName}</span> <i class="bi bi-arrow-repeat" style="font-size: 0.85em; opacity: 0.7;"></i>`;
        codeBtn.parentNode.insertBefore(clientNameDisplay, codeBtn);

        // Add click event to open code modal
        clientNameDisplay.addEventListener('click', openCodeModal);
      } else if (clientNameDisplay) {
        // Update existing display
        const span = clientNameDisplay.querySelector('span');
        if (span) span.textContent = clientName;
        // Ensure click handler is attached (in case it was removed)
        clientNameDisplay.onclick = openCodeModal;
      }

      // Create mobile display if it doesn't exist
      if (!clientNameDisplayMobile && codeBtnMobile) {
        clientNameDisplayMobile = document.createElement('button');
        clientNameDisplayMobile.id = 'client-name-display-mobile';
        clientNameDisplayMobile.className = 'btn btn-success btn-sm';
        clientNameDisplayMobile.style.cssText = 'display: inline-flex; align-items: center; gap: 0.3rem; cursor: pointer;';
        clientNameDisplayMobile.title = document.documentElement.lang === 'ar' ? 'Ø§Ù†Ù‚Ø± Ù„ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙˆØ¯ | Click to change code' : 'Click to change code';
        clientNameDisplayMobile.innerHTML = `<i class="bi bi-person-check"></i> <span style="font-size: 0.8rem;">${clientName}</span> <i class="bi bi-arrow-repeat" style="font-size: 0.75em; opacity: 0.7;"></i>`;
        codeBtnMobile.parentNode.insertBefore(clientNameDisplayMobile, codeBtnMobile);

        // Add click event to open code modal
        clientNameDisplayMobile.addEventListener('click', openCodeModal);
      } else if (clientNameDisplayMobile) {
        // Update existing display
        const span = clientNameDisplayMobile.querySelector('span');
        if (span) span.textContent = clientName;
        // Ensure click handler is attached (in case it was removed)
        clientNameDisplayMobile.onclick = openCodeModal;
      }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ + ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    async function performCodeVerification(code, { auto = false } = {}) {
      const input = document.getElementById('input-code');
      const err = document.getElementById('code-error');

      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
      const lockTs = getLockUntil();
      if (lockTs && lockTs > now()) {
        const remaining = lockTs - now();
        // Auto-clear if less than 10 seconds remaining
        if (remaining < 10000) {
          setLockUntil(0);
          setAttempts(0);
        } else {
          startLockCountdown();
          if (err) { err.style.display = 'block'; err.textContent = document.documentElement.lang === 'ar' ? 'ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…Ø¤Ù‚ØªÙ‹Ø§.' : 'Attempts are temporarily locked.'; }
          if (input) input.disabled = false;
          return;
        }
      }

      if (input) input.disabled = true;
      if (err) { err.style.display = 'none'; err.textContent = ''; }

      const resp = await apiVerifyCode(code);

      if (!resp.ok) {
        const tries = getAttempts() + 1;
        setAttempts(tries);
        if (tries >= 5) {
          // Reduced lockout to 1 minute instead of 30 minutes
          setLockUntil(now() + minutes(1));
          startLockCountdown();
          if (err) { err.style.display = 'block'; err.textContent = document.documentElement.lang === 'ar' ? 'Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©. ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©.' : 'Too many attempts. Locked for 1 minute.'; }
        } else {
          if (err) { err.style.display = 'block'; err.textContent = document.documentElement.lang === 'ar' ? 'Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­.' : 'Invalid code.'; }
        }
        if (input) input.disabled = false;
        return;
      }

      // Ù†Ø¬Ø§Ø­
      setAttempts(0); setLockUntil(0);

      // Store the verified code for later retrieval
      lsSet('current_verified_code', code);

      const subs = {
        id: resp.id || resp.payload?.userId || 1,
        tier: resp.tier || 'Basic',
        until: +resp.until || (now() + 30 * 24 * 60 * 60 * 1000),
        codes: resp.codes || {},
        payload: resp.payload || null
      };

      // Save to database
      await setSubs(subs);

      // Store client name if available
      const clientName = resp.payload?.name || null;
      if (clientName) {
        lsSet('client_name', clientName);
        updateClientNameDisplay(clientName);
      }

      // Set role based on code type - if no admin code, force viewer mode
      const role = resp.role || 'viewer';
      // If user doesn't have admin code, they must be viewer
      if (role === 'admin' && (!resp.codes || !resp.codes.admin)) {
        setRole('viewer');
      } else {
        setRole(role);
      }

      await renderSubscriptionUI();

      // Ø£ØºÙ„Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
      try {
        bootstrap.Modal.getOrCreateInstance(document.getElementById('codeModal')).hide();
      } catch { }

      // Ù†Ø¸Ù‘Ù Ø±Ø§Ø¨Ø· ?code Ù…Ù† Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚
      if (auto) {
        const url = new URL(location.href);
        url.searchParams.delete('code');
        history.replaceState(null, '', url.toString());
      }

      showToast(document.documentElement.lang === 'ar' ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­.' : 'Account activated.', 'success');
    }

    // Ø£Ø²Ø±Ø§Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    document.getElementById('btn-show-sub-toast')?.addEventListener('click', async () => {
      const subs = await getSubs();
      const msg = (document.documentElement.lang === 'ar' ? 'Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙØ¹Ø§Ù„ Ø­ØªÙ‰: ' : 'Active until: ') + (subs?.until ? fmtDate(subs.until) : 'â€”');
      showToast(msg, 'info');
    });

    // â€”â€”â€”â€” Ø¥Ø¶Ø§ÙØ§Øª Ù…ØªØ¬Ø± ØµØºÙŠØ±Ø© (ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ù„Ø©) â€”â€”â€”â€”
    document.getElementById('cartButton')?.addEventListener('click', () => {
      renderCartModal();
      new bootstrap.Modal(document.getElementById('cartModal')).show();
    });
    document.addEventListener('click', (e) => {
      const addBtn = e.target.closest('.add-to-cart');
      if (addBtn) {
        addToCart(addBtn.getAttribute('data-id'));
        showToast(document.documentElement.lang === 'ar' ? 'Ø£Ø¶ÙŠÙ Ù„Ù„Ø³Ù„Ø©.' : 'Added to cart.', 'success');
      }
    });
    document.getElementById('cart-modal-body')?.addEventListener('input', (e) => {
      if (e.target.classList.contains('cart-qty')) {
        const idx = +e.target.getAttribute('data-idx');
        const val = Math.max(1, +e.target.value || 1);
        if (cart[idx]) { cart[idx].qty = val; saveCart(); renderCartModal(); updateCartBadge(); }
      }
    });
    document.getElementById('cart-modal-body')?.addEventListener('click', (e) => {
      const rm = e.target.closest('.remove-cart-item');
      if (rm) {
        const idx = +rm.getAttribute('data-idx');
        cart.splice(idx, 1); saveCart(); renderCartModal(); updateCartBadge();
      }
    });
    // Payment configuration
    const paymentConfig = {
      bank: {
        name: 'Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ',
        account: '1234567890123456',
        iban: 'EG3800190005000000001234567890'
      },
      instagram: {
        account: '@your_instagram_account'
      },
      vodafone: {
        number: '01001234567'
      },
      whatsapp: '201234567890' // WhatsApp number for order confirmation
    };

    // Open payment modal when checkout is clicked
    document.getElementById('checkoutBtn')?.addEventListener('click', () => {
      if (cart.length === 0) {
        showToast(document.documentElement.lang === 'ar' ? 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©' : 'Cart is empty', 'warning');
        return;
      }

      // Close cart modal
      const cartModal = bootstrap.Modal.getInstance(document.getElementById('cartModal'));
      if (cartModal) cartModal.hide();

      // Show payment modal
      const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));

      // Reset payment method selection
      document.querySelectorAll('.payment-method-card').forEach(card => {
        card.classList.remove('selected');
      });

      // Hide all payment info
      document.querySelectorAll('.bank-info, .instagram-info, .vodafone-info').forEach(info => {
        info.style.display = 'none';
      });

      paymentModal.show();
    });

    // Handle payment method selection
    document.querySelectorAll('.payment-method-card').forEach(card => {
      card.addEventListener('click', function () {
        // Remove selection from all cards
        document.querySelectorAll('.payment-method-card').forEach(c => {
          c.classList.remove('selected');
          c.querySelectorAll('.bank-info, .instagram-info, .vodafone-info').forEach(info => {
            info.style.display = 'none';
          });
        });

        // Select clicked card
        this.classList.add('selected');
        const method = this.getAttribute('data-method');

        // Show payment details based on method
        if (method === 'bank') {
          document.getElementById('bankName').textContent = paymentConfig.bank.name;
          document.getElementById('bankAccount').textContent = paymentConfig.bank.account;
          document.getElementById('bankIBAN').textContent = paymentConfig.bank.iban;
          document.getElementById('bankInfo').style.display = 'block';
        } else if (method === 'instagram') {
          document.getElementById('instagramAccount').textContent = paymentConfig.instagram.account;
          document.getElementById('instagramInfo').style.display = 'block';
        } else if (method === 'vodafone') {
          document.getElementById('vodafoneNumber').textContent = paymentConfig.vodafone.number;
          document.getElementById('vodafoneInfo').style.display = 'block';
        }

        // After a short delay, proceed to WhatsApp
        setTimeout(() => {
          proceedToWhatsApp(method);
        }, 1500);
      });
    });

    // Function to proceed to WhatsApp with cart details and codes
    async function proceedToWhatsApp(paymentMethod) {
      try {
        // Calculate cart total
        const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
        const fmt = n => n.toLocaleString('ar-EG', { style: 'currency', currency: 'EGP' });

        // Generate codes for customer (viewer and admin)
        let adminCode = '';
        let viewerCode = '';

        // Try to generate codes from database if available
        if (typeof db !== 'undefined' && db) {
          try {
            if (!db.db) await db.init();

            // Create a temporary user for this order
            const tempUserId = await db.addUser({
              name: 'Customer Order',
              email: `order_${Date.now()}@temp.com`,
              phone: '',
              product: cart.map(item => item.name).join(', '),
              purchaseDate: new Date().toISOString(),
              expiryDate: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString(),
              amount: cartTotal,
              status: 'pending'
            });

            // Generate codes
            const codes = await db.generateCodesForUser(tempUserId);
            adminCode = codes.adminCode;
            viewerCode = codes.viewerCode;
          } catch (error) {
            console.warn('Could not generate codes from database, using temporary codes:', error);
            // Fallback: generate temporary codes
            adminCode = 'ADM-' + Date.now().toString(36).toUpperCase().slice(-8);
            viewerCode = 'VWR-' + Date.now().toString(36).toUpperCase().slice(-8);
          }
        } else {
          // Fallback: generate temporary codes
          adminCode = 'ADM-' + Date.now().toString(36).toUpperCase().slice(-8);
          viewerCode = 'VWR-' + Date.now().toString(36).toUpperCase().slice(-8);
        }

        // Build cart details text
        const lang = document.documentElement.lang;
        const cartDetails = cart.map((item, idx) => {
          return `${idx + 1}. ${item.name} - ${item.qty}x ${fmt(item.price)} = ${fmt(item.price * item.qty)}`;
        }).join('\n');

        // Build WhatsApp message
        const paymentMethodText = {
          bank: 'Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ | Bank Account',
          instagram: 'Instagram Pay',
          vodafone: 'Vodafone Cash'
        };

        const paymentDetails = {
          bank: `\nğŸ“Œ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ:\nØ§Ù„Ø¨Ù†Ùƒ: ${paymentConfig.bank.name}\nØ±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: ${paymentConfig.bank.account}\nIBAN: ${paymentConfig.bank.iban}`,
          instagram: `\nğŸ“Œ ØªÙØ§ØµÙŠÙ„ Instagram Pay:\nØ§Ù„Ø­Ø³Ø§Ø¨: ${paymentConfig.instagram.account}`,
          vodafone: `\nğŸ“Œ ØªÙØ§ØµÙŠÙ„ Vodafone Cash:\nØ§Ù„Ø±Ù‚Ù…: ${paymentConfig.vodafone.number}`
        };

        const message = `ğŸ›’ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ | New Order\n\n` +
          `ğŸ“¦ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ | Order Details:\n${cartDetails}\n\n` +
          `ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ | Total: ${fmt(cartTotal)}\n\n` +
          `ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ | Payment Method: ${paymentMethodText[paymentMethod]}` +
          `${paymentDetails[paymentMethod]}\n\n` +
          `ğŸ”‘ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø© | Generated Codes:\n` +
          `ğŸ‘‘ ÙƒÙˆØ¯ Ø§Ù„Ø£Ø¯Ù…Ù† | Admin Code: ${adminCode}\n` +
          `ğŸ‘ï¸ ÙƒÙˆØ¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ | Viewer Code: ${viewerCode}\n\n` +
          `ğŸ“¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„:\n` +
          `1. Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù…Ù† Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„\n` +
          `2. ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ù„ØªÙˆØµÙŠÙ„\n\n` +
          `Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! | Thank you!`;

        // Encode message for WhatsApp
        const encodedMessage = encodeURIComponent(message);
        const whatsappUrl = `https://wa.me/${paymentConfig.whatsapp}?text=${encodedMessage}`;

        // Open WhatsApp
        window.open(whatsappUrl, '_blank');

        // Show success message
        showToast(
          document.documentElement.lang === 'ar'
            ? 'ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­. ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†.'
            : 'WhatsApp opened successfully. Please send transfer receipt and delivery address.',
          'success'
        );

        // Close payment modal
        const paymentModal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
        if (paymentModal) paymentModal.hide();

        // Clear cart after successful checkout
        cart = [];
        saveCart();
        updateCartBadge();
        renderCartModal();

      } catch (error) {
        console.error('Error in proceedToWhatsApp:', error);
        showToast(
          document.documentElement.lang === 'ar'
            ? 'Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.'
            : 'An error occurred. Please try again.',
          'error'
        );
      }
    }

    // ===== Deep Link + Personal QR wiring for Admin/Viewer codes =====
    // ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠÙ‹Ø§
    document.getElementById('open-code-modal-btn')?.addEventListener('click', openCodeModal);

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯
    document.getElementById('submit-code')?.addEventListener('click', () => {
      const v = document.getElementById('input-code').value.trim();
      if (!v) return;
      performCodeVerification(v, { auto: false });
    });
    document.getElementById('input-code')?.addEventListener('keydown', e => {
      if (e.key === 'Enter') { e.preventDefault(); document.getElementById('submit-code').click(); }
    });

    // Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„: 1) ØªØ·Ø¨ÙŠÙ‚ Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ© Ø¥Ù† ÙˆÙØ¬Ø¯Øª 2) Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ù† ÙˆÙØ¬Ø¯ ?code
    document.addEventListener('DOMContentLoaded', async () => {
      // Default to viewer mode if no valid subscription exists
      const subs = await getSubs();
      const currentRole = getRole();

      // Check if client name is stored and display it (check both localStorage and subscription payload)
      const storedClientName = lsGet('client_name') || subs?.payload?.name;
      if (storedClientName) {
        // Store it in localStorage if it came from subscription payload
        if (!lsGet('client_name') && subs?.payload?.name) {
          lsSet('client_name', subs.payload.name);
        }
        updateClientNameDisplay(storedClientName);
      }

      // If no valid subscription or role, set to viewer mode by default
      if (!subs?.until || subs.until <= Date.now() || !currentRole) {
        setRole('viewer');
        applyUserRole('viewer');
        // Don't show subscription UI if no valid subscription
        if (subs?.until && subs.until > Date.now()) {
          await renderSubscriptionUI();
        }
      } else {
        // Valid subscription exists, apply saved role
        applyUserRole(currentRole);
        await renderSubscriptionUI();
      }

      // Guard: Ù…Ù†Ø¹ Ø£ÙŠ Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
      document.addEventListener('click', (e) => {
        if (typeof getRole === 'function' && getRole() === 'viewer' && e.target.closest('[data-role="admin-only"]')) {
          e.preventDefault();
          e.stopPropagation();
          showToast(document.documentElement.lang === 'ar' ? 'ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©: Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.' : 'Viewer mode: editing disabled.', 'danger');
        }
      }, true);

      // Deep Link: ?code=...
      const qp = new URLSearchParams(location.search);
      const codeFromUrl = qp.get('code');
      if (codeFromUrl) {
        // Ø§ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
        const m = new bootstrap.Modal(document.getElementById('codeModal'));
        m.show();
        document.getElementById('input-code').value = codeFromUrl;
        performCodeVerification(codeFromUrl, { auto: true });
      }
    });
  </script>
  <script>
    /* Dev Admin Toggle â€” ÙŠØ¸Ù‡Ø± Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙ‚Ø· (localhost/file) Ø£Ùˆ Ø¥Ø°Ø§ ÙØ¹Ù‘Ù„Øª egf.qr.dev=1 */
    (function () {
      function ready(fn) { document.readyState !== 'loading' ? fn() : document.addEventListener('DOMContentLoaded', fn); }
      ready(function () {
        const isDev = ['localhost', '127.0.0.1', ''].includes(location.hostname)
          || location.protocol === 'file:'
          || localStorage.getItem('egf.qr.dev') === '1';
        // Dev admin toggle removed - clients should use viewer mode by default
      });
    })();
  </script>


</body>

</html>